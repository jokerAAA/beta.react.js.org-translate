
äº‹ä»¶å¤„ç†ç¨‹åºä»…åœ¨ä½ å†æ¬¡æ‰§è¡Œç›¸åŒçš„äº¤äº’æ—¶è¿è¡Œï¼Œå’Œå®ƒä¸åŒçš„ï¼ŒEffect åœ¨å…¶ä¾èµ–çš„å€¼ä¸ä¸Šæ¬¡æ¸²æŸ“ä¸åŒæ—¶è¿è¡Œï¼Œæ¯”å¦‚ prop æˆ– state å˜é‡ã€‚æœ‰æ—¶ä½ å¯èƒ½éœ€è¦ä¸¤è€…çš„æ··åˆï¼šä¸€ä¸ª Effect é‡æ–°è¿è¡Œä»¥å“åº”æŸäº›å€¼è€Œä¸æ˜¯å…¶ä»–å€¼ã€‚

> ä½ å°†å­¦åˆ°
>
> - å¦‚ä½•åœ¨äº‹ä»¶å¤„ç†ç¨‹åºå’Œ Effect ä¹‹é—´é€‰æ‹©
> - ä¸ºä»€ä¹ˆ Effect æ˜¯å“åº”å¼çš„è€Œäº‹ä»¶å¤„ç†ç¨‹åºä¸æ˜¯
> - å½“ä½ å¸Œæœ› Effect çš„éƒ¨åˆ†ä»£ç ä¸æ˜¯å“åº”å¼çš„åº”è¯¥æ€ä¹ˆåš
> - Effect Event æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå¦‚ä½•ä» Effects ä¸­æå–å®ƒä»¬
> - å¦‚ä½•ç”¨ Effect Events ä» Effects ä¸­è¯»å–æœ€æ–°çš„ props å’Œ state

## åœ¨äº‹ä»¶å¤„ç†ç¨‹åºå’Œ Effects ä¸­é€‰æ‹©

é¦–å…ˆå›é¡¾ä¸‹äº‹ä»¶å¤„ç†ç¨‹åºå’Œ Effects çš„åŒºåˆ«ã€‚

å‡è®¾ä½ åœ¨å®ç°ä¸€ä¸ªèŠå¤©å®¤ç»„ä»¶ï¼Œä½ çš„éœ€æ±‚æ˜¯è¿™æ ·çš„:

1. ç»„ä»¶éœ€è¦è‡ªåŠ¨è¿æ¥åˆ°é€‰ä¸­çš„èŠå¤©å®¤
2. å½“ä½ ç‚¹å‡»å‘é€æŒ‰é’®æ—¶ï¼Œå®ƒåº”è¯¥å‘é€ä¸€ä¸ªä¿¡æ¯åˆ°æœåŠ¡å™¨

å‡è®¾ä½ å·²ç»å®ç°äº†ä»£ç ï¼Œä½†æ˜¯ä¸ç¡®å®šåº”è¯¥å°†å…¶æ”¾åœ¨å“ªé‡Œã€‚ä½ åº”è¯¥ä½¿ç”¨äº‹ä»¶å¤„ç†ç¨‹åºè¿˜æ˜¯ Effectsï¼Ÿæ¯æ¬¡å½“ä½ éœ€è¦å›ç­”è¿™ä¸ªé—®é¢˜æ—¶ï¼Œè€ƒè™‘ä»£ç ä¸ºä»€ä¹ˆéœ€è¦è¿è¡Œï¼Ÿ

## äº‹ä»¶å¤„ç†ç¨‹åºæ˜¯ä¸ºäº†å“åº”å…·ä½“çš„äº¤äº’

ç«™åœ¨ç”¨æˆ·çš„è§’åº¦æ¥çœ‹ï¼Œå‘é€ä¿¡æ¯åº”è¯¥æ˜¯å› ä¸ºç‚¹å‡»äº†ç‰¹å®šçš„å‘é€æŒ‰é’®ï¼Œå¦‚æœä½ åœ¨ä»»ä½•å…¶ä»–æ—¶é—´æˆ–å¤„äºä»»ä½•å…¶ä»–åŸå› å‘ä»–ä»¬å‘é€æ¶ˆæ¯ï¼Œç”¨æˆ·ä¼šéå¸¸ä¸é«˜å…´ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå‘é€ä¿¡æ¯åº”è¯¥æ˜¯ä¸€ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºï¼Œäº‹ä»¶å¤„ç†ç¨‹åºè®©ä½ å¤„ç†ç‰¹å®šçš„äº¤äº’:

```javascript
function ChatRoom({ roomId }) {
  const [message, setMessage] = useState('');
  // ...
  function handleSendClick() {
    sendMessage(message);
  }
  // ...
  return (
    <>
      <input value={message} onChange={e => setMessage(e.target.value)} />
      <button onClick={handleSendClick}>Send</button>;
    </>
  );
}
```

ä½¿ç”¨äº‹ä»¶å¤„ç†ç¨‹åºï¼Œä½ å¯ä»¥ç¡®ä¿ sendMessage(message) ä»…åœ¨ç”¨æˆ·æŒ‰ä¸‹æŒ‰é’®æ—¶æ‰ä¼šè¿è¡Œ

## Effects åœ¨éœ€è¦åŒæ­¥æ—¶è¿è¡Œ

å›æƒ³ä¸€ä¸‹ï¼Œä½ è¿˜éœ€è¦ä¿æŒç»„ä»¶å’ŒèŠå¤©å®¤çš„è¿æ¥ï¼Œè¿™æ®µä»£ç åº”è¯¥æ”¾åœ¨å“ªï¼Ÿ

è¿è¡Œæ­¤ä»£ç çš„åŸå› ä¸æ˜¯æŸäº›ç‰¹å®šçš„äº¤äº’ï¼Œç”¨æˆ·ä¸ºä»€ä¹ˆå¯¼èˆªåˆ°èŠå¤©å®¤æˆ–å¦‚ä½•åˆ°çš„æ— å…³ç´§è¦ï¼Œä»–ä»¬å·²ç»åœ¨è®¿é—®å½“å‰é¡µé¢å¹¶ä¸ä¹‹äº¤äº’äº†ï¼Œé‡è¦çš„æ˜¯ç»„ä»¶è¦å’Œé€‰ä¸­çš„èŠå¤©å®¤ä¿æŒè¿æ¥ã€‚å³ä½¿èŠå¤©å®¤ç»„ä»¶æ˜¯ä½ åº”ç”¨çš„é¦–é¡µï¼Œè€Œä¸”ç”¨æˆ·æ ¹æœ¬æ²¡æœ‰æ‰§è¡Œä»»ä½•äº¤äº’ï¼Œä½ ä»ç„¶éœ€è¦é“¾æ¥åˆ°èŠå¤©å®¤ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒæ˜¯ä¸€ä¸ª Effect:

```javascript
function ChatRoom({ roomId }) {
  // ...
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => {
      connection.disconnect();
    };
  }, [roomId]);
  // ...
}
```

æœ‰äº†è¿™æ®µä»£ç ï¼Œä½ å°±å¯ä»¥ç¡®ä¿å’Œå½“å‰é€‰ä¸­çš„èŠå¤©æœåŠ¡å™¨å§‹ç»ˆæœ‰ä¸€ä¸ªæ´»è·ƒè¿æ¥ï¼Œæ— è®ºç”¨æˆ·æ‰§è¡Œäº†ä»€ä¹ˆç‰¹å®šçš„äº¤äº’ã€‚æ— è®ºç”¨æˆ·åªæ˜¯æ‰“å¼€äº†ä½ çš„åº”ç”¨ï¼Œé€‰æ‹©äº†ä¸åŒçš„æˆ¿é—´ï¼Œè¿˜æ˜¯è·³è½¬åˆ°å…¶ä»–é¡µé¢ç„¶åè¿”å›ï¼Œä½ çš„ Effect ä¿è¯äº†å§‹ç»ˆä¸å½“å‰é€‰æ‹©çš„æˆ¿é—´ä¿æŒåŒæ­¥ï¼Œå¹¶åœ¨å¿…è¦æ—¶é‡æ–°è¿æ¥

```javascript app.js
import { useState, useEffect } from 'react';
import { createConnection, sendMessage } from './chat.js';

const serverUrl = 'https://localhost:1234';

function ChatRoom({ roomId }) {
  const [message, setMessage] = useState('');

  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => connection.disconnect();
  }, [roomId]);

  function handleSendClick() {
    sendMessage(message);
  }

  return (
    <>
      <h1>Welcome to the {roomId} room!</h1>
      <input value={message} onChange={e => setMessage(e.target.value)} />
      <button onClick={handleSendClick}>Send</button>
    </>
  );
}

export default function App() {
  const [roomId, setRoomId] = useState('general');
  const [show, setShow] = useState(false);
  return (
    <>
      <label>
        Choose the chat room:{' '}
        <select
          value={roomId}
          onChange={e => setRoomId(e.target.value)}
        >
          <option value="general">general</option>
          <option value="travel">travel</option>
          <option value="music">music</option>
        </select>
      </label>
      <button onClick={() => setShow(!show)}>
        {show ? 'Close chat' : 'Open chat'}
      </button>
      {show && <hr />}
      {show && <ChatRoom roomId={roomId} />}
    </>
  );
}

```

```javascript chat.js
export function sendMessage(message) {
  console.log('ğŸ”µ You sent: ' + message);
}

export function createConnection(serverUrl, roomId) {
  // A real implementation would actually connect to the server
  return {
    connect() {
      console.log('âœ… Connecting to "' + roomId + '" room at ' + serverUrl + '...');
    },
    disconnect() {
      console.log('âŒ Disconnected from "' + roomId + '" room at ' + serverUrl);
    }
  };
}

```

## å“åº”å¼çš„å€¼å’Œé€»è¾‘

ç›´è§‚çš„è¯´ï¼Œä½ å¯ä»¥è¯´äº‹ä»¶å¤„ç†ç¨‹åºæ€»æ˜¯æ‰‹åŠ¨è§¦å‘çš„ï¼Œæ¯”å¦‚é€šè¿‡ç‚¹å‡»äº‹ä»¶ï¼›å¦ä¸€æ–¹é¢ï¼ŒEffect æ˜¯è‡ªåŠ¨çš„ï¼Œå®ƒä»¬ä¼šæ ¹æ®éœ€è¦è‡ªåŠ¨è¿è¡Œå’Œé‡æ–°è¿è¡Œã€‚

æœ‰ä¸ªæ›´ç²¾ç¡®çš„æ–¹æ³•æ¥æ€è€ƒè¿™ä¸ªé—®é¢˜

propsã€stateå’Œå…¶ä»–ç»„ä»¶å†…éƒ¨å£°æ˜çš„å˜é‡è¢«ç§°ä¸ºå“åº”å¼å€¼ï¼Œè¿™ä¸ªä¾‹å­ä¸­ï¼ŒserverUrl ä¸æ˜¯å“åº”å¼çš„å€¼ï¼Œä½†æ˜¯ roomId å’Œ message æ˜¯ï¼Œä»–ä»¬å‚ä¸äº†æ¸²æŸ“æ•°æ®æµ:

```javascript
const serverUrl = 'https://localhost:1234';

function ChatRoom({ roomId }) {
  const [message, setMessage] = useState('');

  // ...
}
```

ç”±äºé‡æ–°æ¸²æŸ“ï¼Œåƒè¿™æ ·çš„ååº”å¼çš„å€¼å¯èƒ½ä¼šå˜åŒ–ï¼Œä¾‹å¦‚ï¼Œç”¨æˆ·å¯ä»¥ç¼–è¾‘ message æˆ–åœ¨ä¸‹æ‹‰æ¡†ä¸­é€‰æ‹©ä¸€ä¸ªä¸åŒçš„ roomIdï¼Œäº‹ä»¶å¤„ç†ç¨‹åºå’Œ Effects ä»¥ä¸åŒçš„æ–¹å¼å“åº”å˜åŒ–:

- äº‹ä»¶å¤„ç†ç¨‹åºå†…éƒ¨çš„é€»è¾‘ä¸æ˜¯å“åº”å¼çš„ï¼Œé™¤éç”¨æˆ·å†æ¬¡æ‰§è¡Œç›¸åŒçš„äº¤äº’ï¼Œå¦åˆ™å®ƒä»¬ä¸ä¼šå†æ¬¡è¿è¡Œã€‚äº‹ä»¶å¤„ç†ç¨‹åºå¯ä»¥è¯»å–å“åº”å¼çš„å€¼è€Œæ— éœ€å¯¹å…¶å˜åŒ–åšå‡ºå“åº”
- Effects å†…éƒ¨çš„é€»è¾‘æ˜¯å“åº”å¼çš„ï¼Œå¦‚æœ Effect è¯»å–äº†ä¸€ä¸ªå“åº”å¼çš„å€¼ï¼Œä½ å¿…é¡»å°†å…¶æŒ‡å®šä¸ºä¾èµ–é¡¹ã€‚ç„¶åå¦‚æœé‡æ–°æ¸²æŸ“æ—¶è¯¥å€¼å‘ç”Ÿäº†å˜åŒ–ï¼ŒReact å°†ç”¨æ–°å€¼å†æ¬¡è¿è¡Œ Effect çš„é€»è¾‘ã€‚

å†æ¬¡çœ‹çœ‹ä¹‹å‰çš„ä¾‹å­æ¥æ„Ÿå—è¿™ä¸ªä¸åŒ

### äº‹ä»¶å¤„ç†ç¨‹åºå†…éƒ¨çš„é€»è¾‘ä¸æ˜¯å“åº”å¼çš„

çœ‹çœ‹è¿™è¡Œä»£ç ï¼Œå®ƒåº”è¯¥æ˜¯å“åº”å¼çš„å—ï¼Ÿ

```javascript
sendMessage(message);
```

ä»ç”¨æˆ·çš„è§†è§’æ¥çœ‹ï¼Œmessage çš„å˜åŒ–å¹¶ä¸æ„å‘³ç€ä»–ä»¬æƒ³å‘é€ä¿¡æ¯ï¼Œå®ƒä»…è¡¨ç¤ºç”¨æˆ·æ­£åœ¨è¾“å…¥ã€‚æ¢å¥è¯è¯´ï¼Œå‘é€ä¿¡æ¯çš„é€»è¾‘ä¸åº”è¯¥æ˜¯å“åº”å¼çš„ï¼Œä»–ä¸åº”è¯¥ä»…ä»…å› ä¸ºå“åº”å¼çš„å€¼å˜äº†å°±å†æ¬¡è¿è¡Œï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒå±äºäº‹ä»¶å¤„ç†ç¨‹åºçš„åŸå› :

```javascript
function handleSendClick() {
  sendMessage(message);
}
```

äº‹ä»¶å¤„ç†ç¨‹åºä¸æ˜¯å“åº”å¼çš„ï¼Œæ‰€ä»¥åªæœ‰å½“ç”¨æˆ·ç‚¹å‡»å‘é€æŒ‰é’®æ—¶ï¼ŒsendMessage æ‰ä¼šè¿è¡Œ

### Effects å†…éƒ¨çš„é€»è¾‘æ˜¯å“åº”å¼çš„

å†çœ‹çœ‹è¿™äº›ä»£ç :

```javascript
const connection = createConnection(serverUrl, roomId);
connection.connect();
```

ä»ç”¨æˆ·çš„è§†è§’æ¥çœ‹ï¼Œæ›´æ”¹ roomId ç¡®å®æ„å‘³ç€ä»–ä»¬æƒ³è¿æ¥åˆ°ä¸åŒçš„èŠå¤©å®¤ã€‚æ¢å¥è¯è¯´ï¼Œè¿æ¥åˆ°èŠå¤©å®¤çš„é€»è¾‘åº”è¯¥æ˜¯å“åº”å¼çš„ï¼Œä½ å¸Œæœ›è¿™äº›ä»£ç çš„è¿è¡Œèƒ½è·Ÿå¾—ä¸Šå“åº”å¼çš„å€¼ï¼Œå¹¶ä¸”å½“è¯¥å€¼å˜åŒ–æ—¶å†æ¬¡è¿è¡Œã€‚è¿™å°±æ˜¯å®ƒå±äº Effect çš„åŸå› :

```javascript
 useEffect(() => {
  const connection = createConnection(serverUrl, roomId);
  connection.connect();
  return () => {
    connection.disconnect()
  };
}, [roomId]);
```

Effects æ˜¯å“åº”å¼çš„ï¼Œæ‰€ä»¥ `createConnection(serverUrl, roomId)` å’Œ `connection.connect()` ä¼šåœ¨æ¯æ¬¡ roomId çš„å€¼å˜åŒ–æ—¶è¿è¡Œï¼ŒEffects ä¿æŒäº†èŠå¤©å®¤çš„è¿æ¥å’Œå½“å‰é€‰ä¸­æˆ¿é—´ id çš„åŒæ­¥ã€‚

## ä» Effects ä¸­åˆ†ç¦»éå“åº”å¼çš„é€»è¾‘

å½“ä½ æƒ³å°†å“åº”å¼é€»è¾‘å’Œéå“åº”å¼é€»è¾‘æ··åˆæ—¶ï¼Œäº‹æƒ…ä¼šå˜å¾—æ›´åŠ æ£˜æ‰‹.

ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ä½ æƒ³åœ¨ç”¨æˆ·è¿æ¥åˆ°èŠå¤©å®¤æ—¶å±•ç¤ºä¸€ä¸ªé€šçŸ¥ï¼Œä½ ä» props ä¸­è¯»å–å½“å‰çš„ä¸»é¢˜ï¼Œä»¥ä¾¿ä»¥æ­£ç¡®çš„é¢œè‰²æ˜¾ç¤ºé€šçŸ¥:

```javascript
function ChatRoom({ roomId, theme }) {
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.on('connected', () => {
      showNotification('Connected!', theme);
    });
    connection.connect();
    // ...
```

ç„¶è€Œï¼Œtheme æ˜¯ä¸€ä¸ªå“åº”å¼çš„å€¼ï¼Œæ‰€ä»¥ä½ éœ€è¦æŒ‡å®š theme ä½œä¸º Effect çš„ä¸€ä¸ªä¾èµ–é¡¹:

```javascript
function ChatRoom({ roomId, theme }) {
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.on('connected', () => {
      showNotification('Connected!', theme);
    });
    connection.connect();
    return () => {
      connection.disconnect()
    };
  }, [roomId, theme]); // âœ… All dependencies declared
  // ...
```

å°è¯•ä¸‹é¢çš„ä¾‹å­çœ‹çœ‹ä½ èƒ½å¦å‘ç°é—®é¢˜:

```javascript App.js
import { useState, useEffect } from 'react';
import { createConnection, sendMessage } from './chat.js';
import { showNotification } from './notifications.js';

const serverUrl = 'https://localhost:1234';

function ChatRoom({ roomId, theme }) {
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.on('connected', () => {
      showNotification('Connected!', theme);
    });
    connection.connect();
    return () => connection.disconnect();
  }, [roomId, theme]);

  return <h1>Welcome to the {roomId} room!</h1>
}

export default function App() {
  const [roomId, setRoomId] = useState('general');
  const [isDark, setIsDark] = useState(false);
  return (
    <>
      <label>
        Choose the chat room:{' '}
        <select
          value={roomId}
          onChange={e => setRoomId(e.target.value)}
        >
          <option value="general">general</option>
          <option value="travel">travel</option>
          <option value="music">music</option>
        </select>
      </label>
      <label>
        <input
          type="checkbox"
          checked={isDark}
          onChange={e => setIsDark(e.target.checked)}
        />
        Use dark theme
      </label>
      <hr />
      <ChatRoom
        roomId={roomId}
        theme={isDark ? 'dark' : 'light'}
      />
    </>
  );
}
```

```javascript chat.js
export function createConnection(serverUrl, roomId) {
  // A real implementation would actually connect to the server
  let connectedCallback;
  let timeout;
  return {
    connect() {
      timeout = setTimeout(() => {
        if (connectedCallback) {
          connectedCallback();
        }
      }, 100);
    },
    on(event, callback) {
      if (connectedCallback) {
        throw Error('Cannot add the handler twice.');
      }
      if (event !== 'connected') {
        throw Error('Only "connected" event is supported.');
      }
      connectedCallback = callback;
    },
    disconnect() {
      clearTimeout(timeout);
    }
  };
}

```

```javascript notification.js
import Toastify from 'toastify-js';
import 'toastify-js/src/toastify.css';

export function showNotification(message, theme) {
  Toastify({
    text: message,
    duration: 2000,
    gravity: 'top',
    position: 'right',
    style: {
      background: theme === 'dark' ? 'black' : 'white',
      color: theme === 'dark' ? 'white' : 'black',
    },
  }).showToast();
}

```

å½“ roomId å˜äº†æ—¶ï¼ŒèŠå¤©å®¤ä¼šå’Œä½ æœŸæœ›ä¸€æ ·çš„é‡è¿ã€‚ä½†æ˜¯ç”±äº theme ä¹Ÿæ˜¯ä¸€ä¸ªä¾èµ–ï¼Œæ‰€ä»¥æ¯å½“ä½ åˆ‡æ¢ dark å’Œ light æ—¶ï¼ŒèŠå¤©å®¤ä¹Ÿä¼šé‡è¿ï¼Œè¿™æ˜¾ç„¶ä¸å¯¹ï¼

æ¢å¥è¯è¯´ï¼Œä½ ä¸æƒ³è¿™è¡Œä»£ç ä¹Ÿæ˜¯å“åº”å¼çš„ï¼Œå³ä½¿å®ƒåœ¨ Effect å†…éƒ¨:

```javascript
showNotification('Connected!', theme);
```

ä½ éœ€è¦ä¸€ç§åŠæ³•æ¥ä»å“åº”å¼çš„ Effect ä¸­åˆ†ç¦»å‡ºè¿™æ®µéå“åº”å¼ä»£ç 

## å£°æ˜ä¸€ä¸ª Effect Event

ä½¿ç”¨ä¸€ä¸ªæˆä¸º useEffectEvent çš„ç‰¹æ®Š Hook ä» Effect ä¸­åˆ†ç¦»å‡ºéå“åº”å¼é€»è¾‘:

```javascript
import { useEffect, useEffectEvent } from 'react';

function ChatRoom({ roomId, theme }) {
  const onConnected = useEffectEvent(() => {
    showNotification('Connected!', theme);
  });
  // ...
```

è¿™é‡Œçš„ onConnected è¢«ç§°ä¸º Effect Eventï¼Œå®ƒæ˜¯ Effect é€»è¾‘çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯å…¶è¡¨ç°æ›´åƒæ˜¯ä¸€ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºã€‚å…¶ä¸­çš„é€»è¾‘ä¸æ˜¯å“åº”å¼çš„ï¼Œå¹¶ä¸”å®ƒæ€»æ˜¯èƒ½çœ‹åˆ° props å’Œ state çš„æœ€æ–°å€¼.

ç°åœ¨ä½ å¯ä»¥åœ¨ Effect ä¸­è°ƒç”¨ onConnect äº†:

```javascript
function ChatRoom({ roomId, theme }) {
  const onConnected = useEffectEvent(() => {
    showNotification('Connected!', theme);
  });

  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.on('connected', () => {
      onConnected();
    });
    connection.connect();
    return () => connection.disconnect();
  }, [roomId]); // âœ… All dependencies declared
  // ...
```

è¿™è§£å†³äº†é—®é¢˜ï¼Œæ³¨æ„ä½ éœ€è¦ä» Effect çš„ä¾èµ–é¡¹ä¸­ç§»é™¤ onConnectedï¼ŒEffect Events ä¸æ˜¯å“åº”å¼çš„ï¼Œæ‰€ä»¥å¿…é¡»è¦ä»ä¾èµ–é¡¹ä¸­ç§»é™¤:

æ£€æŸ¥ä¸‹é¢çš„è¡Œä¸ºæ˜¯å¦ç¬¦åˆé¢„æœŸ:

```javascript app.js
import { useState, useEffect } from 'react';
import { experimental_useEffectEvent as useEffectEvent } from 'react';
import { createConnection, sendMessage } from './chat.js';
import { showNotification } from './notifications.js';

const serverUrl = 'https://localhost:1234';

function ChatRoom({ roomId, theme }) {
  const onConnected = useEffectEvent(() => {
    showNotification('Connected!', theme);
  });

  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.on('connected', () => {
      onConnected();
    });
    connection.connect();
    return () => connection.disconnect();
  }, [roomId]);

  return <h1>Welcome to the {roomId} room!</h1>
}

export default function App() {
  const [roomId, setRoomId] = useState('general');
  const [isDark, setIsDark] = useState(false);
  return (
    <>
      <label>
        Choose the chat room:{' '}
        <select
          value={roomId}
          onChange={e => setRoomId(e.target.value)}
        >
          <option value="general">general</option>
          <option value="travel">travel</option>
          <option value="music">music</option>
        </select>
      </label>
      <label>
        <input
          type="checkbox"
          checked={isDark}
          onChange={e => setIsDark(e.target.checked)}
        />
        Use dark theme
      </label>
      <hr />
      <ChatRoom
        roomId={roomId}
        theme={isDark ? 'dark' : 'light'}
      />
    </>
  );
}

```

```javascript chat.js
export function createConnection(serverUrl, roomId) {
  // A real implementation would actually connect to the server
  let connectedCallback;
  let timeout;
  return {
    connect() {
      timeout = setTimeout(() => {
        if (connectedCallback) {
          connectedCallback();
        }
      }, 100);
    },
    on(event, callback) {
      if (connectedCallback) {
        throw Error('Cannot add the handler twice.');
      }
      if (event !== 'connected') {
        throw Error('Only "connected" event is supported.');
      }
      connectedCallback = callback;
    },
    disconnect() {
      clearTimeout(timeout);
    }
  };
}

```

ä½ å¯ä»¥è®¤ä¸º Effect Events å’Œäº‹ä»¶å¤„ç†ç¨‹åºæ˜¯éå¸¸ç±»ä¼¼çš„ï¼Œä¸»è¦ç»„åˆ«åœ¨äºäº‹ä»¶å¤„ç†ç¨‹åºç”¨äºå“åº”ç”¨æˆ·äº¤äº’ï¼Œè€Œ Effect Events æ˜¯ç”±ä½ åœ¨ Effect ä¸­è§¦å‘çš„ã€‚Effect Events è®©ä½ æ‰“ç ´äº† Effects ä¸­çš„å“åº”å¼å’Œéå“åº”å¼ä»£ç ä¹‹é—´çš„é“¾æ¡

## ä½¿ç”¨ Effect Event è¯»å–æœ€æ–°çš„ props å’Œ state

Effect Events è®©ä½ å¯ä»¥ä¿®å¤å¾ˆå¤šä½ å¯èƒ½æƒ³ä¸€ç›´çš„ linter é—®é¢˜

ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ä½ æƒ³åœ¨ useEffect ä¸­æ‰“å°é¡µé¢è®¿é—®:

```javascript
function Page() {
  useEffect(() => {
    logVisit();
  }, []);
  // ...
}
```

éšåä½ ä¸ºç½‘ç«™æ·»åŠ äº†å¤šä¸ªè·¯ç”±ï¼Œç°åœ¨çš„ Page ç»„ä»¶æ¥å£ä¸€ä¸ª url å¹¶å¸¦æœ‰å½“å‰è·¯å¾„ï¼Œä½ å¸Œæœ›å°† url ä½œä¸ºå‚æ•°è°ƒç”¨ logVisitï¼Œä½†æ˜¯ linter ä¼šä¸ºä¾èµ–é¡¹æŒ‡å‡ºä¸€ä¸ªé”™è¯¯:

```javascript
function Page({ url }) {
  useEffect(() => {
    logVisit(url);
  }, []); // ğŸ”´ React Hook useEffect has a missing dependency: 'url'
  // ...
}
```

æƒ³æƒ³ä½ æƒ³è®©ä»£ç åšä»€ä¹ˆï¼Œä½ å¸Œæœ›ä¸ºä¸åŒçš„ URL è®°å½•å•ç‹¬çš„è®¿é—®ï¼Œå› ä¸ºæ¯ä¸ª URL ä»£è¡¨ä¸€ä¸ªç‹¬ç«‹çš„é¡µé¢ã€‚æ¢å¥è¯è¯´ï¼Œè¿™ä¸ª logVisit åº”è¯¥ä»…å¯¹ url æ˜¯å“åº”å¼çš„ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿™ä¸ªæ¡ˆä¾‹ä¸­éµå¾ª linter çš„è§„åˆ™å¹¶å°† url æ·»åŠ åˆ°ä¾èµ–é¡¹ä¸­æ˜¯æœ‰æ„ä¹‰çš„:

```javascript
function Page({ url }) {
  useEffect(() => {
    logVisit(url);
  }, [url]); // âœ… All dependencies declared
  // ...
}
```

ç°åœ¨å‡è®¾ä½ æƒ³åœ¨æ¯æ¬¡é¡µé¢è®¿é—®æ—¶ï¼Œå°†è´­ç‰©è½¦ä¸­å•†å“æ•°é‡ä¸€å¹¶åˆ—å…¥:

```javascript
function Page({ url }) {
  const { items } = useContext(ShoppingCartContext);
  const numberOfItems = items.length;

  useEffect(() => {
    logVisit(url, numberOfItems);
  }, [url]); // ğŸ”´ React Hook useEffect has a missing dependency: 'numberOfItems'
  // ...
}
```

ä½ åœ¨ Effect å†…éƒ¨ä½¿ç”¨äº† numberOfItemsï¼Œæ‰€ä»¥ linter è¦æ±‚ä½ å°†å…¶æ·»åŠ åˆ°ä¾èµ–é¡¹ä¸­ï¼Œç„¶è€Œï¼Œä½ å¹¶ä¸æƒ³ logVisit åœ¨ numberOrItems å˜åŒ–æ—¶åšå‡ºå“åº”ï¼Œå¦‚æœç”¨æˆ·å°†æŸäº›ä¸œè¥¿åŠ åˆ°äº†è´­ç‰©è½¦ï¼Œç„¶å numberOfItems å˜äº†ï¼Œè¿™å¹¶ä¸æ„å‘³ç€ç”¨æˆ·å†æ¬¡è®¿é—®äº†é¡µé¢ã€‚æ¢å¥è¯è¯´ï¼Œè®¿é—®é¡µé¢æŸç§æ„ä¹‰ä¸Šæ˜¯ä¸€ä¸ªäº‹ä»¶ï¼Œå®ƒå‘ç”Ÿåœ¨ä¸€ä¸ªå‡†ç¡®çš„æ—¶é—´ç‚¹

å°†ä»£ç åˆ†æˆä¸¤éƒ¨åˆ†:

```javascript
function Page({ url }) {
  const { items } = useContext(ShoppingCartContext);
  const numberOfItems = items.length;

  const onVisit = useEffectEvent(visitedUrl => {
    logVisit(visitedUrl, numberOfItems);
  });

  useEffect(() => {
    onVisit(url);
  }, [url]); // âœ… All dependencies declared
  // ...
}
```

è¿™é‡Œçš„ onVisit æ˜¯ Effect Eventï¼Œå…¶ä¸­çš„ä»£ç ä¸æ˜¯å“åº”å¼çš„ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ å¯ä»¥ç”¨ numberOfItems è€Œæ— éœ€æ‹…å¿ƒå®ƒçš„å˜åŒ–å¯¼è‡´å‘¨å›´çš„ä»£ç å†æ¬¡è¿è¡Œã€‚

å¦ä¸€æ–¹é¢ï¼ŒEffect æœ¬èº«ä¿æŒäº†å“åº”å¼ï¼ŒEffect ä¸­çš„ä»£ç ç”¨äº† urlï¼Œå¦‚æœ Effect åœ¨æ¯æ¬¡é‡æ–°æ¸²æŸ“åé‡åˆ°ä¸åŒçš„ urléƒ½ä¼šå†æ¬¡è¿è¡Œï¼Œåè¿‡æ¥ï¼Œè¿™å°†è°ƒç”¨ onVisit Effect Event

å› æ­¤ï¼Œurl çš„æ¯æ¬¡å˜æ›´éƒ½ä¼šè°ƒç”¨ logVisitï¼Œå¹¶å§‹ç»ˆè¯»å–æœ€æ–°çš„ numberOfItemsï¼Œç„¶è€Œ numberOfItems çš„å˜åŒ–ä¸ä¼šå¯¼è‡´ä»£ç çš„å†æ¬¡è¿è¡Œ

TODO: TRANSLATE

## Effect Events çš„é™åˆ¶

Effect Events çš„ä½¿ç”¨éå¸¸å—é™:

- åªèƒ½åœ¨ Effects ä¸­è°ƒç”¨
- ä¸èƒ½å°†å®ƒä»¬ä¼ é€’ç»™å…¶ä»–ç»„ä»¶æˆ– Hooks

ä¸¾ä¸ªä¾‹å­ï¼Œä¸èƒ½ç”¨è¿™ç§æ–¹å¼å£°æ˜å’Œä¼ é€’ Effect Eventï¼š

```javascript
function Timer() {
  const [count, setCount] = useState(0);

  const onTick = useEffectEvent(() => {
    setCount(count + 1);
  });

  useTimer(onTick, 1000); // ğŸ”´ Avoid: Passing Effect Events

  return <h1>{count}</h1>
}

function useTimer(callback, delay) {
  useEffect(() => {
    const id = setInterval(() => {
      callback();
    }, delay);
    return () => {
      clearInterval(id);
    };
  }, [delay, callback]); // Need to specify "callback" in dependencies
}
```

è€Œæ˜¯æ°¸è¿œåœ¨ Effect ä¸­å£°æ˜å¹¶ä½¿ç”¨å®ƒä»¬:

```javascript
function Timer() {
  const [count, setCount] = useState(0);
  useTimer(() => {
    setCount(count + 1);
  }, 1000);
  return <h1>{count}</h1>
}

function useTimer(callback, delay) {
  const onTick = useEffectEvent(() => {
    callback();
  });

  useEffect(() => {
    const id = setInterval(() => {
      onTick(); // âœ… Good: Only called locally inside an Effect
    }, delay);
    return () => {
      clearInterval(id);
    };
  }, [delay]); // No need to specify "onTick" (an Effect Event) as a dependency
}
```

Effect Events æ˜¯ä½ çš„ Effect ä»£ç ä¸­éå“åº”å¼çš„éƒ¨åˆ†ï¼Œå®ƒä»¬åº”è¯¥åœ¨ Effect ä¸­

## å›é¡¾

- äº‹ä»¶å¤„ç†ç¨‹åºæ˜¯ç‰¹å®šäº¤äº’çš„å“åº”
- éœ€è¦åŒæ­¥æ—¶ Effects å°±ä¼šè¿è¡Œ
- äº‹ä»¶å¤„ç†ç¨‹åºå†…éƒ¨çš„é€»è¾‘ä¸æ˜¯å“åº”å¼çš„
- Effect å†…éƒ¨çš„é€»è¾‘æ˜¯å“åº”å¼çš„
- ä½ å¯ä»¥å°† Effects ä¸­çš„éå“åº”å¼é€»è¾‘ç§»åŠ¨åˆ° Effect Events ä¸­
- åªèƒ½åœ¨ Effect ä¸­è°ƒç”¨ Effect Events
- ä¸è¦å°† Effect Event ä¼ é€’ç»™å…¶ä»–ç»„ä»¶æˆ– Hooks