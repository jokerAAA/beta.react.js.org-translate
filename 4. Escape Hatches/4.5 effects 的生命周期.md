
Effect çš„ç”Ÿå‘½å‘¨æœŸå’Œç»„ä»¶ä¸åŒï¼Œç»„ä»¶å¯èƒ½ä¼šæŒ‚è½½ã€æ›´æ–°æˆ–å¸è½½ï¼Œè€Œ Effect åªèƒ½åšä¸¤ä»¶äº‹: å¼€å§‹åŒæ­¥æŸäº›ä¸œè¥¿æˆ–éšååœæ­¢åŒæ­¥ã€‚å¦‚æœ Effect ä¾èµ–çš„ state å’Œ prop éšæ—¶é—´å˜åŒ–æ—¶ï¼Œè¿™ä¸ªå¾ªç¯å¯èƒ½ä¼šå‘ç”Ÿå¾ˆå¤šæ¬¡ã€‚React æä¾›äº†ä¸€ä¸ª linter è§„åˆ™æ¥æ£€æŸ¥ Effect çš„ä¾èµ–æ˜¯å¦æ­£ç¡®ï¼Œè¿™ç¡®ä¿äº† Effect å’Œæœ€æ–°çš„ state å’Œ props ä¿æŒåŒæ­¥

> ä½ å°†å­¦åˆ°:
> - Effect å’Œç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ 
> - æ€ä¹ˆå­¤ç«‹çš„è€ƒè™‘æ¯ä¸ªå•ç‹¬çš„ Effect
> - ä½•æ—¶éœ€è¦åŒæ­¥ Effect ä»¥åŠä¸ºä»€ä¹ˆ
> - å¦‚ä½•ç¡®å®š Effect çš„ä¾èµ–
> - ä»€ä¹ˆæ˜¯å“åº”å¼å€¼
> - ä¾èµ–ä¸ºç©ºæ•°ç»„è¡¨ç¤ºä»€ä¹ˆ
> - React å¦‚ä½•ç”¨ linter æ¥éªŒè¯ä½ çš„ä¾èµ–æ˜¯å¦æ­£ç¡®
> - å½“ä½ ä¸åŒæ„ linter æ—¶æ€ä¹ˆåŠ

## Effect çš„ç”Ÿå‘½å‘¨æœŸ

æ¯ä¸ª React ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸéƒ½æ˜¯ç›¸åŒçš„:

1. å½“ç»„ä»¶è¢«æ·»åŠ åˆ°å±å¹•ä¸Šæ—¶è¿›è¡Œ*æŒ‚è½½*
2. å½“ç»„ä»¶æ¥å—åˆ°æ–°çš„ props æˆ– state æ—¶è¿›è¡Œ*æ›´æ–°*ï¼Œä¸€èˆ¬ç”¨äºå“åº”ç”¨æˆ·äº¤äº’
3. å½“ç»„ä»¶ä»å±å¹•ä¸Šç§»é™¤æ—¶è¿›è¡Œ*å¸è½½*

è¿™æ˜¯è€ƒè™‘ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„ä¸€ç§å¥½æ–¹å¼ï¼Œä½†ä¸é€‚ç”¨äº Effectã€‚ç›¸åï¼Œå°è¯•ç‹¬ç«‹äºç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸæ¥è€ƒè™‘æ¯ä¸ª Effectã€‚Effect æè¿°äº†å¦‚ä½•å°†å¤–éƒ¨ç³»ç»Ÿä¸å½“å‰çš„ props å’Œ state åŒæ­¥ï¼Œè€Œéšç€ä½ ä»£ç çš„æ›´æ”¹ï¼ŒåŒæ­¥ä¼šæˆ–å¤šæˆ–å°‘çš„å‘ç”Ÿã€‚

ä¸ºäº†æ­ç¤ºè¿™ä¸€ç‚¹ï¼Œæ€è€ƒä¸‹é¢çš„ä¾‹å­çš„ Effectï¼Œå®ƒå°†ä½ çš„ç»„ä»¶è¿æ¥åˆ°èŠå¤©å®¤:

```javascript
const serverUrl = 'https://localhost:1234';

function ChatRoom({ roomId }) {
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => {
      connection.disconnect();
    };
  }, [roomId]);
  // ...
}
```

åœ¨ Effect å†…éƒ¨æŒ‡å®šäº†å¦‚ä½•å¼€å§‹åŒæ­¥:

```javascript
const connection = createConnection(serverUrl, roomId);
connection.connect();
return () => {
  connection.disconnect();
};
```

è€Œæ¸…ç†å‡½æ•°ä¸­æŒ‡å®šå¦‚ä½•åœæ­¢åŒæ­¥:

```javascript
const connection = createConnection(serverUrl, roomId);
connection.connect();
return () => {
  connection.disconnect();
};
```

ç›´è§‰ä¸Šï¼Œä½ å¯èƒ½ä¼šè®¤ä¸º React åœ¨ç»„ä»¶æŒ‚è½½æ—¶å¼€å§‹åŒæ­¥ï¼Œåœ¨å¸è½½æ—¶åœæ­¢åŒæ­¥ã€‚ç„¶è€Œï¼Œè¿™å¹¶ä¸æ˜¯çœŸç›¸ï¼Œå½“ç»„ä»¶ä¿æŒæŒ‚è½½çŠ¶æ€æ—¶ï¼Œå¤šæ¬¡åŒæ­¥å’Œåœæ­¢åŒæ­¥å¯èƒ½ä¹Ÿæ˜¯å¿…è¦çš„.

è®©æˆ‘ä»¬çœ‹çœ‹ä¸ºä»€ä¹ˆè¿™æ˜¯å¿…è¦çš„ï¼Œä½•æ—¶å‘ç”Ÿï¼Œä»¥åŠå¦‚ä½•æ§åˆ¶è¿™ç§è¡Œä¸ºã€‚

## ä¸ºä»€ä¹ˆåŒæ­¥å¯èƒ½å‘ç”Ÿå¤šæ¬¡

å‡è®¾ä¸‹é¢çš„ `ChatRoom` ç»„ä»¶æ¥å—ä¸€ä¸ª `roomId` propï¼Œå®ƒæ˜¯ç”±ç”¨æˆ·åœ¨ä¸‹æ‹‰æ¡†ä¸­é€‰ä¸­çš„å€¼ã€‚å‡è®¾ç”¨æˆ·å¼€å§‹é€‰ä¸­äº† `general` ä½œä¸º `roomId`ï¼Œåº”ç”¨ä¼šå±•ç¤º `general` èŠå¤©å®¤ï¼š

```javascript
const serverUrl = 'https://localhost:1234';

function ChatRoom({ roomId /* "general" */ }) {
  // ...
  return <h1>Welcome to the {roomId} room!</h1>;
}
```

åœ¨ç•Œé¢å±•ç¤ºåï¼ŒReact ä¼šè¿è¡Œ `Effect` å¼€å§‹åŒæ­¥ï¼Œç„¶åè¿æ¥åˆ° `general` èŠå¤©å®¤:

```javascript
function ChatRoom({ roomId /* "general" */ }) {
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId); // Connects to the "general" room
    connection.connect();
    return () => {
      connection.disconnect(); // Disconnects from the "general" room
    };
  }, [roomId]);
}
```

æˆªè‡³ç›®å‰ä¸€åˆ‡æ­£å¸¸ã€‚

éšåç”¨æˆ·åœ¨ä¸‹æ‹‰æ¡†ä¸­é€‰äº†ä¸€ä¸ªä¸åŒçš„èŠå¤©å®¤ï¼Œæ¯”å¦‚ `travel`ï¼Œé¦–å…ˆ React ä¼šæ›´æ–° UI:

```javascript
function ChatRoom({ roomId /* "travel" */ }) {
  // ...
  return <h1>Welcome to the {roomId} room!</h1>;
}
```

è€ƒè™‘æ¥ä¸‹æ¥ä¼šå‘ç”Ÿä»€ä¹ˆã€‚ç”¨æˆ·çœ‹åˆ°äº†ç•Œé¢ä¸­ `travel` è¢«é€‰ä¸­ä¸ºèŠå¤©å®¤ï¼Œç„¶è€Œä¸Šä¸€æ¬¡è¿è¡Œ Effect åï¼Œåº”ç”¨ä»ç„¶ä¸ `general` èŠå¤©å®¤ä¿æŒç€è¿æ¥ï¼Œ`roomId` å·²ç»å˜äº†ï¼Œæ‰€ä»¥ä¹‹å‰çš„ Effect å·²ç»å’Œ UI ä¸åŒ¹é…äº†ã€‚

è¿™æ—¶å€™ä½ å¸Œæœ› React åšä¸¤ä»¶äº‹:

1. åœæ­¢å’Œæ—§çš„ `roomId` åŒæ­¥
2. å¼€å§‹å’Œæ–°çš„ `roomId` åŒæ­¥

å¹¸è¿çš„æ˜¯ï¼Œä½ å·²ç»å‘Šè¯‰è¿‡ React åšè¿™äº›äº†ï¼Effect æŒ‡å®šäº†å¦‚ä½•å¼€å§‹åŒæ­¥ï¼Œè€Œå…¶æ¸…ç†å‡½æ•°æŒ‡å®šäº†å¦‚ä½•åœæ­¢åŒæ­¥ã€‚React ç°åœ¨è¦åšçš„å°±æ˜¯ç”¨æ­£ç¡®çš„é¡ºåºè°ƒç”¨å®ƒä»¬ï¼Œå¹¶ä¼´ä»¥æ­£ç¡®çš„ props å’Œ stateã€‚è®©æˆ‘ä»¬çœ‹çœ‹æ˜¯å¦‚ä½•å‘ç”Ÿçš„

## React æ˜¯å¦‚ä½•ä¸ Effect åŒæ­¥çš„ 

å›æƒ³ä¸€ä¸‹ï¼Œ`ChatRoom` ç»„ä»¶å·²ç»æ”¶åˆ°å…¶ `roomId` çš„æ–°å€¼äº†ï¼Œå®ƒä¹‹å‰æ˜¯ `general`ï¼Œç°åœ¨æ˜¯ `travel`ï¼ŒReact éœ€è¦é‡æ–°åŒæ­¥ Effect ä»¥è¿æ¥åˆ°ä¸€ä¸ªä¸åŒçš„èŠå¤©å®¤ã€‚

è¦åœæ­¢åŒæ­¥ï¼ŒReact è¦è°ƒç”¨ Effect ä¸­è¿”å›çš„æ¸…ç†å‡½æ•°ï¼Œç”±äº `roomId` æ˜¯ `general`ï¼Œæ‰€ä»¥æ¸…ç†å‡½æ•°æ–­å¼€äº†ä¸ `general` èŠå¤©å®¤çš„è¿æ¥ã€‚

```javascript
function ChatRoom({ roomId /* "general" */ }) {
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId); // Connects to the "general" room
    connection.connect();
    return () => {
      connection.disconnect(); // Disconnects from the "general" room
    };
  })
}
```
ç„¶å React ä¼šåœ¨è¿™æ¬¡æ¸²æŸ“æ—¶è¿è¡Œ Effectï¼Œè¿™ä¸€æ¬¡ `roomId` æ˜¯ `travel`ï¼Œæ‰€ä»¥å®ƒå°†å¼€å§‹åŒæ­¥åˆ° `travel` èŠå¤©å®¤ï¼ˆç›´åˆ°å®ƒçš„æ¸…ç†å‡½æ•°æœ€ç»ˆä¹Ÿè¢«è°ƒç”¨ï¼‰ã€‚

```javascript
function ChatRoom({ roomId /* "travel" */ }) {
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId); // Connects to the "travel" room
    connection.connect();
    // ...
```

å› æ­¤ï¼Œç°åœ¨ä½ å·²ç»è¿æ¥åˆ°ç”¨æˆ·åœ¨ç•Œé¢ä¸­é€‰æ‹©çš„èŠå¤©å®¤äº†ï¼Œé—®é¢˜è§£å†³ï¼æ¯æ¬¡ä½ çš„ç»„ä»¶ç”¨ä¸åŒçš„ `roomId` æ¸²æŸ“æ—¶ï¼ŒEffect éƒ½ä¼šå†æ¬¡åŒæ­¥ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ç”¨æˆ·å°† `roomId` ä» `travel` ä¿®æ”¹ä¸º `music`ï¼ŒReact ä¼šå†æ¬¡è°ƒç”¨æ¸…ç†å‡½æ•°æ¥åœæ­¢åŒæ­¥ï¼Œç„¶åç”¨æ–°çš„ `roomId` è°ƒç”¨ Effect å¹¶å†æ¬¡åŒæ­¥

æœ€ç»ˆï¼Œå½“ç”¨æˆ·ç¦»å¼€å½“å‰é¡µé¢æ—¶ï¼Œ`ChatRoom` å¸è½½äº†ã€‚ç°åœ¨æ²¡å¿…è¦ç»§ç»­è¿æ¥äº†ï¼ŒReact æœ€åä¸€æ¬¡åœæ­¢ Effect çš„åŒæ­¥å¹¶æ–­å¼€äº†å’Œ `music` çš„è¿æ¥

## ä» Effect çš„è§†è§’æ€è€ƒ

è®©æˆ‘ä»¬ä» `ChatRoom` ç»„ä»¶è§†è§’å›é¡¾ä¸€ä¸‹å‘ç”Ÿçš„ä¸€åˆ‡:

1. `ChatRoom` æŒ‚è½½ï¼Œå°† `roomId` è®¾ä¸º `general`
2. `ChatRoom` æ›´æ–°ï¼Œå°† `roomId` è®¾ä¸º `travel`
3. `ChatRoom` æ›´æ–°ï¼Œå°† `roomId` è®¾ä¸º `music`
4. `ChatRoom` å¸è½½

åœ¨ç”Ÿå‘½å‘¨æœŸçš„æ¯ä¸ªé˜¶æ®µï¼ŒEffect éƒ½ä¼šåšä¸åŒçš„äº‹æƒ…:

1. è¿æ¥åˆ° `general` èŠå¤©å®¤
2. æ–­å¼€ä¸ `general` çš„è¿æ¥ï¼Œè¿æ¥åˆ° `travel`
3. æ–­å¼€ä¸ `travel` çš„è¿æ¥ï¼Œè¿æ¥åˆ° `music`
4. æ–­å¼€ä¸ `music` çš„è¿æ¥

ç°åœ¨è®©æˆ‘ä»¬ä» Effect çš„è§’åº¦æ¥æ€è€ƒå‘ç”Ÿäº†ä»€ä¹ˆ:

```javascript
 useEffect(() => {
    // Your Effect connected to the room specified with roomId...
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => {
      // ...until it disconnected
      connection.disconnect();
    };
  }, [roomId]);
```

è¿™æ®µä»£ç çš„ç»“æ„å¯èƒ½ä¼šå¯å‘ä½ å°†å‘ç”Ÿçš„äº‹æƒ…è§†ä¸ºä¸€ç³»åˆ—çš„ä¸é‡åˆæ—¶é—´æ®µ:

1. Effect è¿æ¥åˆ° `general`ï¼ˆç›´åˆ°æ–­å¼€ï¼‰
2. Effect è¿æ¥åˆ° `travel`ï¼ˆç›´åˆ°æ–­å¼€ï¼‰
3. Effect è¿æ¥åˆ° `music`ï¼ˆç›´åˆ°æ–­å¼€ï¼‰

ä¹‹å‰ä½ æ˜¯ä»ç»„ä»¶çš„è§’åº¦æ€è€ƒçš„ï¼Œå½“ä½ ä»ç»„ä»¶çš„è§’åº¦æ¥çœ‹æ—¶ï¼Œå¾ˆå®¹æ˜“å°† Effect è§†ä¸ºç‰¹å®šæ—¶é—´è§¦å‘çš„å›è°ƒå‡½æ•°æˆ–ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Œè¿™ç§æ€ç»´æ–¹å¼å¾ˆå¿«å°±å˜å¾—å¾ˆå¤æ‚ï¼Œæ‰€ä»¥æœ€å¥½ä¸è¦è¿™ä¹ˆæƒ³

ç›¸åï¼Œå§‹ç»ˆä¸“æ³¨äºå•æ¬¡å¼€å§‹åˆ°åœæ­¢çš„å¾ªç¯ï¼Œæ— è®ºç»„ä»¶åœ¨æŒ‚è½½ã€æ›´æ–°æˆ–å¸è½½éƒ½æ— å…³ç´§è¦ï¼Œä½ éœ€è¦å…³å¿ƒçš„ä»…ä»…æ˜¯æè¿°å¦‚ä½•å¼€å§‹åŒæ­¥å’Œå¦‚ä½•åœæ­¢åŒæ­¥ï¼Œå¦‚æœä½ åšå¥½äº†è¿™ä¸€ç‚¹ï¼Œä½ çš„ Effect å°†è§†å…¶éœ€è¦è‡ªåŠ¨å¼€å§‹æˆ–åœæ­¢

è¿™æˆ–è®¸è®©ä½ æƒ³èµ·äº†åœ¨ç¼–å†™ JSX çš„æ¸²æŸ“é€»è¾‘æ—¶ï¼Œä½ æ— éœ€è€ƒè™‘ç»„ä»¶æ˜¯åœ¨æŒ‚è½½è¿˜æ˜¯æ›´æ–°ã€‚åªè¦æè¿°æ¸…æ¥šå±å¹•ä¸Šåº”è¯¥æ˜¾ç¤ºä»€ä¹ˆï¼ŒReact ä¼šå¤„ç†å‰©ä¸‹çš„éƒ¨åˆ†ã€‚

## React å¦‚ä½•ç¡®è®¤ Effect èƒ½å†æ¬¡åŒæ­¥

ä¸‹é¢æ˜¯ä¸ªå®é™…çš„ä¾‹å­ï¼Œç‚¹å‡» â€œOpen chatâ€ æ¥æŒ‚è½½ `ChatRoom` ç»„ä»¶:

```javascript App.js
import { useState, useEffect } from 'react';
import { createConnection } from './chat.js';

const serverUrl = 'https://localhost:1234';

function ChatRoom({ roomId }) {
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => connection.disconnect();
  }, [roomId]);
  return <h1>Welcome to the {roomId} room!</h1>;
}

export default function App() {
  const [roomId, setRoomId] = useState('general');
  const [show, setShow] = useState(false);
  return (
    <>
      <label>
        Choose the chat room:{' '}
        <select
          value={roomId}
          onChange={e => setRoomId(e.target.value)}
        >
          <option value="general">general</option>
          <option value="travel">travel</option>
          <option value="music">music</option>
        </select>
      </label>
      <button onClick={() => setShow(!show)}>
        {show ? 'Close chat' : 'Open chat'}
      </button>
      {show && <hr />}
      {show && <ChatRoom roomId={roomId} />}
    </>
  );
}

```

```javascript chat.js
export function createConnection(serverUrl, roomId) {
  // A real implementation would actually connect to the server
  return {
    connect() {
      console.log('âœ… Connecting to "' + roomId + '" room at ' + serverUrl + '...');
    },
    disconnect() {
      console.log('âŒ Disconnected from "' + roomId + '" room at ' + serverUrl);
    }
  };
}

```

æ³¨æ„åˆ°å½“ç»„ä»¶é¦–æ¬¡æŒ‚è½½æ—¶ï¼Œå¯ä»¥çœ‹åˆ°ä¸‰æ¡æ—¥å¿—:

1. âœ… Connecting to "general" room at https://localhost:1234... (development-only)
2. âŒ Disconnected from "general" room at https://localhost:1234. (development-only)
3. âœ… Connecting to "general" room at https://localhost:1234...

å‰ä¸¤æ¡æ—¥å¿—ä»…é™å¼€å‘ç¯å¢ƒï¼Œåœ¨å¼€å‘ç¯å¢ƒä¸‹ï¼ŒReact å§‹ç»ˆä¼šå¤šæŒ‚è½½ä¸€æ¬¡ç»„ä»¶ã€‚

React åœ¨å¼€å‘ç¯å¢ƒä¸‹é€šè¿‡å¼ºåˆ¶ç»„ä»¶å†æ¬¡æŒ‚è½½æ¥ç¡®è®¤å…¶å¯ä»¥æ­£å¸¸åŒæ­¥ï¼Œè¿™æˆ–è®¸è®©ä½ æƒ³åˆ°å¼€é—¨åå†æ¬¡å…³é—­æ‰“å¼€æ¥æ£€æŸ¥é—¨é”æ˜¯å¦æ­£å¸¸å·¥ä½œï¼ŒReact å¼€å§‹ç„¶ååœæ­¢ Effect ä»¥æ£€æŸ¥ä½ æ˜¯å¦æ­£ç¡®çš„å®ç°äº†æ¸…ç†å‡½æ•°

å®è·µä¸­ Effect å†æ¬¡è¿è¡Œçš„ä¸»è¦åŸå› æ˜¯å…¶ä¾èµ–çš„æŸäº›æ•°æ®å˜äº†ï¼Œæ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ä¸­åˆ‡æ¢äº†é€‰ä¸­çš„èŠå¤©å®¤ï¼Œæ³¨æ„ `roomId` å˜äº†åï¼ŒEffect ä¼šå†æ¬¡è¿è¡Œ

ç„¶è€Œï¼Œè¿˜æœ‰ä¸€äº›ä¸å¸¸è§çš„åœºæ™¯ä¹Ÿä¼šå¯¼è‡´ Effect çš„è¿è¡Œï¼Œä¸¾ä¸ªä¾‹å­ï¼Œå½“èŠå¤©å®¤è¿æ¥æ—¶å°è¯•ç¼–è¾‘ `serverUrl` æ—¶ï¼Œæ³¨æ„å½“ä½ ç¼–è¾‘ä»£ç æ—¶ Effect æ˜¯å¦‚ä½•è¿è¡Œçš„ã€‚æœªæ¥ React å¯èƒ½ä¼šæ·»åŠ æ›´å¤šä¾èµ– Effect çš„åŠŸèƒ½

## React æ˜¯å¦‚ä½•çŸ¥é“éœ€è¦å†æ¬¡åŒæ­¥ Effect çš„

ä½ å¯èƒ½ä¼šå¥½å¥‡ React æ˜¯æ€ä¹ˆçŸ¥é“ `roomId` ä¿®æ”¹åéœ€è¦åŒæ­¥ Effect çš„ï¼Œè¿™æ˜¯å› ä¸ºä½ å‘Šè¯‰äº† React Effect çš„ä»£ç æ˜¯ä¾èµ– `roomId` çš„ï¼Œå› ä¸ºä½ å°†å…¶æ”¾å…¥äº†ä¾èµ–æ•°ç»„ã€‚

```javascript
function ChatRoom({ roomId }) { // The roomId prop may change over time
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId); // This Effect reads roomId 
    connection.connect();
    return () => {
      connection.disconnect();
    };
  }, [roomId]); // So you tell React that this Effect "depends on" roomId
}
```

å®ƒæ˜¯è¿™ä¹ˆå·¥ä½œçš„:

1. ä½ çŸ¥é“ `roomId` æ˜¯ propï¼Œæ„å‘³ç€éšæ—¶é—´å®ƒå¯èƒ½ä¼šå˜
2. ä½ çŸ¥é“ Effect è¯»å–äº† `roomId`ï¼ˆæ‰€ä»¥ Effect ä¾èµ–äº†ä¸€ä¸ªå¯èƒ½ä¼šå˜çš„å€¼ï¼‰
3. è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ å°†å…¶æŒ‡å®šä¸º Effect çš„ä¾èµ–ï¼ˆè¿™æ ·å½“ `roomId` å˜äº†æ—¶ Effect å°±ä¼šåŒæ­¥ï¼‰

æ¯å½“ä½ çš„ç»„ä»¶å†æ¬¡æ¸²æŸ“æ—¶ï¼ŒReact éƒ½ä¼šæŸ¥çœ‹ä½ ä¼ é€’çš„ä¾èµ–æ•°ç»„ï¼Œåªè¦å…¶ä¸­ä»»æ„ä¸€ä¸ªå€¼å’Œä¸Šæ¬¡æ¸²æŸ“æ—¶ä¸ä¸€æ ·ï¼ŒReact å°±ä¼šåŒæ­¥ä½ çš„ Effect

ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾åœ¨é¦–æ¬¡æ¸²æŸ“æ—¶ä½ ä¼ é€’äº† `general`ï¼Œåœ¨ä¸‹æ¬¡æ¸²æŸ“æ—¶ä¼ é€’äº† `travel`ï¼ŒReact ä¼šå¯¹æ¯” `general` å’Œ `travel`ï¼Œå®ƒä»¬çš„å€¼æ˜¯ä¸åŒçš„ï¼Œæ‰€ä»¥ React ä¼šåŒæ­¥ä½ çš„ Effectï¼›å¦ä¸€æ–¹é¢ï¼Œå¦‚æœä½ çš„ç»„ä»¶å†æ¬¡æ¸²æŸ“äº†ï¼Œä½†æ˜¯ `roomId` æ²¡æœ‰å˜ï¼ŒEffect å’ŒèŠå¤©å®¤çš„è¿æ¥ä¸ä¼šå˜ã€‚

## æ¯ä¸ª Effect ä»£è¡¨ä¸€ä¸ªå•ç‹¬çš„åŒæ­¥æµç¨‹

ä¸è¦ä»…ä»…å› ä¸ºæŸäº›é€»è¾‘éœ€è¦å’Œä½ å†™çš„ Effect åŒæ—¶è¿è¡Œè€Œå°†å…¶æ·»åŠ åˆ°ä½ çš„ Effect ä¸­ã€‚å‡è®¾ä½ æƒ³åœ¨ç”¨æˆ·è®¿é—®èŠå¤©å®¤æ—¶å‘é€ç»Ÿè®¡äº‹ä»¶ï¼Œä½ å·²ç»æœ‰äº†ä¸€ä¸ªä¾èµ–äº `roomId` çš„ Effectï¼Œæ‰€ä»¥ä½ å¯èƒ½æƒ³ç›´æ¥åœ¨è¿™åŠ ä¸€æ®µç»Ÿè®¡ä»£ç çš„è°ƒç”¨:

```javascript
function ChatRoom({ roomId }) {
  useEffect(() => {
    logVisit(roomId);
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => {
      connection.disconnect();
    };
  }, [roomId]);
  // ...
}
```

ä½†æ˜¯å¦‚æœéšåä½ ä¸ºè¿™ä¸ª Effect åŠ äº†å¦ä¸€ä¸ªä¾èµ–ï¼Œå½“å…¶å˜åŒ–æ—¶ä¹Ÿéœ€è¦é‡è¿èŠå¤©å®¤ï¼Œå¦‚æœ Effect å†æ¬¡åŒæ­¥äº†ï¼Œå®ƒä¹Ÿä¼šä¸ºåŒä¸€ä¸ªèŠå¤©å®¤è°ƒç”¨ `logVisit(roomId)`ï¼Œè¿™æ˜¾ç„¶ä¸æ˜¯ä½ æƒ³è¦çš„ã€‚æ‰“å°è®¿å®¢å’Œè¿æ¥èŠå¤©å®¤å¹¶ä¸æ˜¯ä¸€ä»¶äº‹ï¼Œæ‰€ä»¥å°†ä»–ä»¬æ‹†åˆ†åˆ°ä¸¤ä¸ªç‹¬ç«‹çš„ Effect ä¼šæ›´å¥½:

```javascript
function ChatRoom({ roomId }) {
  useEffect(() => {
    logVisit(roomId);
  }, [roomId]);

  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    // ...
  }, [roomId]);
  // ...
}
```

ä»£ç ä¸­çš„æ¯ä¸ª Effect éƒ½åº”è¯¥ä»£è¡¨ä¸€ä¸ªç‹¬ç«‹çš„åŒæ­¥æµç¨‹

ä¸Šé¢çš„ä¾‹å­ä¸­çœ‹ï¼Œåˆ é™¤ä¸€ä¸ª Effect å¹¶ä¸ä¼šå½±å“åˆ°å…¶ä»– Effect çš„é€»è¾‘ã€‚è¿™å¾ˆå¥½çš„è¡¨æ˜å®ƒä»¬åœ¨åŒæ­¥ä¸åŒçš„ä¸œè¥¿ï¼Œæ‰€ä»¥å°†å®ƒä»¬åˆ†å¼€æ˜¯æœ‰æ„ä¹‰çš„ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœå°†ä¸€ä¸ªå†…èšçš„é€»è¾‘ç‰‡æ®µæ‹†åˆ†ä¸ºå•ç‹¬çš„ Effectï¼Œä»£ç å¯èƒ½çœ‹èµ·æ¥æ›´æ¸…æ™°ï¼Œä½†æ˜¯ä¼šæ›´åŠ éš¾ä»¥ç»´æŠ¤ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ åº”è¯¥è€ƒè™‘æµç¨‹åº”è¯¥æ”¾åœ¨ä¸€èµ·è¿˜æ˜¯åˆ†å¼€ï¼Œè€Œä¸æ˜¯è€ƒè™‘ä»£ç æ˜¯å¦çœ‹èµ·æ¥æ›´æ¸…æ™°ã€‚

## Effect å“åº”å“åº”å¼å€¼çš„å˜åŒ–

ä½ çš„ Effect è¯»å–äº†ä¸¤ä¸ªå€¼ï¼ˆ`serverUrl` å’Œ `roomId`ï¼‰ï¼Œä½†æ˜¯ä½ åªæŒ‡å®šäº† `roomId` ä½œä¸ºä¾èµ–:

```javascript
const serverUrl = 'https://localhost:1234';

function ChatRoom({ roomId }) {
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => {
      connection.disconnect();
    };
  }, [roomId]);
  // ...
}
```

ä¸ºä»€ä¹ˆ `serverUrl` ä¸ç”¨æˆä¸ºä¸€ä¸ªä¾èµ–ï¼Ÿ

è¿™æ˜¯å› ä¸º `serverUrl` åœ¨æ¸²æŸ“æ—¶æ°¸è¿œä¸å˜ã€‚æ— è®ºç»„ä»¶æ¸²æŸ“å¤šå°‘æ¬¡æˆ–ä¸ºä»€ä¹ˆæ¸²æŸ“ï¼Œå®ƒæ€»æ˜¯å’Œä¹‹å‰ä¿æŒä¸€è‡´ã€‚ç”±äº `serverUrl` ä¸å˜ï¼Œæ‰€ä»¥å°†å…¶æŒ‡å®šä¸ºä¾èµ–æ¯«æ— æ„ä¹‰ï¼Œæ¯•ç«Ÿåªæœ‰ä¾èµ–å˜åŒ–æ—¶æ‰ä¼šè§¦å‘ Effect

å¦ä¸€æ–¹é¢ï¼Œ`roomId` å¯èƒ½æ˜¯ä¹‹å‰çš„æ¸²æŸ“ä¸­ä¸ä¸€æ ·ï¼Œpropsã€state å’Œå…¶ä»–å£°æ˜åœ¨ç»„ä»¶å†…éƒ¨çš„å€¼æ˜¯å“åº”å¼çš„ï¼Œå› ä¸ºå®ƒä»¬æ˜¯åœ¨æ¸²æŸ“æœŸé—´è®¡ç®—çš„ï¼Œå¹¶ä¸”æ˜¯ React æ•°æ®æµçš„ä¸€éƒ¨åˆ†

å¦‚æœ `serverUrl` æ˜¯ä¸€ä¸ª state å˜é‡ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯å“åº”å¼çš„ï¼Œå“åº”å¼çš„å€¼å¿…é¡»è¢«åŒ…å«åœ¨ä¾èµ–æ•°ç»„ä¸­:

```javascript
function ChatRoom({ roomId }) { // Props change over time
  const [serverUrl, setServerUrl] = useState('https://localhost:1234'); // State may change over time

  useEffect(() => {
    const connection = createConnection(serverUrl, roomId); // Your Effect reads props and state
    connection.connect();
    return () => {
      connection.disconnect();
    };
  }, [roomId, serverUrl]); // So you tell React that this Effect "depends on" on props and state
  // ...
}
```

å°† serverUrl æ·»åŠ åˆ°ä¾èµ–æ•°ç»„ä¸­ï¼Œä¿è¯äº†å…¶å˜åŒ–æ—¶ Effect ä¼šä¿æŒåŒæ­¥

å°è¯•åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ä¿®æ”¹é€‰ä¸­çš„èŠå¤©å®¤:

```javascript
import { useState, useEffect } from 'react';
import { createConnection } from './chat.js';

function ChatRoom({ roomId }) {
  const [serverUrl, setServerUrl] = useState('https://localhost:1234');

  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => connection.disconnect();
  }, [roomId, serverUrl]);

  return (
    <>
      <label>
        Server URL:{' '}
        <input
          value={serverUrl}
          onChange={e => setServerUrl(e.target.value)}
        />
      </label>
      <h1>Welcome to the {roomId} room!</h1>
    </>
  );
}

export default function App() {
  const [roomId, setRoomId] = useState('general');
  return (
    <>
      <label>
        Choose the chat room:{' '}
        <select
          value={roomId}
          onChange={e => setRoomId(e.target.value)}
        >
          <option value="general">general</option>
          <option value="travel">travel</option>
          <option value="music">music</option>
        </select>
      </label>
      <hr />
      <ChatRoom roomId={roomId} />
    </>
  );
}

```

åªè¦ä½ ä¿®æ”¹ä¸€ä¸ªå“åº”å¼çš„å€¼ï¼Œæ¯”å¦‚ roomId æˆ– serverUrlï¼ŒEffect å°±ä¼šé‡è¿åˆ°èŠå¤©å®¤

## ä¾èµ–æ•°ç»„ä¸ºç©ºçš„ Effect 

å¦‚æœä½ å°† serverUrl å’Œ roomId ç§»å‡ºç»„ä»¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ

```javascript
const serverUrl = 'https://localhost:1234';
const roomId = 'general';

function ChatRoom() {
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => {
      connection.disconnect();
    };
  }, []); // âœ… All dependencies declared
  // ...
}
```

ç°åœ¨è¿™ä¸ª Effect æ²¡æœ‰ä½¿ç”¨ä»»ä½•çš„å“åº”å¼å€¼ï¼Œæ‰€ä»¥å®ƒçš„ä¾èµ–æ•°ç»„ä¸ºç©º([]);

ä»ç»„ä»¶çš„è§†è§’æ¥çœ‹ï¼Œä¾èµ–æ•°ç»„ä¸ºç©ºæ„å‘³ç€åªæœ‰å½“ç»„ä»¶æŒ‚è½½æ—¶è¿™ä¸ª Effect æ‰ä¼šè¿æ¥åˆ°èŠå¤©å®¤ï¼Œåªæœ‰å½“ç»„ä»¶å¸è½½æ—¶å®ƒæ‰ä¼šæ–­å¼€è¿æ¥

```javascript
import { useState, useEffect } from 'react';
import { createConnection } from './chat.js';

const serverUrl = 'https://localhost:1234';
const roomId = 'general';

function ChatRoom() {
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => connection.disconnect();
  }, []);
  return <h1>Welcome to the {roomId} room!</h1>;
}

export default function App() {
  const [show, setShow] = useState(false);
  return (
    <>
      <button onClick={() => setShow(!show)}>
        {show ? 'Close chat' : 'Open chat'}
      </button>
      {show && <hr />}
      {show && <ChatRoom />}
    </>
  );
}

```

ç„¶è€Œå¦‚æœä½ ä» Effect çš„è§†è§’æ¥çœ‹ï¼Œä½ å®Œå…¨ä¸ç”¨è€ƒè™‘æŒ‚è½½å’Œå¸è½½ã€‚é‡è¦çš„æ˜¯ä½ å·²ç»æŒ‡å®šäº† Effect å¼€å§‹å’Œåœæ­¢åŒæ­¥æ—¶åº”è¯¥åšä»€ä¹ˆã€‚ä»Šå¤©ï¼Œå®ƒæ²¡æœ‰å“åº”å¼çš„ä¾èµ–ï¼Œä½†æ˜¯éšæ—¶é—´æ¨ç§»ä½ å¸Œæœ›ç”¨æˆ·èƒ½ä¿®æ”¹ roomId æˆ– serverUrlï¼ŒEffect ä»£ç æ˜¯ä¸ç”¨ä¿®æ”¹çš„ï¼Œä½ åªè¦å°†å®ƒä»¬æ·»åŠ åˆ°ä¾èµ–æ•°ç»„ä¸­ã€‚

## ç»„ä»¶å†…éƒ¨å£°æ˜çš„å˜é‡æ˜¯å“åº”å¼çš„

props å’Œ state ä¸æ˜¯ä»…æœ‰çš„å“åº”å¼å€¼ï¼Œé‚£äº›ä½ èƒ½ä»ä¸­è®¡ç®—å‡ºçš„å€¼ä¹Ÿæ˜¯å“åº”å¼çš„ã€‚å¦‚æœ state æˆ– props å˜äº†ï¼Œä½ çš„ç»„ä»¶éœ€è¦å†æ¬¡æ¸²æŸ“ï¼Œå¹¶ä¸”ä»ä¸­è®¡ç®—å‡ºçš„å€¼ä¹Ÿä¼šå˜åŒ–ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆç»„ä»¶å†…éƒ¨å£°æ˜çš„å˜é‡è¢«ç”¨äº Effect æ—¶ï¼Œä¹Ÿè¦å°†å…¶æ·»åŠ åˆ°ä¾èµ–æ•°ç»„ä¸­

å‡è®¾ç”¨æˆ·å¯ä»¥ä»ä¸‹æ‹‰æ¡†ä¸­é€‰æ‹©æœåŠ¡å™¨ï¼Œä½†æ˜¯ä»–ä»¬è¿˜èƒ½é…ç½®ä¸€ä¸ªé»˜è®¤çš„æœåŠ¡å™¨ï¼Œå‡è®¾ä½ å·²ç»å°†é»˜è®¤å€¼æ”¾å…¥ context ä¸­å¹¶ä»å…¶ä¸­è¯»å–äº†é»˜è®¤å€¼ï¼Œç°åœ¨ä½ å¯ä»¥æ ¹æ®ç”¨æˆ·é€‰ä¸­å€¼å’Œé»˜è®¤å€¼æ¥è®¡ç®—å‡º serverUrlï¼š

```javascript
function ChatRoom({ roomId, selectedServerUrl }) { // roomId is reactive
  const settings = useContext(SettingsContext); // settings is reactive
  const serverUrl = selectedServerUrl ?? settings.defaultServerUrl; // serverUrl is reactive
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId); // Your Effect reads roomId and serverUrl
    connection.connect();
    return () => {
      connection.disconnect();
    };
  }, [roomId, serverUrl]); // So it needs to re-synchronize when either of them changes!
  // ...
}
```

è¿™ä¸ªä¾‹å­ä¸­çš„ serverUrl æ—¢ä¸æ˜¯ prop ä¹Ÿä¸æ˜¯ stateï¼Œåªæ˜¯ä¸€ä¸ªæ¸²æŸ“æœŸé—´è®¡ç®—å‡ºçš„å¸¸è§„å˜é‡ï¼Œä½†æ˜¯ç”±äºå®ƒæ˜¯æ¸²æŸ“æœŸé—´è®¡ç®—å‡ºçš„ï¼Œæ‰€ä»¥å®ƒå¯èƒ½åœ¨ä¸‹æ¬¡æ¸²æŸ“æ˜¯æ”¹å˜ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒæ˜¯å“åº”å¼çš„

ç»„ä»¶å†…çš„æ‰€æœ‰å˜é‡éƒ½æ˜¯å“åº”å¼çš„ï¼ŒåŒ…æ‹¬ propsã€state å’Œç»„ä»¶å†…å£°æ˜çš„å˜é‡ï¼Œæ‰€æœ‰çš„å“åº”å¼å€¼åœ¨é‡å¤æ¸²æŸ“æ—¶éƒ½å¯èƒ½å˜åŒ–ï¼Œæ‰€ä»¥ä½ éœ€è¦å°†å…¶æ·»åŠ åˆ° Effect çš„ä¾èµ–æ•°ç»„ä¸­ã€‚

æ¢å¥è¯è¯´ï¼ŒEffect ä¼šå“åº”ç»„ä»¶å†…çš„æ‰€æœ‰å€¼çš„å˜åŒ–

> æ·±åº¦é˜…è¯»
>
> å…¨å±€å˜é‡æˆ–å¯å˜çš„å€¼å¯ä»¥æ˜¯ä¾èµ–å—
>
> å¯å˜çš„å€¼ä¸æ˜¯å“åº”å¼çš„
> ä¸€ä¸ªå¯å˜çš„å€¼ï¼Œæ¯”å¦‚ location.pathname ä¸èƒ½æ˜¯ä¾èµ–ï¼Œå®ƒæ˜¯å¯å˜çš„ï¼Œæ‰€ä»¥åœ¨ React æ¸²æŸ“æ•°æ®æµä¹‹å¤–ï¼Œå®ƒå¯èƒ½åœ¨ä»»æ„æ—¶é—´ç‚¹è¢«ä¿®æ”¹ã€‚å¯¹å…¶çš„ä¿®æ”¹ä¸ä¼šè§¦å‘ç»„ä»¶çš„å†æ¬¡æ¸²æŸ“ï¼Œæ‰€ä»¥å³ä½¿ä½ å°†å…¶æŒ‡å®šä¸ºä¾èµ–ï¼Œå½“å…¶ä¿®æ”¹æ—¶ React ä¹Ÿä¸çŸ¥é“ï¼Œæ‰€ä»¥ä¸ä¼šè§¦å‘ Effect çš„åŒæ­¥ã€‚è¿™ä¹Ÿæ‰“ç ´äº† React çš„è§„åˆ™ï¼Œå› ä¸ºåœ¨æ¸²æŸ“æ—¶è¯»å–äº†å¯å˜çš„æ•°æ®ç ´åäº†æ¸²æŸ“çš„çº¯åº¦ï¼Œç›¸åï¼Œä½ åº”è¯¥ä½¿ç”¨ `useSyncExternalStore` æ¥è®¢é˜…å¤–éƒ¨çš„å¯å˜å€¼
> 
> ä¸€ä¸ªç±»ä¼¼ `ref.current` çš„å€¼æˆ–è€…ä½ ä»ä¸­è¯»å–çš„å€¼ä¹Ÿä¸èƒ½æˆä¸ºä¾èµ–ï¼Œ`useRef` è¿”å›çš„ `ref` å¯¹è±¡æœ¬èº«å¯ä»¥æ˜¯ä¾èµ–ï¼Œä½†æ˜¯å…¶ `current` å±æ€§æ˜¯å¯å˜çš„ã€‚`ref` å…è®¸ä½ è¿½è¸ªæ•°æ®ä¸”ä¸è§¦å‘ renderï¼Œä½†æ˜¯å¯¹å…¶çš„ä¿®æ”¹ä¸ä¼šè§¦å‘é‡å¤æ¸²æŸ“ï¼Œæ‰€ä»¥å®ƒä¸æ˜¯å“åº”å¼çš„å€¼ï¼Œå½“å…¶å˜åŒ–æ—¶ React æ„ŸçŸ¥ä¸åˆ°æ‰€ä»¥æ— æ³•è¿è¡Œ Effect
>
> ç»§ç»­é˜…è¯»è¿™ç¯‡æ–‡æ¡£ï¼Œä¸€ä¸ª linter ä¼šè‡ªåŠ¨æ£€æŸ¥è¿™äº›é—®é¢˜

## React ä¼šæ£€æŸ¥ä¾èµ–ä¸­æ˜¯å¦åŒ…å«äº†æ‰€æœ‰çš„å“åº”å¼å€¼

å¦‚æœä½ é…ç½®äº† linterï¼Œå®ƒä¼šæ£€æŸ¥ä¾èµ–ä¸­æ˜¯å¦åŒ…å«äº†æ‰€æœ‰çš„ Effect ä½¿ç”¨çš„å“åº”å¼å€¼ï¼š

```javascript
import { useState, useEffect } from 'react';
import { createConnection } from './chat.js';

function ChatRoom({ roomId }) { // roomId is reactive
  const [serverUrl, setServerUrl] = useState('https://localhost:1234'); // serverUrl is reactive

  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => connection.disconnect();
  }, []); // <-- Something's wrong here!

  return (
    <>
      <label>
        Server URL:{' '}
        <input
          value={serverUrl}
          onChange={e => setServerUrl(e.target.value)}
        />
      </label>
      <h1>Welcome to the {roomId} room!</h1>
    </>
  );
}

export default function App() {
  const [roomId, setRoomId] = useState('general');
  return (
    <>
      <label>
        Choose the chat room:{' '}
        <select
          value={roomId}
          onChange={e => setRoomId(e.target.value)}
        >
          <option value="general">general</option>
          <option value="travel">travel</option>
          <option value="music">music</option>
        </select>
      </label>
      <hr />
      <ChatRoom roomId={roomId} />
    </>
  );
}

```

è¿™çœ‹èµ·æ¥åƒæ˜¯ä¸€ä¸ª React é”™è¯¯ï¼Œä½†æ˜¯å®é™…ä¸Š React æŒ‡å‡ºäº†ä»£ç ä¸­çš„ bugã€‚`roomId` å’Œ `serverUrl` éƒ½å¯èƒ½éšæ—¶é—´è€Œå˜åŒ–ï¼Œä½†æ˜¯å½“å…¶å˜åŒ–æ—¶ä½ å¿˜è®°äº†åŒæ­¥ Effectã€‚å½“ç”¨æˆ·åœ¨ç•Œé¢ä¸­é€‰æ‹©ä¸åŒçš„èŠå¤©å®¤æ—¶ï¼Œä½ ä»ç„¶ä¿æŒäº†ä¸€å¼€å§‹çš„è¿æ¥ã€‚

è¦ä¿®å¤è¿™ä¸ª bugï¼Œéµå¾ª linter çš„å»ºè®®ï¼Œå°† `roomId` å’Œ `serverUrl` æŒ‡å®šä¸º Effect çš„ä¾èµ–:

```javascript
function ChatRoom({ roomId }) { // roomId is reactive
  const [serverUrl, setServerUrl] = useState('https://localhost:1234'); // serverUrl is reactive
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => {
      connection.disconnect();
    };
  }, [serverUrl, roomId]); // âœ… All dependencies declared
  // ...
}
```

> æ³¨æ„
> æŸäº›æƒ…å†µä¸‹ï¼ŒReact çŸ¥é“æŸäº›å€¼ä¸ä¼šå˜ï¼Œå³ä½¿å®ƒè¢«å£°æ˜åœ¨ç»„ä»¶å†…éƒ¨ã€‚æ¯”å¦‚ `useState` è¿”å›çš„ set å‡½æ•°å’Œ `useRef` è¿”å›çš„ `ref` å¯¹è±¡éƒ½æ˜¯ç¨³å®šçš„ â€”â€” åœ¨é‡å¤æ¸²æŸ“æ—¶å®ƒä»¬çš„å€¼ä¸å˜ã€‚ç¨³å®šçš„å€¼ä¸æ˜¯å“åº”å¼çš„ï¼Œæ‰€ä»¥ä½ å¯ä»¥ä»ä¾èµ–æ•°æ®ä¸­å¿½ç•¥å®ƒä»¬ï¼ŒåŒ…å«å®ƒä»¬ä¹Ÿæ˜¯å¯ä»¥çš„ï¼šå®ƒä»¬ä¸ä¼šå˜ï¼Œæ‰€ä»¥æ²¡ä»€ä¹ˆå½±å“

## å½“ä½ ä¸æƒ³åŒæ­¥æ—¶åº”è¯¥åšä»€ä¹ˆ

åœ¨ä¹‹å‰çš„ä¾‹å­ä¸­ï¼Œä½ é€šè¿‡å°† `roomId` å’Œ `serverUrl` æ”¾å…¥ä¾èµ–ä¸­ä¿®å¤äº† lint é—®é¢˜

ç„¶è€Œï¼Œä½ è¿˜å¯ä»¥å‘ linter è¯æ˜è¿™äº›å€¼ä¸æ˜¯å“åº”å¼çš„ï¼Œåœ¨é‡å¤æ¸²æŸ“æ—¶å®ƒä»¬æ˜¯ä¸å˜çš„ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœ `serverUrl` å’Œ `roomId` å’Œæ¸²æŸ“æ— å…³ï¼Œä½ å¯ä»¥ä»å°†å…¶ç§»å‡ºç»„ä»¶ï¼Œè¿™æ ·å®ƒä»¬å°±ä¸æ˜¯ä¾èµ–äº†:

```javascript
const serverUrl = 'https://localhost:1234'; // serverUrl is not reactive
const roomId = 'general'; // roomId is not reactive

function ChatRoom() {
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => {
      connection.disconnect();
    };
  }, []); // âœ… All dependencies declared
  // ...
}
```

ä½ ä¹Ÿå¯ä»¥å°†å®ƒä»¬ç§»å…¥ Effectï¼Œå®ƒä»¬ä¸æ˜¯åœ¨æ¸²æŸ“æ—¶è®¡ç®—å‡ºçš„ï¼Œæ‰€ä»¥ä¹Ÿä¸æ˜¯å“åº”å¼çš„:

```javascript
function ChatRoom() {
  useEffect(() => {
    const serverUrl = 'https://localhost:1234'; // serverUrl is not reactive
    const roomId = 'general'; // roomId is not reactive
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => {
      connection.disconnect();
    };
  }, []); // âœ… All dependencies declared
  // ...
}
```

Effect æ˜¯å“åº”å¼çš„ä»£ç å—ï¼Œå½“å…¶ä¾èµ–çš„å€¼å˜åŒ–æ—¶ï¼Œå®ƒä¼šä¿æŒåŒæ­¥ã€‚äº‹ä»¶å¤„ç†ç¨‹åºåœ¨æ¯æ¬¡äº¤äº’æ—¶åªä¼šè¿è¡Œä¸€æ¬¡ï¼Œè€Œ Effect åªè¦æœ‰éœ€è¦å°±è¿è¡Œã€‚

ä½ ä¸èƒ½é€‰æ‹©ä½ çš„ä¾èµ–ï¼Œä½ çš„ä¾èµ–å¿…é¡»åŒ…å« Effect ä¸­è¯»å–çš„æ¯ä¸ªå“åº”å¼å€¼ï¼Œlinter ä¼šå¼ºåˆ¶æ£€æŸ¥ã€‚æœ‰æ—¶å€™è¿™ä¼šå¯¼è‡´ç±»ä¼¼æ­»å¾ªç¯çš„é—®é¢˜ï¼Œå¯¼è‡´ä½ çš„ Effect è¿‡äºé¢‘ç¹çš„åŒæ­¥ã€‚ä¸è¦é€šè¿‡æŠ‘åˆ¶ linter çš„æ–¹å¼æ¥ä¿®å¤é—®é¢˜ï¼Œè€Œæ˜¯é€‰æ‹©ä»¥ä¸‹æ–¹å¼:

- æ£€æŸ¥ä½ çš„ Effect æ˜¯å¦è¡¨ç¤ºäº†ä¸€ä¸ªç‹¬ç«‹çš„åŒæ­¥æµç¨‹ï¼Œå¦‚æœä½ çš„ Effect æ²¡æœ‰åŒæ­¥ä»»ä½•ä¸œè¥¿ï¼Œå®ƒå¯èƒ½ä¸æ˜¯å¿…é¡»çš„ã€‚å¦‚æœå…¶åŒæ­¥äº†å‡ ä¸ªç›¸äº’ç‹¬ç«‹çš„ä¸œè¥¿ï¼Œæ‹†åˆ†å®ƒä»¬
- å¦‚æœä½ æƒ³è¯»å– props æˆ– state çš„æœ€æ–°å€¼è€Œä¸æƒ³å¯¹æ­¤ä½œå‡ºå“åº”ï¼Œå¹¶ä¸”æƒ³åŒæ­¥ Effectï¼Œä½ å¯ä»¥å°† Effect æ‹†åˆ†ä¸ºä¸€ä¸ªå“åº”å¼çš„éƒ¨åˆ†å’Œä¸€ä¸ªéå“åº”å¼çš„éƒ¨åˆ†(ç§°ä¸º Effect Event)
- é¿å…ä¾èµ–å¯¹è±¡å’Œå‡½æ•°ï¼Œå¦‚æœä½ åœ¨æ¸²æŸ“æ—¶åˆ›å»ºäº†å¯¹è±¡å’Œå‡½æ•°å¹¶åœ¨ Effect ä¸­è¯»å–äº†å®ƒä»¬ï¼Œå®ƒä»¬åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œè¿™ä¼šå¯¼è‡´ä½ çš„ Effect åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½åŒæ­¥

> é™·é˜±
>
> linter æ˜¯ä¸ªå¥½æœ‹å‹ï¼Œä½†æ˜¯å…¶åŠŸèƒ½æ˜¯å—é™çš„ï¼Œlinter åªèƒ½å‘ç°é”™è¯¯çš„ä¾èµ–ï¼Œè€Œä¸çŸ¥é“æ¯ä¸ªé—®é¢˜çš„æœ€ä½³è§£å†³æ–¹å¼ã€‚å¦‚æœ linter å»ºè®®äº†æŸä¸ªå€¼ä½œä¸ºä¾èµ–ï¼Œä½†æ˜¯å°†å…¶åŠ å…¥ä¼šå¯¼è‡´æ­»å¾ªç¯ï¼Œè¿™å¹¶ä¸æ„å‘³ç€ linter çš„ä¿¡æ¯åº”è¯¥è¢«å¿½ç•¥ï¼Œè€Œæ˜¯ä½ éœ€è¦ä¿®æ”¹ Effect å†…éƒ¨çš„ä»£ç ä»¥ä¾¿å…¶ä¸å†æ˜¯å“åº”å¼å¹¶ä¸”ä¸ç”¨æˆä¸ºä¾èµ–
> ä½ å¯èƒ½åœ¨ç°å­˜ä»£ç åº“ä¸­çœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„æŠ‘åˆ¶ linter çš„ä»£ç :

```javascript
useEffect(() => {
  // ...
  // ğŸ”´ Avoid suppressing the linter like this:
  // eslint-ignore-next-line react-hooks/exhaustive-deps
}, []);
```

> ä¸‹ä¸ªç« èŠ‚ä¸­ä½ å°†å­¦åˆ°å¦‚ä½•ä¿®å¤è¿™æ®µä»£ç 

## å›é¡¾

- ç»„ä»¶å¯ä»¥æŒ‚è½½ã€æ›´æ–°å’Œå¸è½½
- æ¯ä¸ª Effect éƒ½æœ‰å’Œå‘¨å›´ç»„ä»¶ç‹¬ç«‹çš„ç”Ÿå‘½å‘¨æœŸ
- æ¯ä¸ª Effect æè¿°äº†ä¸€ä¸ªå•ç‹¬çš„å¯ä»¥å¼€å§‹å’Œåœæ­¢çš„åŒæ­¥æµç¨‹ï¼Œ
- å½“ä½ è¯»å†™ Effect æ—¶ï¼Œä»æ¯ä¸ªç‹¬ç«‹çš„ Effect çš„è§†è§’æ¥æ€è€ƒï¼ˆå¦‚ä½•å¼€å§‹å’Œåœæ­¢åŒæ­¥ï¼‰ï¼Œè€Œä¸æ˜¯ä»ç»„ä»¶çš„è§’åº¦ï¼ˆå®ƒæ˜¯æ€ä¹ˆæŒ‚è½½ã€æ›´æ–°å’Œå¸è½½çš„ï¼‰
- ç»„ä»¶å†…éƒ¨å£°æ˜çš„å€¼æ˜¯å“åº”å¼çš„
- ç”±äºå“åº”å¼çš„å€¼éšæ—¶é—´è€Œå˜åŒ–ï¼Œæ‰€ä»¥å…¶åº”è¯¥åŒæ­¥ Effect
- linter ä¼šæ£€æŸ¥ Effect å†…éƒ¨æ‰€æœ‰çš„å“åº”å¼å€¼éƒ½è¢«æŒ‡å®šä¸ºä¾èµ–
- linter è¡¨ç¤ºçš„æ‰€æœ‰é”™è¯¯éƒ½æ˜¯åˆæ³•çš„ï¼Œæ€»æœ‰ä¸€ç§åŠæ³•èƒ½åœ¨ä¸ç ´åè§„åˆ™çš„æƒ…å†µä¸‹ä¿®å¤ä»£ç 