
React å†…ç½®äº†ä¸€äº› Hooksï¼Œæ¯”å¦‚ useStateã€useContext å’Œ useContextã€‚æœ‰æ—¶å€™ä½ å¸Œæœ›æœ‰ä¸ª Hook ç”¨äºæ›´åŠ å…·ä½“çš„é€»è¾‘ï¼Œæ¯”å¦‚è·å–æ•°æ®ã€è·Ÿè¸ªç”¨æˆ·æ˜¯å¦åœ¨çº¿æˆ–è¿æ¥åˆ°è¿å¤©ä½¿ã€‚ä½ å¯èƒ½åœ¨ React ä¸­æ‰¾ä¸åˆ°è¿™äº› Hooksï¼Œä½†ä½ å¯ä»¥æ ¹æ®åº”ç”¨çš„éœ€è¦åˆ›å»ºè‡ªå·±çš„ Hooks

> ä½ å°†å­¦åˆ°
>
> è‡ªå®šä¹‰ Hooks æ˜¯ä»€ä¹ˆï¼Œå¦‚ä½•è‡ªå·±å®ç°å®ƒä»¬
> å¦‚ä½•åœ¨ç»„ä»¶é—´å¤ç”¨é€»è¾‘
> å¦‚ä½•å‘½åå’Œç»„ç»‡ä½ çš„è‡ªå®šä¹‰ Hooks
> ä½•æ—¶åˆ†ç¦»è‡ªå®šä¹‰ Hooks ä»¥åŠä¸ºä»€ä¹ˆ

## è‡ªå®šä¹‰ Hooks: åœ¨ç»„ä»¶é—´å…±äº«é€»è¾‘

å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªé‡åº¦ä¾èµ–ç½‘ç»œçš„åº”ç”¨ï¼Œä½ æƒ³ç”¨æˆ·åœ¨ä½¿ç”¨åº”ç”¨çš„æ—¶å€™é‡åˆ°äº†ç½‘ç»œè¿æ¥æ–­å¼€çš„åœºæ™¯æ—¶æé†’ç”¨æˆ·ï¼Œè¯¥æ€ä¹ˆå®ç°å®ƒå‘¢ï¼Ÿçœ‹èµ·æ¥ä½ éœ€è¦åœ¨è¿™ä¸ªç»„ä»¶ä¸­åšä¸¤ä»¶äº‹:

1. ç”¨ä¸€ä¸ª state å˜é‡æ¥è¿½è¸ªç”¨æˆ·çš„ç½‘ç»œæ˜¯å¦åœ¨çº¿
2. ä¸€ä¸ª Effectï¼Œè®¢é˜…å…¨å±€çš„ online å’Œ offline äº‹ä»¶ï¼Œå¹¶åŒæ­¥æ›´æ–° state

è¿™è®©ä½ çš„ç»„ä»¶å’Œç½‘ç»œçŠ¶æ€ä¿æŒäº†åŒæ­¥ï¼Œä½ å¼€å§‹çš„ä»£ç å¯èƒ½åƒè¿™æ ·:

```javascript
import { useEffect, useState } from 'react';

export default function StatusBar() {
  const [isOnline, setIsOnline] = useState(true);

  useEffect(() => {
    function handleOnline() {
      setIsOnline(true)
    }
    function handleOffline() {
      setIsOnline(false)
    }
    window.addEventListener('online', handleOnline)
    window.addEventListener('offline', handleOffline);
    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
    }
  })

  return <h1>{isOnline ? 'âœ… Online' : 'âŒ Disconnected'}</h1>;
}
```

è¯•ç€æ‰“å¼€å’Œå…³é—­ç½‘ç»œè¿æ¥ï¼Œè§‚å¯Ÿä¸‹è¿™ä¸ª StatusBar æ˜¯å¦‚ä½•æ›´æ–°çš„

å‡è®¾ä½ æƒ³ä¸ºä¸€ä¸ªä¸åŒçš„ç»„ä»¶å¤ç”¨è¿™ä¸ªé€»è¾‘ï¼Œä½ æƒ³å®ç°ä¸€ä¸ªä¿å­˜æŒ‰é’®ï¼Œå½“ç½‘ç»œå…³é—­æ—¶è¯¥æŒ‰é’®è¢«ç¦ç”¨å¹¶æ˜¾ç¤º æ­£åœ¨é‡æ–°è¿æ¥ è€Œä¸æ˜¯ ä¿å­˜ã€‚

ä¸€å¼€å§‹ï¼Œä½ å¯ä»¥å°†ä¸Šé¢çš„é€»è¾‘æ‹·è´åˆ° SaveButton ä¸­ï¼š

```javascript
import { useState, useEffect } from 'react';

export default function SaveButton() {
  const [isOnline, setIsOnline] = useState(true);
  useEffect(() => {
    function handleOnline() {
      setIsOnline(true);
    }
    function handleOffline() {
      setIsOnline(false);
    }
    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);
    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
    };
  }, []);

  function handleSaveClick() {
    console.log('âœ… Progress saved');
  }

  return (
    <button disabled={!isOnline} onClick={handleSaveClick}>
      {isOnline ? 'Save progress' : 'Reconnecting...'}
    </button>
  );
}

```

è¯•è¯•è¿™ä¸ªä¾‹å­ã€‚

è¿™ä¸¤ä¸ªç»„ä»¶éƒ½èƒ½æ­£å¸¸å·¥ä½œï¼Œä½†æ˜¯å…¶ä¸­çš„é€»è¾‘æ˜¯é‡å¤çš„ã€‚å³ä½¿å®ƒä»¬çœ‹èµ·æ¥å…·æœ‰ä¸åŒçš„è§†è§‰æ•ˆæœï¼Œä½†æ˜¯ä½ å¸Œæœ›èƒ½å¤ç”¨å®ƒä»¬çš„é€»è¾‘ã€‚

## ä»ç»„ä»¶ä¸­åˆ†ç¦»å‡ºè‡ªå®šä¹‰ Hook

æƒ³è±¡ä¸€ä¸‹ï¼Œç±»ä¼¼äº useState å’Œ useEffectï¼Œå‡è®¾è¿™é‡Œæœ‰ä¸€ä¸ªå†…ç½®çš„ useOnlineStatus Hookï¼Œç„¶åè¿™ä¸¤ä¸ªç»„ä»¶éƒ½å¯ä»¥ç®€åŒ–ï¼Œä½ å¯ä»¥å°†å…¶ä¸­çš„é‡å¤ä»£ç åˆ é™¤:

```javascript
function StatusBar() {
  const isOnline = useOnlineStatus();
  return <h1>{isOnline ? 'âœ… Online' : 'âŒ Disconnected'}</h1>;
}

function SaveButton() {
  const isOnline = useOnlineStatus();

  function handleSaveClick() {
    console.log('âœ… Progress saved');
  }

  return (
    <button disabled={!isOnline} onClick={handleSaveClick}>
      {isOnline ? 'Save progress' : 'Reconnecting...'}
    </button>
  );
}
```

è™½ç„¶è¿™é‡Œå¹¶æ²¡æœ‰è¿™ç§å†…ç½® Hookï¼Œä½ å¯ä»¥è‡ªå·±å®ç°ä¸€ä¸ªã€‚å£°æ˜ä¸€ä¸ª useOnlineStatus çš„å‡½æ•°å¹¶å°†ä¹‹å‰çš„é‡å¤ä»£ç ç§»å…¥å…¶ä¸­ï¼š

```javascript
  const [isOnline, setIsOnline] = useState(true);

  useEffect(() => {
    function handleOnline() {
      setIsOnline(true)
    }
    function handleOffline() {
      setIsOnline(false)
    }
    window.addEventListener('online', handleOnline)
    window.addEventListener('offline', handleOffline);
    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
    }
  })

  return isOnline;
```

åœ¨å‡½æ•°çš„æœ€åï¼Œè¿”å› isOnlineï¼Œè¿™è®©ä½ çš„ç»„ä»¶èƒ½å¤Ÿè¯»å–å®ƒ:

```javascript App.js
import { useOnlineStatus } from './useOnlineStatus.js';

function StatusBar() {
  const isOnline = useOnlineStatus();
  return <h1>{isOnline ? 'âœ… Online' : 'âŒ Disconnected'}</h1>;
}

function SaveButton() {
  const isOnline = useOnlineStatus();

  function handleSaveClick() {
    console.log('âœ… Progress saved');
  }

  return (
    <button disabled={!isOnline} onClick={handleSaveClick}>
      {isOnline ? 'Save progress' : 'Reconnecting...'}
    </button>
  );
}

export default function App() {
  return (
    <>
      <SaveButton />
      <StatusBar />
    </>
  );
}
```

```javascript useOnlineStatus.js
import { useState, useEffect } from 'react';

export function useOnlineStatus() {
  const [isOnline, setIsOnline] = useState(true);
  useEffect(() => {
    function handleOnline() {
      setIsOnline(true);
    }
    function handleOffline() {
      setIsOnline(false);
    }
    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);
    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
    };
  }, []);
  return isOnline;
}

```

æ‰“å¼€å’Œå…³é—­ç½‘ç»œä¼šæ›´æ–°è¿™ä¸¤ä¸ªç»„ä»¶ã€‚

ç°åœ¨ä½ çš„ç»„ä»¶æ²¡æœ‰é‚£ä¹ˆå¤šé‡å¤é€»è¾‘äº†ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œå®ƒä»¬å†…éƒ¨çš„ä»£ç æè¿°äº†å®ƒä»¬æƒ³åšä»€ä¹ˆè€Œä¸æ˜¯å¦‚ä½•åšã€‚

å½“ä½ å°†é€»è¾‘æå–åˆ°è‡ªå®šä¹‰ Hook æ—¶ï¼Œä½ å¯ä»¥éšè—å¤„ç†å¤–éƒ¨ç³»ç»Ÿæˆ–æµè§ˆå™¨ API çš„ç²—ç³™ç»†èŠ‚ï¼Œç»„ä»¶å†…éƒ¨çš„ä»£ç è¡¨è¾¾äº†ä½ çš„æ„å›¾ï¼Œè€Œä¸æ˜¯å®ç°ç»†èŠ‚ã€‚

## Hook çš„åå­—ä½¿ç”¨ä»¥ use å¼€å§‹

React åº”ç”¨æ˜¯ç”¨ç»„ä»¶æ„å»ºçš„ï¼Œç»„ä»¶æ˜¯ä» Hooks æ„å»ºçš„ï¼Œæ— è®ºå®ƒä»¬æ˜¯å†…ç½® Hook æˆ–å†…ç½® Hookã€‚ä½ å¯èƒ½ä¼šç»å¸¸ä½¿ç”¨å…¶ä»–äººåˆ›å»ºçš„è‡ªå®šä¹‰ Hooksï¼Œä½†æ˜¯æœ‰æ—¶ä½ å¯èƒ½è‡ªå·±éœ€è¦å†™ä¸€ä¸ª

ä½ å¿…é¡»éµå¾ªä»¥ä¸‹çš„å‘½åçº¦å®š:

1. React ç»„ä»¶å¿…é¡»ä»¥å¤§å†™å­—æ¯å¼€å§‹ï¼Œæ¯”å¦‚ StatusBar å’Œ SaveButtonï¼Œå¹¶éœ€è¦è¿”å› React çŸ¥é“å¦‚ä½•ç”¨äºæ˜¾ç¤ºçš„ä¸œè¥¿ï¼Œæ¯”å¦‚ä¸€æ®µ JSX
2. Hooks çš„åç§°å¿…é¡»ä»¥ use å¼€å§‹ï¼Œåè·Ÿå¤§å†™å­—æ¯ï¼Œæ¯”å¦‚ useState(å†…ç½®çš„) æˆ– useOnlineStatus(è‡ªå®šä¹‰çš„)ï¼ŒHooks å¯ä»¥è¿”å›ä»»æ„çš„å€¼

æ­¤çº¦å®šä¿è¯äº†ä½ å§‹ç»ˆå¯ä»¥æŸ¥çœ‹ç»„ä»¶å¹¶äº†è§£å…¶ stateã€Effect å’Œå…¶ä»–å¯èƒ½éšè—çš„ React ç‰¹æ€§ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä½ åœ¨ç»„ä»¶ä¸­çœ‹åˆ°ä¸€ä¸ª getColor() çš„å‡½æ•°è°ƒç”¨ï¼Œä½ å¯ä»¥ç¡®å®šå®ƒçš„å†…éƒ¨æ²¡æœ‰ React stateï¼Œå› ä¸ºå®ƒçš„åå­—ä¸æ˜¯ç”¨ use å¼€å¤´çš„ã€‚ä½†æ˜¯ä¸€ä¸ªåƒ useOnlineStatus() çš„å‡½æ•°è°ƒç”¨å¾ˆå¯èƒ½åŒ…å«äº†å…¶ä»– Hook çš„è°ƒç”¨ã€‚

> æ³¨æ„
> å¦‚æœä½ çš„ linter æ˜¯ä¸º React é…ç½®çš„ï¼Œå®ƒå°†å¼ºåˆ¶æ‰§è¡Œè¿™ä¸ªå‘½åçº¦å®šã€‚å°†ä¸Šé¢çš„ useOnlineStatus é‡å‘½åä¸º getOnlineStatusï¼Œæ³¨æ„ linter å°†ä¸å†å…è®¸ä½ åœ¨å…¶ä¸­è°ƒç”¨ useStatus æˆ– useEffectï¼Œåªæœ‰ Hooks å’Œç»„ä»¶æ‰èƒ½è°ƒç”¨å…¶ä»–çš„ Hooks

## è‡ªå®šä¹‰ Hooks å…è®¸ä½ å…±äº«æœ‰çŠ¶æ€çš„é€»è¾‘ï¼Œè€Œä¸æ˜¯çŠ¶æ€æœ¬èº«

åœ¨ä¹‹å‰çš„ä¾‹å­ä¸­ï¼Œå½“ä½ æ‰“å¼€å’Œå…³é—­ç½‘ç»œæ—¶ï¼Œç»„ä»¶ä¼šä¸€èµ·æ›´æ–°ã€‚ç„¶è€Œï¼Œè®¤ä¸ºä»–ä»¬ä¹‹é—´å…±äº«å•ä¸ª isOnlineStatus çš„ state å˜é‡æ˜¯é”™è¯¯çš„ï¼Œçœ‹çœ‹è¿™æ®µä»£ç :

```javascript
function StatusBar() {
  const isOnline = useOnlineStatus();
  // ...
}

function SaveButton() {
  const isOnline = useOnlineStatus();
  // ...
}
```

å’Œä½ ä»é‡å¤ä»£ç ä¸­åˆ†ç¦»ä¹‹å‰çš„å·¥ä½œæ–¹å¼æ˜¯ä¸€æ ·çš„:

```javascript
function StatusBar() {
  const [isOnline, setIsOnline] = useState(true);
  useEffect(() => {
    // ...
  }, []);
  // ...
}

function SaveButton() {
  const [isOnline, setIsOnline] = useState(true);
  useEffect(() => {
    // ...
  }, []);
  // ...
}
```

è¿™æ˜¯ä¸¤ä¸ªå®Œå…¨ç‹¬ç«‹çš„ state å’Œ Effects!å› ä¸ºä½ å°†å®ƒä»¬ä¸ç›¸åŒçš„å¤–éƒ¨å€¼åŒæ­¥ï¼Œæ‰€ä»¥å®ƒä»¬æ°å¥½åœ¨åŒä¸€æ—¶é—´ç‚¹å…·æœ‰ç›¸åŒçš„å€¼

ä¸ºäº†æ›´å¥½çš„è¯´æ˜è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªä¸åŒçš„ä¾‹å­ï¼Œè€ƒè™‘ä¸€ä¸‹è¿™ä¸ª Form ç»„ä»¶:

```javascript
import { useState } from 'react';

export default function Form() {
  const [firstName, setFirstName] = useState('Mary');
  const [lastName, setLastName] = useState('Poppins');

  function handleFirstNameChange(e) {
    setFirstName(e.target.value);
  }

  function handleLastNameChange(e) {
    setLastName(e.target.value);
  }

  return (
    <>
      <label>
        First name:
        <input value={firstName} onChange={handleFirstNameChange} />
      </label>
      <label>
        Last name:
        <input value={lastName} onChange={handleLastNameChange} />
      </label>
      <p><b>Good morning, {firstName} {lastName}.</b></p>
    </>
  );
}

```

è¡¨å•çš„æ¯ä¸€é¡¹éƒ½æœ‰ä¸€äº›é‡å¤çš„é€»è¾‘:

1. æœ‰ä¸€ä¸ªçŠ¶æ€: firstName å’Œ lastName
2. æœ‰ä¸ªäº‹ä»¶å¤„ç†ç¨‹åº: handleFirstNameChange å’Œ handleLastNameChange
3. æœ‰ä¸€æ®µ JSX ä¸ºè¾“å…¥æ¡†æŒ‡å®š value å’Œ onChange

ä½ å¯ä»¥å°†é‡å¤çš„é€»è¾‘åˆ†ç¦»åˆ° useFormInput çš„è‡ªå®šä¹‰ Hook ä¸­:

```javascript App.js
import { useFormInput } from './useFormInput.js';

export default function Form() {
  const firstNameProps = useFormInput('Mary');
  const lastNameProps = useFormInput('Poppins');

  return (
    <>
      <label>
        First name:
        <input {...firstNameProps} />
      </label>
      <label>
        Last name:
        <input {...lastNameProps} />
      </label>
      <p><b>Good morning, {firstNameProps.value} {lastNameProps.value}.</b></p>
    </>
  );
}
```

```javascript useFormInput.js
import { useState } from 'react';

export function useFormInput(initialValue) {
  const [value, setValue] = useState(initialValue);

  function handleChange(e) {
    setValue(e.target.value);
  }

  const inputProps = {
    value: value,
    onChange: handleChange,
  }

  return inputProps;
}
```

æ³¨æ„è¿™é‡Œåªå£°æ˜äº†ä¸€ä¸ªå« value çš„ state å˜é‡ã€‚

ç„¶è€Œï¼ŒForm ç»„ä»¶è°ƒç”¨äº†ä¸¤æ¬¡ useFormInput:

```javascript
function Form() {
  const firstNameProps = useFormInput('Mary');
  const lastNameProps = useFormInput('Poppins');
  // ...
```

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒåƒå£°æ˜ä¸¤ä¸ªç‹¬ç«‹çš„ state ä¸€æ ·å·¥ä½œï¼

è‡ªå®šä¹‰ Hook ç„¶ä½ å…±äº«æœ‰çŠ¶æ€çš„é€»è¾‘ï¼Œè€Œä¸æ˜¯çŠ¶æ€æœ¬èº«ã€‚å¯¹ Hook çš„æ¯æ¬¡è°ƒç”¨å’Œå¯¹å®ƒçš„å…¶ä»–è°ƒç”¨ä¹‹é—´æ˜¯å®Œå…¨ç‹¬ç«‹çš„ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸Šé¢çš„ä¸¤ä¸ªæ²™ç®±ä¾‹å­æ˜¯å®Œå…¨ç­‰ä»·çš„ï¼Œæ¯”è¾ƒè¿™ä¸¤ä¸ªä¾‹å­ï¼Œæå–è‡ªå®šä¹‰ Hook çš„å‰åè¡Œä¸ºæ˜¯ç›¸åŒçš„

å½“ä½ éœ€è¦åœ¨å¤šä¸ªç»„ä»¶ä¹‹é—´å…±äº« state æœ¬èº«æ—¶ï¼Œè¯·å°†å…¶æå‡å¹¶å‘ä¸‹ä¼ é€’.

## åœ¨ Hooks é—´ä¼ é€’å“åº”å¼çš„å€¼

è‡ªå®šä¹‰ Hooks é‡Œçš„ä»£ç ä¼šåœ¨ç»„ä»¶æ¯æ¬¡é‡æ–°æ¸²æŸ“æ—¶å†æ¬¡è¿è¡Œï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå’Œç»„ä»¶ä¸€æ ·ï¼Œè‡ªå®šä¹‰ Hooks éœ€è¦ä¸ºçº¯å‡½æ•°ã€‚å°†è‡ªå®šä¹‰ Hooks å…¶ä¸­çš„ä»£ç è§†ä¸ºä½ ç»„ä»¶çš„ä¸€éƒ¨åˆ†!

å› ä¸ºè‡ªå®šä¹‰ Hooks å’Œç»„ä»¶ä¸€èµ·é‡æ–°æ¸²æŸ“ï¼Œå®ƒä»¬æ€»èƒ½æ¥å—åˆ°æœ€æ–°çš„ props å’Œ stateã€‚è¦äº†è§£è¿™æ„å‘³ç€ä»€ä¹ˆï¼Œçœ‹çœ‹ä¸‹é¢çš„èŠå¤©å®¤ä¾‹å­ï¼Œæ›´æ”¹ serverUr æˆ– èŠå¤©å®¤

```javascript app.js
import { useState } from 'react';
import ChatRoom from './ChatRoom.js';

export default function App() {
  const [roomId, setRoomId] = useState('general');
  return (
    <>
      <label>
        Choose the chat room:{' '}
        <select
          value={roomId}
          onChange={e => setRoomId(e.target.value)}
        >
          <option value="general">general</option>
          <option value="travel">travel</option>
          <option value="music">music</option>
        </select>
      </label>
      <hr />
      <ChatRoom
        roomId={roomId}
      />
    </>
  );
}

```

```javascript ChatRoom.js
import { useState, useEffect } from 'react';
import { createConnection } from './chat.js';
import { showNotification } from './notifications.js';

export default function ChatRoom({ roomId }) {
  const [serverUrl, setServerUrl] = useState('https://localhost:1234');

  useEffect(() => {
    const options = {
      serverUrl: serverUrl,
      roomId: roomId
    };
    const connection = createConnection(options);
    connection.on('message', (msg) => {
      showNotification('New message: ' + msg);
    });
    connection.connect();
    return () => connection.disconnect();
  }, [roomId, serverUrl]);

  return (
    <>
      <label>
        Server URL:
        <input value={serverUrl} onChange={e => setServerUrl(e.target.value)} />
      </label>
      <h1>Welcome to the {roomId} room!</h1>
    </>
  );
}
```

```javascript chat.js
export function createConnection({ serverUrl, roomId }) {
  // A real implementation would actually connect to the server
  if (typeof serverUrl !== 'string') {
    throw Error('Expected serverUrl to be a string. Received: ' + serverUrl);
  }
  if (typeof roomId !== 'string') {
    throw Error('Expected roomId to be a string. Received: ' + roomId);
  }
  let intervalId;
  let messageCallback;
  return {
    connect() {
      console.log('âœ… Connecting to "' + roomId + '" room at ' + serverUrl + '...');
      clearInterval(intervalId);
      intervalId = setInterval(() => {
        if (messageCallback) {
          if (Math.random() > 0.5) {
            messageCallback('hey')
          } else {
            messageCallback('lol');
          }
        }
      }, 3000);
    },
    disconnect() {
      clearInterval(intervalId);
      messageCallback = null;
      console.log('âŒ Disconnected from "' + roomId + '" room at ' + serverUrl + '');
    },
    on(event, callback) {
      if (messageCallback) {
        throw Error('Cannot add the handler twice.');
      }
      if (event !== 'message') {
        throw Error('Only "message" event is supported.');
      }
      messageCallback = callback;
    },
  };
}

```

```javascript notification.js
import Toastify from 'toastify-js';
import 'toastify-js/src/toastify.css';

export function showNotification(message, theme = 'dark') {
  Toastify({
    text: message,
    duration: 2000,
    gravity: 'top',
    position: 'right',
    style: {
      background: theme === 'dark' ? 'black' : 'white',
      color: theme === 'dark' ? 'white' : 'black',
    },
  }).showToast();
}

```

å½“ä½ ä¿®æ”¹ serverUrl æˆ– roomId æ—¶ï¼ŒEffect ä¼šå“åº”ä½ çš„å˜åŒ–å¹¶å†æ¬¡åŒæ­¥ï¼Œä½ ä»æ§åˆ¶å°ä¿¡æ¯ä¸­å¯ä»¥çœ‹å‡ºï¼Œæ¯æ¬¡ä½ æ›´æ”¹ Effect çš„ä¾èµ–é¡¹æ—¶ï¼ŒèŠå¤©éƒ½ä¼šé‡æ–°è¿æ¥ã€‚

å°† Effect çš„ä»£ç ç§»å…¥ä¸€ä¸ªè‡ªå®šä¹‰ Hook ä¸­:

```javascript
export function useChatRoom({ serverUrl, roomId }) {
  useEffect(() => {
    const options = {
      serverUrl,
      roomId
    }
    const connection = createConnection(options);
    connection.connect();
    connection.on('message', (msg) => {
      showNotification('New message: ' + msg);
    })
    return () => {
      connection.disconnect();
    }
  }, [roomId, serverUrl])
}
```

è¿™è®©ä½ çš„ ChatRoom ç»„ä»¶èƒ½è°ƒç”¨è‡ªå®šä¹‰ Hook è€Œæ— éœ€æ‹…å¿ƒå…¶å†…éƒ¨çš„å·¥ä½œè¿‡ç¨‹

```javascript
export default function ChatRoom({ roomId }) {
  const [serverUrl, setServerUrl] = useState('https://localhost:1234');

  useChatRoom({
    roomId: roomId,
    serverUrl: serverUrl
  });

  return (
    <>
      <label>
        Server URL:
        <input value={serverUrl} onChange={e => setServerUrl(e.target.value)} />
      </label>
      <h1>Welcome to the {roomId} room!</h1>
    </>
  );
}
```

è¿™çœ‹èµ·æ¥ç®€å•å¤šäº†

æ³¨æ„å½“ props å’Œ state å˜åŒ–æ—¶ï¼Œé€»è¾‘ä»ç„¶ä¼šå“åº”ã€‚å°è¯•ç¼–è¾‘ serverUrl æˆ–é€‰ä¸­çš„èŠå¤©å®¤ã€‚

æ³¨æ„åˆ°ä½ æ—¶å¦‚ä½•è·å–ä¸€ä¸ª Hook çš„è¿”å›å€¼çš„:

```javascript
export default function ChatRoom({ roomId }) {
  const [serverUrl, setServerUrl] = useState('https://localhost:1234');

  useChatRoom({
    roomId: roomId,
    serverUrl: serverUrl
  });
  // ...
```

å¹¶å°†å…¶ä¼ é€’ç»™å¦ä¸€ä¸ª Hook:

```javascript
export default function ChatRoom({ roomId }) {
  const [serverUrl, setServerUrl] = useState('https://localhost:1234');

  useChatRoom({
    roomId: roomId,
    serverUrl: serverUrl
  });
  // ...
```

æ¯æ¬¡ ChatRoom ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ï¼Œå®ƒéƒ½ä¼šå°†æœ€æ–°çš„ roomId å’Œ serverUrl ä¼ é€’ç»™è‡ªå®šä¹‰ Hookï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ— è®ºä½•æ—¶ roomId å’Œ serverUrl åœ¨é‡æ–°æ¸²æŸ“æ—¶å˜äº†ï¼ŒEffect éƒ½ä¼šé‡è¿åˆ°æœåŠ¡å™¨ã€‚

## ä¸ºè‡ªå®šä¹‰ Hooks ä¼ é€’äº‹ä»¶å¤„ç†ç¨‹åº

å½“ä½ åœ¨æ›´å¤šç»„ä»¶ä¸­ä½¿ç”¨ useChatRoom ç»„ä»¶æ—¶ï¼Œä½ å¯èƒ½æƒ³è®©ç»„ä»¶æ¥è‡ªå®šä¹‰å®ƒçš„è¡Œä¸ºã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå½“å‰æ¶ˆæ¯åˆ°è¾¾æ—¶è¦åšä»€ä¹ˆçš„é€»è¾‘è¢«ç¡¬ç¼–ç åˆ° Hook ä¸­:

```javascript
export function useChatRoom({ serverUrl, roomId }) {
  useEffect(() => {
    const options = {
      serverUrl: serverUrl,
      roomId: roomId
    };
    const connection = createConnection(options);
    connection.connect();
    connection.on('message', (msg) => {
      showNotification('New message: ' + msg);
    });
    return () => connection.disconnect();
  }, [roomId, serverUrl]);
}
```

å‡è®¾ä½ æƒ³å°†è¿™æ®µé€»è¾‘ç§»å›åˆ°ä½ çš„ç»„ä»¶ä¸­:

```javascript
export default function ChatRoom({ roomId }) {
  const [serverUrl, setServerUrl] = useState('https://localhost:1234');

  useChatRoom({
    roomId: roomId,
    serverUrl: serverUrl,
    onReceiveMessage(msg) {
      showNotification('New message: ' + msg);
    }
  });
  // ...
```

è¦è®©è¿™æ®µä»£ç å·¥ä½œï¼Œæ›´æ”¹è‡ªå®šä¹‰ Hook å¹¶å°† onReceiveMessage ä½œä¸ºå®ƒçš„é€‰é¡¹ä¹‹ä¸€:

```javascript
export function useChatRoom({ serverUrl, roomId, onReceiveMessage }) {
  useEffect(() => {
    const options = {
      serverUrl: serverUrl,
      roomId: roomId
    };
    const connection = createConnection(options);
    connection.connect();
    connection.on('message', (msg) => {
      onReceiveMessage(msg);
    });
    return () => connection.disconnect();
  }, [roomId, serverUrl, onReceiveMessage]); // âœ… All dependencies declared
}
```

è¿™å°±å¯ä»¥äº†ï¼Œä½†æ˜¯å½“ä½ çš„è‡ªå®šä¹‰ Hook æ¥å—äº‹ä»¶å¤„ç†ç¨‹åºæ—¶ï¼Œè¿˜å¯ä»¥æ·»åŠ å¦ä¸€é¡¹æ”¹è¿›:

æ·»åŠ å¯¹ onReceiveMessage çš„ä¾èµ–å¹¶ä¸ç†æƒ³ï¼Œå› ä¸ºå®ƒå°†å¯¼è‡´èŠå¤©å®¤åœ¨æ¯æ¬¡ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶éƒ½ä¼šé‡è¿åˆ°æœåŠ¡å™¨ï¼Œå°†è¿™ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºåŒ…è£…ä¸ºä¸€ä¸ª Effect Eventï¼Œå¹¶å°†å…¶ä»ä¾èµ–é¡¹ä¸­ç§»é™¤:

```javascript
import { useEffect, useEffectEvent } from 'react';
// ...

export function useChatRoom({ serverUrl, roomId, onReceiveMessage }) {
  const onMessage = useEffectEvent(onReceiveMessage);

  useEffect(() => {
    const options = {
      serverUrl: serverUrl,
      roomId: roomId
    };
    const connection = createConnection(options);
    connection.connect();
    connection.on('message', (msg) => {
      onMessage(msg);
    });
    return () => connection.disconnect();
  }, [roomId, serverUrl]); // âœ… All dependencies declared
}
```

ç°åœ¨èŠå¤©ä¸ä¼šåœ¨æ¯æ¬¡ ChatRoom é‡æ–°æ¸²æŸ“æ—¶é‡è¿åˆ°æœåŠ¡å™¨äº†ï¼Œä¸‹é¢æ˜¯å®Œæ•´çš„ä»£ç :

TODO:CODE

æ³¨æ„åˆ°ä½ ä¸å†éœ€è¦äº†è§£ useChatRoom çš„å·¥ä½œåŸç†å°±å¯ä»¥ç”¨å®ƒäº†ï¼Œä½ å¯ä»¥å°†å®ƒæ·»åŠ åˆ°ä»»æ„ç»„ä»¶ä¸­ï¼Œä¼ é€’ä»»ä½•å…¶ä»–é€‰é¡¹ï¼Œå®ƒä¼šä»¥ç›¸åŒçš„æ–¹å¼å·¥ä½œï¼Œè¿™å°±æ˜¯è‡ªå®šä¹‰ Hook çš„åŠ›é‡ï¼

## ä½•æ—¶ä½¿ç”¨è‡ªå®šä¹‰ Hooks

ä½ ä¸éœ€è¦ä¸ºæ¯ä¸€å°æ®µçš„é‡å¤ä»£ç æå–è‡ªå®šä¹‰ Hookï¼Œæœ‰äº›é‡å¤ä»£ç æ˜¯ ok çš„ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä¹‹å‰ä¾‹å­ä¸­ç”¨ useFormInput Hook æ¥åŒ…è£¹ä¸€ä¸ª useState çš„è°ƒç”¨å¯èƒ½æ˜¯æ²¡å¿…è¦çš„ã€‚

ä½†æ˜¯ï¼Œæ¯å½“ä½ åœ¨ç¼–å†™ Effect æ—¶ï¼Œæ¸…è€ƒè™‘å°†å…¶åŒ…è£…åœ¨è‡ªå®šä¹‰ Hook ä¸­æ˜¯å¦ä¼šæ›´åŠ æ¸…æ™°ï¼Œä½ ä¸åº”è¯¥ç»å¸¸éœ€è¦ Effectsï¼Œæ‰€ä»¥å¦‚æœä½ æ­£åœ¨å†™ä¸€ä¸ªï¼Œè¿™æ„å‘³ç€ä½ éœ€è¦èµ°å‡º React ä»¥ä¸ä¸€äº›å¤–éƒ¨ç³»ç»ŸåŒæ­¥æˆ–åšä¸€äº› React å†…ç½® API åšä¸åˆ°äº‹ã€‚å°†å…¶åŒ…è£…åˆ°è‡ªå®šä¹‰ Hook ä¸­å¯ä»¥è®©ä½ å‡†ç¡®çš„è¡¨è¾¾ä½ çš„æ„å›¾å’Œå…¶ä¸­çš„æ•°æ®æµå‘ã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œè€ƒè™‘æ˜¾ç¤ºä¸¤ä¸ªä¸‹æ‹‰åˆ—è¡¨çš„ ShippingForm ç»„ä»¶: ä¸€ä¸ªæ˜¾ç¤ºåŸå¸‚åˆ—è¡¨ï¼Œä¸€ä¸ªæ˜¾ç¤ºæ‰€é€‰åŸå¸‚çš„åŒºåŸŸåˆ—è¡¨ï¼Œä¸€å¼€å§‹çš„ä»£ç å¯èƒ½æ˜¯è¿™æ ·çš„:

```javascript
function ShippingForm({ country }) {
  const [cities, setCities] = useState(null);
  // This Effect fetches cities for a country
  useEffect(() => {
    let ignore = false;
    fetch(`/api/cities?country=${country}`)
      .then(response => response.json())
      .then(json => {
        if (!ignore) {
          setCities(json);
        }
      });
    return () => {
      ignore = true;
    };
  }, [country]);

  const [city, setCity] = useState(null);
  const [areas, setAreas] = useState(null);
  // This Effect fetches areas for the selected city
  useEffect(() => {
    if (city) {
      let ignore = false;
      fetch(`/api/areas?city=${city}`)
        .then(response => response.json())
        .then(json => {
          if (!ignore) {
            setAreas(json);
          }
        });
      return () => {
        ignore = true;
      };
    }
  }, [city]);

  // ...
```

è™½ç„¶è¿™æ®µä»£ç çœ‹èµ·æ¥æ˜¯é‡å¤çš„ï¼Œä½†æ˜¯ä¿æŒè¿™äº› Effects å’Œå…¶ä»–ç‹¬ç«‹æ˜¯äº‰å–çš„ã€‚å®ƒä»¬åŒæ­¥æ˜¯ä¸œè¥¿æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥ä½ ä¸åº”è¯¥å°†å®ƒä»¬åˆå¹¶ä¸ºä¸€ä¸ª Effectã€‚ç›¸åï¼Œä½ å¯ä»¥å°†å®ƒä»¬çš„é€šç”¨é€»è¾‘æå–åˆ°è‡ªå·±çš„ useData Hook ä¸­æ¥ç®€åŒ–ä¸Šé¢çš„ç»„ä»¶:

```javascript
function useData(url) {
  const [data, setData] = useState(null);
  useEffect(() => {
    if (url) {
      let ignore = false;
      fetch(url)
        .then(response => response.json())
        .then(json => {
          if (!ignore) {
            setData(json);
          }
        });
      return () => {
        ignore = true;
      };
    }
  }, [url]);
  return data;
}
```

è¿™æ ·æ¯”å°±å¯ä»¥ç”¨ useData æ¥æ›¿æ¢ ShippingForm ç»„ä»¶çš„ä¸¤ä¸ª Effect äº†:

```javascript
function ShippingForm({ country }) {
  const cities = useData(`/api/cities?country=${country}`);
  const [city, setCity] = useState(null);
  const areas = useData(city ? `/api/areas?city=${city}` : null);
  // ...
```

æå–ä¸€ä¸ªè‡ªå®šä¹‰ Hook è®©æ•°æ®æµå‘æ›´åŠ æ¸…æ™°ï¼Œä½ è¾“å…¥ url ç„¶åè·å–æ•°æ®ï¼Œé€šè¿‡å°†ä½ çš„ Effect éšè—åˆ° useData ä¸­ï¼Œä½ è¿˜å¯ä»¥é˜²æ­¢æŸäº›ä½¿ç”¨ ShippingForm çš„åŒäº‹ä¸ºå…¶æ·»åŠ äº†ä¸å¿…è¦çš„ä¾èµ–ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œä½ çš„åº”ç”¨çš„å¤§éƒ¨åˆ†æ•ˆæœéƒ½å°†åœ¨è‡ªå®šä¹‰ Hook ä¸­ã€‚

## æ·±åº¦é˜…è¯»: è®©ä½ çš„è‡ªå®šä¹‰ Hooks ä¸“æ³¨äºå…·ä½“çš„é«˜çº§ç”¨ä¾‹

é¦–å…ˆé€‰æ‹©ä½ çš„è‡ªå®šä¹‰ Hook çš„åç§°ï¼Œå¦‚æœä½ éš¾ä»¥é€‰æ‹©ä¸€ä¸ªæ¸…æ™°çš„åå­—ï¼Œåˆ™å¯èƒ½æ„å‘³ç€ä½ çš„ Effect ä¸ç»„ä»¶ä¸­å‰©ä½™éƒ¨åˆ†çš„é€»è¾‘è¿‡äºè€¦åˆï¼Œå¹¶ä¸”å°šæœªå‡†å¤‡å¥½åˆ†ç¦»

ç†æƒ³æƒ…å†µä¸‹ï¼Œè‡ªå®šä¹‰ Hook çš„åç§°åº”è¯¥è¶³å¤Ÿæ¸…æ™°ï¼Œå³ä½¿æ˜¯ä¸ç»å¸¸å†™ä»£ç çš„äººä¹Ÿèƒ½å¾ˆå¥½çš„çŒœæµ‹å‡ºå®ƒèƒ½å¹²ä»€ä¹ˆï¼Œæ¥å—ä»€ä¹ˆå‚æ•°å’Œè¿”å›ä»€ä¹ˆå€¼:

```javascript
useData(url);
useImpressionLog(eventName, extraData);
useChatRoom(options);
```

å½“ä½ ä¸å¤–éƒ¨ç³»ç»ŸåŒæ­¥æ—¶ï¼Œè‡ªå®šä¹‰ Hook çš„åç§°å¯èƒ½æ›´å…·æŠ€æœ¯æ€§å¹¶ä¸”ä½¿ç”¨è¯¥ç³»ç»Ÿç‰¹æœ‰çš„ä¸“ä¸šæœ¯è¯­ï¼Œåªè¦å¯¹ç†Ÿæ‚‰è¯¥ç³»ç»Ÿçš„æ¥è¯´æ˜¯æ¸…æ™°çš„å°±å¯ä»¥äº†:

```javascript
useMediaQuery(query);
useSockect(url);
useIntersectionObserver(ref, options);
```

è®©è‡ªå®šä¹‰ Hook ä¸“æ³¨äºå…·ä½“çš„é«˜çº§çš„ç”¨é€”ã€‚é¿å…åˆ›å»ºå’Œä½¿ç”¨è‡ªå®šä¹‰çš„ â€œç”Ÿå‘½å‘¨æœŸâ€ Hooksï¼Œè¿™äº› Hooks å……å½“ useEffect API æœ¬èº«çš„æ›¿ä»£å’Œç®€å•åŒ…è£…:

```javascript
useMount(fn);
useEffectOnce(fn);
useUpdateEffect(fn);
```

ä¸¾ä¸ªä¾‹å­ï¼Œè¿™ä¸ª useMount çš„ hook å°è¯•æŸäº›ä»£ç åªä¼šåœ¨ æŒ‚è½½æ—¶è¿è¡Œ:

```javascript
function ChatRoom({ roomId }) {
  const [serverUrl, setServerUrl] = useState('https://localhost:1234');

  // ğŸ”´ Avoid: using custom "lifecycle" Hooks
  useMount(() => {
    const connection = createConnection({ roomId, serverUrl });
    connection.connect();

    post('/analytics/event', { eventName: 'visit_chat' });
  });
  // ...
}

// ğŸ”´ Avoid: creating custom "lifecycle" Hooks
function useMount(fn) {
  useEffect(() => {
    fn();
  }, []); // ğŸ”´ React Hook useEffect has a missing dependency: 'fn'
}
```

æƒ³ useMount è¿™æ ·çš„è‡ªå®šä¹‰çš„ ç”Ÿå‘½å‘¨æœŸ Hooks å¹¶ä¸é€‚åˆ React èŒƒå¼ã€‚ä¾‹å¦‚ï¼Œè¿™ä¸ªä»£ç æœ‰ä¸€ä¸ªé”™è¯¯(å®ƒä¸ä¼šå¯¹ roomId æˆ– serverUrl çš„æ›´æ”¹åšå‡º â€œååº”â€)ï¼Œä½†æ˜¯ linter ä¸ä¼šä¸ºæ­¤å‘å‡ºè­¦å‘Šï¼Œå› ä¸º linter ä»…æ£€æŸ¥ç›´æ¥çš„ useEffect è°ƒç”¨ï¼Œè€Œå¯¹ä½ çš„è‡ªå®šä¹‰ Hook ä¸€æ— æ‰€çŸ¥ã€‚

å¦‚æœä½ æ­£åœ¨å†™ Effectï¼Œé¦–å…ˆç›´æ¥å†™ React APIã€‚

```javascript
function ChatRoom({ roomId }) {
  const [serverUrl, setServerUrl] = useState('https://localhost:1234');

  // âœ… Good: two raw Effects separated by purpose

  useEffect(() => {
    const connection = createConnection({ serverUrl, roomId });
    connection.connect();
    return () => connection.disconnect();
  }, [serverUrl, roomId]);

  useEffect(() => {
    post('/analytics/event', { eventName: 'visit_chat', roomId });
  }, [roomId]);

  // ...
}
```

ç„¶åä½ å¯ä»¥ä¸ºä¸åŒçš„é«˜çº§ç”¨ä¾‹æå–è‡ªå®šä¹‰ Hooks(éå¿…é¡»):

```javascript
function ChatRoom({ roomId }) {
  const [serverUrl, setServerUrl] = useState('https://localhost:1234');

  // âœ… Great: custom Hooks named after their purpose
  useChatRoom({ serverUrl, roomId });
  useImpressionLog('visit_chat', { roomId });
  // ...
}
```

ä¸€ä¸ªå¥½çš„è‡ªå®šä¹‰ Hook é€šè¿‡é™åˆ¶å…¶ä½œç”¨è®©è°ƒç”¨ä»£ç æ›´å…·å£°æ˜æ€§ï¼Œä¸¾ä¸ªä¾‹å­ï¼ŒuseChatRoom(options) åªèƒ½è¿æ¥åˆ°èŠå¤©å®¤ï¼Œè€Œ useImpressionLog(eventName, extraData) åªèƒ½å°†å°è±¡æ—¥å¿—å‘é€ç»™ç»Ÿè®¡ã€‚å¦‚æœä½ çš„è‡ªå®šä¹‰ Hooks ä¸é™åˆ¶ç”¨ä¾‹å¹¶ä¸”éå¸¸æŠ½è±¡ï¼Œé‚£ä¹ˆé•¿è¿œæ¥çœ‹å®ƒå¼•å…¥çš„é—®é¢˜å¯èƒ½æ¯”è§£å†³çš„æ›´å¤šã€‚

## è‡ªå®šä¹‰ Hooks æœ‰åŠ©äºè¿ç§»åˆ°æ›´å¥½çš„ä»£ç èŒƒå¼

Effect æ˜¯ä¸€ä¸ª â€œä¾‹å¤–â€ï¼šå½“ä½ éœ€è¦ èµ°å‡ºReact å¹¶ä¸”æ²¡æœ‰æ›´å¥½çš„å†…ç½®æ–¹æ¡ˆé€‚åˆä½ çš„ç”¨ä¾‹æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒä»¬ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼ŒReact å›¢é˜Ÿçš„ç›®æ ‡æ˜¯é€šè¿‡ä¸ºæ›´å…·ä½“çš„é—®é¢˜æä¾›æ›´å…·ä½“çš„è§£å†³æ–¹æ¡ˆï¼Œå°†åº”ç”¨ä¸­ Effect çš„æ•°é‡é™åˆ°æœ€ä½ã€‚å°†ä½ çš„ Effect åŒ…è£…åˆ°è‡ªå®šä¹‰ Hooks ä¸­å¯ä»¥åœ¨æœªæ¥æ›´è½»æ¾å‡çº§ä½ çš„ä»£ç ã€‚

å†æ¬¡çœ‹ä¸‹è¿™ä¸ªä¾‹å­:

```javascript App.js
import { useOnlineStatus } from './useOnlineStatus.js';

function StatusBar() {
  const isOnline = useOnlineStatus();
  return <h1>{isOnline ? 'âœ… Online' : 'âŒ Disconnected'}</h1>;
}

function SaveButton() {
  const isOnline = useOnlineStatus();

  function handleSaveClick() {
    console.log('âœ… Progress saved');
  }

  return (
    <button disabled={!isOnline} onClick={handleSaveClick}>
      {isOnline ? 'Save progress' : 'Reconnecting...'}
    </button>
  );
}

export default function App() {
  return (
    <>
      <SaveButton />
      <StatusBar />
    </>
  );
}

```

```javascript useOnlineStatus
import { useState, useEffect } from 'react';

export function useOnlineStatus() {
  const [isOnline, setIsOnline] = useState(true);
  useEffect(() => {
    function handleOnline() {
      setIsOnline(true);
    }
    function handleOffline() {
      setIsOnline(false);
    }
    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);
    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
    };
  }, []);
  return isOnline;
}

```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼ŒuseOnlineStatus æ˜¯é€šè¿‡ä¸€å¯¹ useState å’Œ useEffect å®ç°çš„ã€‚ç„¶è€Œè¿™å¹¶ä¸æ˜¯æœ€å¥½çš„å®ç°æ–¹æ¡ˆï¼Œå®ƒæ²¡æœ‰è€ƒè™‘åˆ°å¾ˆå¤šè¾¹ç¼˜åœºæ™¯ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå®ƒå‡è®¾å½“ç»„ä»¶æŒ‚è½½æ—¶ï¼ŒisOnline å·²ç»ä¸º true äº†ï¼Œä½†æ˜¯å¦‚æœç½‘ç»œå·²ç»ç¦»çº¿äº†ï¼Œè¿™å¯èƒ½æ˜¯é”™çš„ã€‚ä½ å¯ä»¥ä½¿ç”¨æµè§ˆå™¨çš„ navigator.onLine æ¥æ£€æŸ¥å®ƒï¼Œä½†æ˜¯åœ¨æœåŠ¡å™¨ç”Ÿæˆåˆå§‹åŒ– HTML çš„æ—¶å€™è¿™ä¸ªä¸å¯ç”¨çš„ï¼Œç®€è€Œè¨€ä¹‹ï¼Œè¿™æ®µä»£ç å¯ä»¥æ”¹è¿›:

```javascript useOnlineStatus
import { useSyncExternalStore } from 'react';

function subscribe(callback) {
  window.addEventListener('online', callback);
  window.addEventListener('offline', callback);
  return () => {
    window.removeEventListener('online', callback);
    window.removeEventListener('offline', callback);
  };
}

export function useOnlineStatus() {
  return useSyncExternalStore(
    subscribe,
    () => navigator.onLine, // How to get the value on the client
    () => true // How to get the value on the server
  );
}
```

æ³¨æ„ä½ ä¸è¦å¯¹ç»„ä»¶åšå‡ºä»»ä½•æ›´æ”¹å°±èƒ½å®Œæˆè¿™æ¬¡ä¼˜åŒ–äº†:

```javascript
function StatusBar() {
  const isOnline = useOnlineStatus();
  // ...
}

function SaveButton() {
  const isOnline = useOnlineStatus();
  // ...
}
```

è¿™å°±æ˜¯å°† Effects åŒ…è£…åˆ°è‡ªå®šä¹‰ Hooks å¾ˆæœ‰ç›Šçš„å¦ä¸€ä¸ªåŸå› äº†:

1. è®©æµå…¥å’Œæµå‡º Effects çš„æ•°æ®æ›´åŠ æ¸…æ™°
2. è®©ç»„ä»¶æ›´ä¸“æ³¨äºå…¶ç›®çš„è€Œé Effects çš„å®ç°ç»†èŠ‚
3. å½“ React æ·»åŠ äº†æ–°çš„ç‰¹æ€§æ—¶ï¼Œä½ å¯ä»¥åˆ é™¤è¿™äº› Effects è€Œæ— éœ€æ›´æ”¹ä»»ä½•ç»„ä»¶ä»£ç 

å’Œè®¾è®¡ç³»ç»Ÿç±»ä¼¼ï¼Œä½ å¯èƒ½ä¼šå‘ç°å°†åº”ç”¨çš„å¸¸ç”¨èŒƒå¼æå–åˆ°è‡ªå®šä¹‰ Hooks ä¼šå¾ˆæœ‰ç”¨ã€‚æµ™æ±Ÿè®©ä½ çš„ç»„ä»¶ä»£ç ä¸“æ³¨äºå…¶æ„å›¾ï¼Œå¹¶è®©ä½ é¿å…é¢‘ç¹ç¼–å†™åŸå§‹ Effectsï¼Œè®¸å¤šä¼˜ç§€çš„è‡ªå®šä¹‰ Hooks ç”± React ç¤¾åŒºç»´æŠ¤

## React ä¼šæä¾›å†…ç½®çš„æ•°æ®è·å–æ–¹å¼å—

æˆ‘ä»¬ä»åœ¨åˆ¶å®šå­—èŠ‚ä¸­ï¼Œå½“æˆ‘ä»¬å¸Œæœ›å°†æ¥ä½ å¯ä»¥åƒè¿™æ ·ç¼–å†™æ•°æ®è·å–:

```javascript
import { use } from 'react'; // Not available yet!

function ShippingForm({ country }) {
  const cities = use(fetch(`/api/cities?country=${country}`));
  const [city, setCity] = useState(null);
  const areas = city ? use(fetch(`/api/areas?city=${city}`)) : null;
  // ...
```

å¦‚æœä½ åœ¨åº”ç”¨ä¸­ä½¿ç”¨åƒä¸Šé¢çš„ useData è¿™æ ·çš„è‡ªå®šä¹‰ Hookï¼Œé‚£ä¹ˆä¸ä½ åœ¨æ¯ä¸ªç»„ä»¶ä¸­æ‰‹åŠ¨ç¼–å†™åŸå§‹ Effect ç›¸æ¯”ï¼Œè¿ç§»åˆ°æœ€ç»ˆæ¨èçš„æ–¹å¼æ‰€éœ€çš„æ›´æ”¹æ›´å°‘ï¼Œä½†æ˜¯ï¼Œæ—§çš„æ–¹å¼ä»ç„¶å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œå¦‚æœä½ åçˆ±ç¼–å†™åŸå§‹çš„ Effectï¼Œå¯ä»¥ç»§ç»­è¿™æ ·åš

## è¿˜æœ‰ä¸€ç§æ–¹å¼

å‡è®¾ä½ æƒ³ä½¿ç”¨æµè§ˆå™¨çš„ requestAnimationFrame API ä»å¤´å®ç°æ·¡å…¥åŠ¨ç”»ï¼Œä½ å¯ä»¥ä»è®¾ç½®åŠ¨ç”»å¾ªç¯çš„ Effect å¼€å§‹ï¼Œåœ¨åŠ¨ç”»çš„æ¯ä¸€å¸§ä¸­ï¼Œä½ å¯ä»¥ä¿®æ”¹ refä¸­ä¿å­˜çš„ DOM èŠ‚ç‚¹çš„é€æ˜åº¦ï¼Œç›´åˆ°å®ƒè¾¾åˆ° 1ã€‚ä»£ç å¼€å§‹çœ‹èµ·æ¥åƒè¿™æ ·:

```javascript
import { useState, useEffect, useRef } from 'react';

function Welcome() {
  const ref = useRef(null);

  useEffect(() => {
    const duration = 1000;
    const node = ref.current;

    let startTime = performance.now();
    let frameId = null;

    function onFrame(now) {
      const timePassed = now - startTime;
      const progress = Math.min(timePassed / duration, 1);
      onProgress(progress);
      if (progress < 1) {
        // We still have more frames to paint
        frameId = requestAnimationFrame(onFrame);
      }
    }

    function onProgress(progress) {
      node.style.opacity = progress;
    }

    function start() {
      onProgress(0);
      startTime = performance.now();
      frameId = requestAnimationFrame(onFrame);
    }

    function stop() {
      cancelAnimationFrame(frameId);
      startTime = null;
      frameId = null;
    }

    start();
    return () => stop();
  }, []);

  return (
    <h1 className="welcome" ref={ref}>
      Welcome
    </h1>
  );
}

export default function App() {
  const [show, setShow] = useState(false);
  return (
    <>
      <button onClick={() => setShow(!show)}>
        {show ? 'Remove' : 'Show'}
      </button>
      <hr />
      {show && <Welcome />}
    </>
  );
}

```

ä¸ºäº†æé«˜ç»„ä»¶çš„å¯è¯»æ€§ï¼Œå°†é€»è¾‘æå–åˆ° useFadeIn çš„è‡ªå®šä¹‰ Hook ä¸­:

```javascript
import { useEffect } from 'react';

export function useFadeIn(ref, duration) {
  useEffect(() => {
    const node = ref.current;

    let startTime = performance.now();
    let frameId = null;

    function onFrame(now) {
      const timePassed = now - startTime;
      const progress = Math.min(timePassed / duration, 1);
      onProgress(progress);
      if (progress < 1) {
        // We still have more frames to paint
        frameId = requestAnimationFrame(onFrame);
      }
    }

    function onProgress(progress) {
      node.style.opacity = progress;
    }

    function start() {
      onProgress(0);
      startTime = performance.now();
      frameId = requestAnimationFrame(onFrame);
    }

    function stop() {
      cancelAnimationFrame(frameId);
      startTime = null;
      frameId = null;
    }

    start();
    return () => stop();
  }, [ref, duration]);
}

```

ä½ å¯ä»¥ä½¿ç”¨ useFadeIn çš„ä»£ç ï¼Œä½ è¿˜å¯ä»¥ç»§ç»­é‡æ„ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä½ å¯ä»¥å°†è®¾ç½®åŠ¨ç”»å¾ªç¯çš„é€»è¾‘æå–åˆ° useAnimationLoop çš„è‡ªå®šä¹‰ Hook ä¸­:

```javascript
import { useState, useEffect } from 'react';
import { experimental_useEffectEvent as useEffectEvent } from 'react';

export function useFadeIn(ref, duration) {
  const [isRunning, setIsRunning] = useState(true);

  useAnimationLoop(isRunning, (timePassed) => {
    const progress = Math.min(timePassed / duration, 1);
    ref.current.style.opacity = progress;
    if (progress === 1) {
      setIsRunning(false);
    }
  });
}

function useAnimationLoop(isRunning, drawFrame) {
  const onFrame = useEffectEvent(drawFrame);

  useEffect(() => {
    if (!isRunning) {
      return;
    }

    const startTime = performance.now();
    let frameId = null;

    function tick(now) {
      const timePassed = now - startTime;
      onFrame(timePassed);
      frameId = requestAnimationFrame(tick);
    }

    tick();
    return () => cancelAnimationFrame(frameId);
  }, [isRunning]);
}

```

ç„¶è€Œè¿™ä¸æ˜¯å¿…é¡»çš„ï¼Œå’Œå¸¸è§„å‡½æ•°ä¸€æ ·ï¼Œæœ€ç»ˆä½ å†³å®šåœ¨å“ªé‡Œåˆ’å®šä»£ç çš„è¾¹ç•Œï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨éå¸¸ä¸åŒçš„æ–¹æ³•ï¼Œå°†å¤§éƒ¨åˆ†å‘½ä»¤å¼é€»è¾‘ç§»åŠ¨åˆ°ä¸€ä¸ª js çš„ç±»ä¸­ï¼Œè€Œä¸æ˜¯å°†å…¶ä¿ç•™åœ¨ Effect ä¸­:

```javascript useFadeIn
import { useState, useEffect } from 'react';
import { FadeInAnimation } from './animation.js';

export function useFadeIn(ref, duration) {
  useEffect(() => {
    const animation = new FadeInAnimation(ref.current);
    animation.start(duration);
    return () => {
      animation.stop();
    };
  }, [ref, duration]);
}

```

```javascript animation.js
export class FadeInAnimation {
  constructor(node) {
    this.node = node;
  }
  start(duration) {
    this.duration = duration;
    this.onProgress(0);
    this.startTime = performance.now();
    this.frameId = requestAnimationFrame(() => this.onFrame());
  }
  onFrame() {
    const timePassed = performance.now() - this.startTime;
    const progress = Math.min(timePassed / this.duration, 1);
    this.onProgress(progress);
    if (progress === 1) {
      this.stop();
    } else {
      // We still have more frames to paint
      this.frameId = requestAnimationFrame(() => this.onFrame());
    }
  }
  onProgress(progress) {
    this.node.style.opacity = progress;
  }
  stop() {
    cancelAnimationFrame(this.frameId);
    this.startTime = null;
    this.frameId = null;
    this.duration = 0;
  }
}

```

Effect è®©ä½ èƒ½å°† React è¿æ¥åˆ°å¤–éƒ¨ç³»ç»Ÿï¼ŒEffects ä¹‹é—´éœ€è¦çš„åè°ƒè¶Šå¤š(æ¯”å¦‚åˆ›å»ºä¸€ä¸ªå¤šä¸ªåŠ¨ç”»é“¾)ï¼Œå®Œå…¨ä» Effect å’Œ Hooks ä¸­æå–é€»è¾‘å°±è¶Šæœ‰æ„ä¹‰ã€‚ç„¶åä½ æå–çš„ä»£ç æˆä¸ºäº† å¤–éƒ¨ç³»ç»Ÿï¼Œè®©ä½ çš„ Effects ä¿æŒç®€æ´ï¼Œå› ä¸ºå®ƒä»¬åªéœ€è¦å‘ä½ ç§»åˆ° React ä¹‹å¤–çš„ç³»ç»Ÿå‘é€æ¶ˆæ¯

ä¸Šé¢çš„ç¤ºä¾‹ä¸­å‡è®¾äº†æ·¡å…¥é€»è¾‘éœ€è¦ç”¨ js ç¼–å†™ï¼Œç„¶è€Œè¿™ä¸ªåŠ¨ç”»ç”¨çº¯ CSS åŠ¨ç”»å®ç°æ—¢ç®€æ´åˆé«˜æ•ˆ:

TODO: CODE

æœ‰æ—¶å€™ä½ ç”šè‡³ä¸éœ€è¦ä¸€ä¸ª HOOK

## å›é¡¾

- è‡ªå®šä¹‰ Hook å…è®¸ä½ åœ¨ç»„ä»¶é—´å…±äº«é€»è¾‘
- è‡ªå®šä¹‰ Hook çš„æ˜æ˜å¿…é¡»ä»¥ use å¼€å§‹å¹¶æ¥ä¸€ä¸ªå¤§å†™å­—æ¯
- è‡ªå®šä¹‰ Hook åªå…±äº«æœ‰çŠ¶æ€çš„é€»è¾‘ï¼Œè€Œä¸æ˜¯çŠ¶æ€æœ¬èº«
- ä½ å¯ä»¥ä»åœ¨ Hook é—´ä¼ é€’å“åº”å¼å€¼ï¼Œå¹¶ä¸”å®ƒä»¬ä¼šä¿æŒæœ€æ–°
- ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶æ‰€æœ‰çš„ Hook ä¼šå†æ¬¡è¿è¡Œ
- å’Œç»„ä»¶ä¸€æ ·ï¼Œè‡ªå®šä¹‰ Hook çš„ä»£ç å¿…é¡»æ˜¯çº¯å‡½æ•°
- å°†è‡ªå®šä¹‰ Hook æ¥å—åˆ°çš„äº‹ä»¶å¤„ç†ç¨‹åºåŒ…è£…åˆ° Effect Events ä¸­
- ä¸è¦åˆ›å»ºç±»ä¼¼ useMount çš„è‡ªå®šä¹‰ Hookï¼Œè‡ªå®šä¹‰ Hook çš„ç›®çš„è¦è¶³å¤Ÿæ˜ç¡®
- å¦‚ä½•é€‰æ‹©ä»£ç è¾¹ç•Œå–å†³äºä½ 
