
æœ‰äº›ç»„ä»¶éœ€è¦å’Œå¤–éƒ¨ç³»ç»ŸåŒæ­¥ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œä½ å¯èƒ½å¸Œæœ›æ ¹æ® React çš„ state æ¥æ§åˆ¶ä¸€ä¸ªé React ç»„ä»¶ã€è¿æ¥æœåŠ¡å™¨æˆ–è€…ç»„ä»¶æ¶ˆå¤±æ—¶å‘é€ä¸€ä¸ªç»Ÿè®¡æ—¥å¿—ã€‚effects å…è®¸ä½ åœ¨ç»„ä»¶æ¸²æŸ“åè¿è¡Œä¸€äº›ä»£ç ï¼Œè¿™æ ·ä½ å°±å¯ä»¥å°†ä½ çš„ç»„ä»¶ä¸ React ä¹‹å¤–çš„ä¸€äº›ç³»ç»ŸåŒæ­¥ã€‚

> ä½ å°†å­¦åˆ°
> - ä»€ä¹ˆæ˜¯ Effects
> - Effects å’Œäº‹ä»¶çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ
> - å¦‚ä½•åœ¨ç»„ä»¶ä¸­å£°æ˜ä¸€ä¸ª Effect
> - å¦‚ä½•è·³è¿‡ä¸å¿…è¦çš„ Effect
> - ä¸ºä»€ä¹ˆå¼€å‘æ¨¡å¼ä¸‹ Effects è¿è¡Œä¸¤æ¬¡ä»¥åŠå¦‚ä½•ä¿®å¤

## Effects æ˜¯ä»€ä¹ˆï¼Œå’Œ events çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ

åœ¨ä»‹ç» Effects ä¹‹å‰ï¼Œä½ éœ€è¦é¦–å…ˆç†Ÿæ‚‰ REact ç»„ä»¶ä¸­çš„ä¸¤ç§é€»è¾‘:

- æ¸²æŸ“ä»£ç ï¼š ä½äºä½ ç»„ä»¶å†…éƒ¨çš„é¡¶éƒ¨ï¼Œè¿™æ˜¯ä½ æ¥å— props å’Œ state å¹¶å°†å…¶è½¬æ¢ç„¶åè¿”å›éœ€è¦çš„ JSX çš„åœ°æ–¹ã€‚æ¸²æŸ“ä»£ç å¿…é¡»æ˜¯çº¯å‡½æ•°ï¼Œå’Œæ•°å­¦å…¬å¼ä¸€æ ·ï¼Œå®ƒåº”è¯¥åªè®¡ç®—ç»“æœè€Œä¸åšå…¶ä»–äº‹ã€‚
- äº‹ä»¶å¤„ç†ç¨‹åº: æ˜¯ç»„ä»¶å†…çš„åµŒå¥—å‡½æ•°ã€‚ä¸€ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºå¯èƒ½ä¼šæ›´æ–°ä¸€ä¸ªè¾“å…¥æ¡†ï¼Œæäº¤ä¸€ä¸ª HTTP POST è¯·æ±‚æ¥å¤Ÿä¹°äº§å“ï¼Œæˆ–è€…é‡å®šå‘ç”¨æˆ·åˆ°å¦ä¸€ä¸ªé¡µé¢ä¸­ã€‚æ—¶é—´å¤„ç†ç¨‹åºåŒ…å«äº†å…·ä½“çš„ç”¨æˆ·æ“ä½œå¼•èµ·çš„å‰¯ä½œç”¨(ä¿®æ”¹ç¨‹åºçš„çŠ¶æ€)

å…‰æœ‰è¿™äº›è¿˜ä¸å¤Ÿï¼Œè€ƒè™‘ä¸€ä¸ª ChatRoom ç»„ä»¶ï¼Œå®ƒåªè¦å‡ºç°åœ¨å±å¹•ä¸Šå°±å¾—è¿æ¥åˆ°èŠå¤©æœåŠ¡å™¨ã€‚è¿æ¥æœåŠ¡å™¨ä¸æ˜¯ä¸€ä¸ªçº¯è®¡ç®—è¿‡ç¨‹(å…·æœ‰å‰¯ä½œç”¨)ï¼Œæ‰€ä»¥ä¸åº”è¯¥åœ¨æ¸²æŸ“æœŸé—´è¿æ¥å®ƒï¼›ç„¶è€Œï¼Œç›®å‰ä¹Ÿæ²¡æœ‰ä¸€ä¸ªæ˜ç¡®çš„å¦‚ click çš„äº‹ä»¶æ¥è§¦å‘è¿æ¥ã€‚

Effects å…è®¸ä½ æŒ‡å®šæ¸²æŸ“æœ¬èº«äº§ç”Ÿçš„å‰¯ä½œç”¨ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå…·ä½“çš„äº‹ä»¶ã€‚åœ¨èŠå¤©å®¤ä¸­å‘é€ä¿¡æ¯æ˜¯ä¸€ä¸ªäº‹ä»¶ï¼Œå› ä¸ºå®ƒåœ¨ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æ—¶è§¦å‘ï¼›ç„¶è€Œï¼Œè¿æ¥æœåŠ¡å™¨æ˜¯ä¸€ä¸ª Effectï¼Œå› ä¸ºæ— è®ºä»€ä¹ˆäº¤äº’å¯¼è‡´ç»„ä»¶å‡ºç°äº†ï¼Œå®ƒéƒ½å¿…é¡»å‘ç”Ÿã€‚Effect åœ¨å±å¹•æ›´æ–°ä¹‹åçš„ commi ä¸­è¿è¡Œï¼Œè¿™ä¸ªæ—¶é—´ç‚¹å¯¹äºåŒæ­¥ React ç»„ä»¶å’Œå¤–éƒ¨ç³»ç»Ÿæ¥è¯´å¾ˆé€‚åˆ(æ¯”å¦‚ç½‘ç»œå’Œç¬¬ä¸‰æ–¹ä»“åº“)

> æ³¨æ„
> è¿™ä¸¤èŠ‚ä¸­çš„ Effect æŒ‡çš„æ˜¯ä¸Šé¢çš„ React ç‰¹å®šçš„å®šä¹‰ï¼Œå³æ¸²æŸ“å¼•èµ·çš„å‰¯ä½œç”¨ã€‚ä¸ºäº†æŒ‡ç‚¹æ›´å¹¿æ³›çš„ç¼–ç¨‹æ¦‚å¿µï¼Œæˆ‘ä»¬ä¼šè¯´ â€œå‰¯ä½œç”¨â€

## æˆ–è®¸ä½ ä¸éœ€è¦ Effect

ä¸è¦æ€¥äºä¸ºä½ çš„ç»„ä»¶æ·»åŠ  Effectsï¼Œå§‹ç»ˆç‰¢è®° Effect é€šå¸¸ç”¨äºè·³å‡ºä½ çš„ React ä»£ç å¹¶ä¸å¤–éƒ¨ç³»ç»ŸåŒæ­¥ã€‚è¿™åŒ…æ‹¬æµè§ˆå™¨ APIã€ç¬¬ä¸‰æ–¹æ’ä»¶ã€ç½‘ç»œç­‰ã€‚å¦‚æœä½ çš„ Effect ä»…ä»…åªæ˜¯åŸºäºå…¶ä»– state è°ƒæ•´ stateï¼Œä½ å¯èƒ½ä¸éœ€è¦ Effect

## å¦‚ä½•å†™ä¸€ä¸ª Effect

è¦å†™ä¸€ä¸ª Effectï¼Œéµå¾ªä»¥ä¸‹ä¸‰æ­¥:

1. å£°æ˜ä¸€ä¸ª Effectï¼Œé»˜è®¤æƒ…å†µä¸‹æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šè¿è¡Œå®ƒ
2. å£°æ˜ Effect çš„ä¾èµ–ã€‚å¤§å¤šæ•° Effects åº”è¯¥åªåœ¨å¿…è¦æ—¶è¿è¡Œè€Œéæ¯æ¬¡æ¸²æŸ“è¿è¡Œã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä¸€ä¸ªæ·¡å…¥åŠ¨ç”»åº”è¯¥åªå‡ºç°åœ¨ç»„ä»¶å‡ºç°æ—¶ï¼Œè¿æ¥èŠå¤©å®¤å’Œæ–­å¼€è¿æ¥åº”è¯¥åªå‡ºç°åœ¨ç»„ä»¶å‡ºç°å’Œæ¶ˆå¤±çš„æ—¶é—´ç‚¹ï¼Œæˆ–æ˜¯èŠå¤©å®¤å˜äº†ã€‚ä½ å°†å­¦ä¹ å¦‚ä½•é€šè¿‡æŒ‡å®šä¾èµ–æ¥æ§åˆ¶å®ƒã€‚
3. æŒ‰éœ€æ·»åŠ æ¸…ç†å‡½æ•°ã€‚æœ‰äº›å‰¯ä½œç”¨éœ€è¦æŒ‡å®šå¦‚ä½•åœæ­¢ã€æ¢å¤æˆ–æ¸…ç†å®ƒä»¬åšçš„äº‹ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œâ€œè¿æ¥â€æœåŠ¡å™¨éœ€è¦â€œæ–­å¼€â€è¿æ¥ï¼Œâ€œè®¢é˜…â€åéœ€è¦â€œé€€è®¢â€ï¼Œâ€œæ‹‰å–â€éœ€è¦â€œå–æ¶ˆâ€æˆ–â€œå¿½ç•¥â€ã€‚ä½ å°†å­¦ä¹ å¦‚ä½•é€šè¿‡è¿”å›ä¸€ä¸ªæ¸…ç†å‡½æ•°æ¥å®ç°è¿™ä¸€ç‚¹

ä¸‹é¢æ˜¯æ¯ä¸€æ­¥çš„ç»†èŠ‚:

### ç¬¬ä¸€æ­¥: å£°æ˜ Effect

è¦åœ¨ç»„ä»¶ä¸­å£°æ˜ Effectï¼Œä» React ä¸­å¯¼å…¥ useEffect:

```javascript
import { useEffect } from 'react';
```

ç„¶ååœ¨ç»„ä»¶å†…éƒ¨çš„é¡¶çº§ä½œç”¨åŸŸå†…è°ƒç”¨å®ƒï¼Œå¹¶åœ¨ Effect å†…æ”¾ä¸€äº›ä»£ç :

```javascript
function MyComponent() {
  useEffect(() => {
    // è¿™é‡Œçš„ä»£ç åœ¨æ¯æ¬¡ render æ—¶éƒ½ä¼šè¿è¡Œ
  })
  return <div></>
}
```

æ¯æ¬¡ä½ çš„ç»„ä»¶æ¸²æŸ“æ—¶ï¼ŒReact ä¼šæ›´æ–°å±å¹•æ˜¾ç¤ºå†…å®¹åè¿è¡Œ useEffect ä¸­çš„ä»£ç ã€‚æ¢å¥è¯è¯´ï¼ŒuseEffect â€œé˜»å¡â€ äº†è¿™æ®µä»£ç çš„è¿è¡Œï¼Œç›´åˆ°å½“æ¬¡æ¸²æŸ“è¢«æ˜¾ç¤ºåœ¨å±å¹•ä¸Šä»¥åã€‚

è®©æˆ‘ä»¬çœ‹é›ªçœ‹å¦‚ä½•ç”¨ä¸€ä¸ª Efffect æ¥ä¸å¤–éƒ¨ç³»ç»ŸåŒæ­¥ã€‚è€ƒè™‘ä¸€ä¸ª <VideoPlayer> ç»„ä»¶ï¼Œé€šè¿‡ isPlaying å±æ€§æ¥æ§åˆ¶å®ƒçš„æš‚åœå’Œæ’­æ”¾æ˜¯ä¸ªä¸é”™çš„ä¸»æ„:

```javascript
<VideoPlayer isPlaying={isPlaying} />
```

VideoPlayer å†…éƒ¨ç”¨äº†æµè§ˆå™¨å†…ç½®çš„ <video> æ ‡ç­¾æ¥æ¸²æŸ“:

```javascript
function VideoPlayer({ src, isPlaying }) {
  // TODO
  return <video src={src} />
}
```

ç„¶è€Œæµè§ˆå™¨å†…ç½®çš„ <video> æ ‡ç­¾å¹¶æ²¡æœ‰ isPlaying çš„å±æ€§ï¼Œåªèƒ½é€šè¿‡æ‰‹åŠ¨è°ƒç”¨å®ƒçš„ play()  å’Œ pause() æ–¹æ³•æ¥æ§åˆ¶æ’­æ”¾ã€‚æ‰€ä»¥ä½ éœ€è¦å°† isPlaying çš„å€¼å’Œ play() å’Œ pause() çš„æ–¹æ³•è°ƒç”¨åŒæ­¥èµ·æ¥ã€‚

é¦–å…ˆä¸º <video> æ·»åŠ ä¸€ä¸ª ref

ä½ æˆ–è®¸å°è¯•åœ¨æ¸²æŸ“æ—¶è°ƒç”¨ play() å’Œ pause()ï¼Œä½†æ˜¯å‡ºäº†ç‚¹é—®é¢˜:

```javascript
import {useState, useRef, useEffect} from 'react';

function VideoPlayer({ src, isPlaying }) {
  const ref = useRef(null);
  if (isPlaying) {
    ref.current.play()
  } else {
    ref.current.pause()
  }
  return <video ref={ref} src={src} loop playsInline />
}

export default function App() {
  const [isPlayint, setIsPlaying] = useState(false);
  return (
    <>
      <button onClick={() => {
        setIsPlaying(!isPlaying);  
      }}>{isPlaying ? 'Pause' : 'Play'}</button>
      <VideoPlayer
        isPlaying={isPlaying}
        src="https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4"
      />
    </>
  )
}
```

```txt
App.js: Cannot read properties of null (reading 'pause') (9:16)
å‡ºé—®é¢˜çš„ä»£ç : ref.current.pause(); 
è¿˜æœ‰: ref.current.play(); 
```

è¿™æ®µä»£ç çš„é—®é¢˜åœ¨äºå®ƒå°è¯•åœ¨æ¸²æŸ“æœŸé—´æ‰§è¡Œä¸€äº› DOM æ“ä½œï¼Œåœ¨ React ä¸­ï¼Œæ¸²æŸ“åº”è¯¥æ˜¯ä¸ªè¿”å› JSX çš„çº¯å‡½æ•°å¹¶ä¸”ä¸åº”è¯¥åŒ…å«ä»»ä½•å‰¯ä½œç”¨ï¼Œå°¤å…¶çš„ä¿®æ”¹ DOMã€‚

è€Œä¸”ï¼Œå½“ VideoPlayer è¢«é¦–æ¬¡è°ƒç”¨æ—¶ï¼Œå®ƒçš„ DOM è¿˜ä¸å­˜åœ¨å‘¢ï¼è¿™é‡Œå¹¶æ²¡æœ‰ä¸€ä¸ªå¯ä»¥è°ƒç”¨ play() æˆ– pause() çš„ DOM èŠ‚ç‚¹ï¼Œå› ä¸º React ç›´åˆ°ä½ è¿”å› JSX æ—¶æ‰çŸ¥é“å¦‚ä½•åˆ›å»º DOMèŠ‚ç‚¹ã€‚

è§£å†³é—®é¢˜çš„åŠæ³•æ˜¯å°†å‰¯ä½œç”¨ä»£ç ä»æ¸²æŸ“ä¸­ç§»é™¤ï¼Œå¹¶æ”¾å…¥ useEffect ä¸­

```javascript
import { useEffect, useRef } from 'react'

function VideoPlayer({ src, isPlaying }) {
  const ref = useRef(null);

  useEffect(() => {
    if (isPlaying) {
      ref.current.play();
    } else {
      ref.current.pause();
    }
  })

  return <video ref={ref} src={src} loop playsInline />
}
```

å°† DOM æ›´æ–°ç§»å…¥ Effect ä¸­ï¼Œä½ å…è®¸ React å…ˆæ›´æ–°æ˜¾ç¤ºï¼Œç„¶åå†è¿è¡Œä½ çš„ Effectã€‚

å½“ä½ çš„ VideoPlayer ç»„ä»¶æ¸²æŸ“æ—¶ï¼Œä¼šå‘ç”Ÿä¸€äº›äº‹æƒ…ã€‚é¦–å…ˆ React ä¼šæ›´æ–°å±å¹•æ˜¾ç¤ºï¼Œä¿è¯äº† video  æ ‡ç­¾åŠå±æ€§è¢«æ­£ç¡®çš„æ¸²æŸ“æˆ DOM äº†ã€‚ç„¶å React ä¼šè¿è¡Œä½ çš„ Effectã€‚æœ€ç»ˆï¼Œä½ çš„ Effect ä¼šæ ¹æ® isPlaying çš„å€¼å†³å®šæœ€ç»ˆè°ƒç”¨ play() è¿˜æ˜¯ pause

å¤šæ¬¡ç‚¹å‡» play å’Œ pause æŒ‰é’®æ¥çœ‹çœ‹ video æ ‡ç­¾æ˜¯å¦‚ä½•ä¸ isPlaying å±æ€§ä¿æŒåŒæ­¥çš„

```javascript
import { useEffect, useRef, useState } from 'react'

function VideoPlayer({ src, isPlaying }) {
  const ref = useRef(null);

  useEffect(() => {
    if (isPlaying) {
      ref.current.play();
    } else {
      ref.current.pause();
    }
  })

  return <video ref={ref} src={src} loop playsInline />
}

export default function App() {
  const [isPlaying, setIsPlaying] = useState(false);
  return (
    <>
      <button onClick={() => setIsPlaying(!isPlaying)}>
        {isPlaying ? 'Pause' : 'Play'}
      </button>
      <VideoPlayer
        isPlaying={isPlaying}
        src="https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4"
      />
    </>
  );
}
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½ å’Œ React state åŒæ­¥çš„å¤–éƒ¨ç³»ç»Ÿæ˜¯æµè§ˆå™¨åª’ä½“ APIã€‚ä½ å¯ä»¥ç”¨åŒæ ·çš„æ–¹å¼å°†é—ç•™çš„é React ä»£ç åŒ…è£¹ä¸ºå£°æ˜å¼çš„ React ç»„ä»¶ã€‚

æ³¨æ„åœ¨å®é™…çš„ä¾‹å­ä¸­æ§åˆ¶ video è¦å¤æ‚çš„å¤šï¼Œè°ƒç”¨ play() å¯èƒ½ä¼šå¤±è´¥ï¼Œç”¨æˆ·å¯èƒ½ä¼šä½¿ç”¨æµè§ˆå™¨å†…ç½®çš„æ§åˆ¶é¢æ¿æ¥æ’­æ”¾å’Œæš‚åœã€‚è¿™ä¸ªä¾‹å­å¾ˆç®€å•ï¼Œä»…ç”¨äºå±•ç¤ºã€‚

> é™·é˜±
>
> é»˜è®¤æƒ…å†µä¸‹æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šè¿è¡Œ Effectsï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸‹é¢çš„ä»£ç ä¼šæ­»å¾ªç¯

```javascript
const [count, setCount] = useState(0);
useEffect(() => {
  setCount(count + 1);
})
```

Effect ä½œä¸ºæ¸²æŸ“å‰¯ä½œç”¨è¿è¡Œï¼Œè®¾ç½® state ä¼šè§¦å‘æ¸²æŸ“ã€‚åœ¨ Effect ä¸­ç«‹å³è®¾ç½® stateå°±åƒå°†ç”µæºæ’åº§æ’å…¥è‡ªèº«ã€‚è¿è¡Œ Effectï¼Œè®¾ç½® stateï¼Œå…¶å¯¼è‡´å†æ¬¡æ¸²æŸ“ï¼Œå†æ¬¡æ¸²æŸ“åˆä¼šå¯¼è‡´ Effect çš„è¿è¡Œï¼Œç„¶ååˆå¯¼è‡´äº† Effect çš„è¿è¡Œä»è€Œå†æ¬¡ è®¾ç½® stateï¼Œæœ€ç»ˆå½¢æˆæ­»å¾ªç¯ã€‚

Effects åº”è¯¥è¢«ç”¨äºå°†ä½ çš„ç»„ä»¶å’Œå¤–éƒ¨ç³»ç»ŸåŒæ­¥ï¼Œå¦‚æœæ²¡æœ‰å¤–éƒ¨ç³»ç»Ÿå¹¶ä¸”ä½ æŒ‡å‘æ ¹æ®å…¶ä»– state æ¥è°ƒæ•´ä¸€äº› stateï¼Œä½ å¯èƒ½ä¸éœ€è¦ effectã€‚

## æ­¥éª¤äºŒï¼šæŒ‡å®š Effect çš„ä¾èµ–

é»˜è®¤æƒ…å†µä¸‹æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šè¿è¡Œ Effectsï¼Œé€šå¸¸æ¥è¯´è¿™ä¸æ˜¯ä½ æƒ³è¦çš„è¡Œä¸º:

- æœ‰æ—¶è¿™å¾ˆæ…¢ï¼Œä¸å¤–éƒ¨ç³»ç»ŸåŒæ­¥å¹¶ä¸æ€»æ˜¯æœºè¯•çš„ï¼Œå› æ­¤é™¤éå¿…è¦ï¼Œä½ å¯èƒ½å¸Œæœ›è·³è¿‡å®ƒï¼Œä¾‹å¦‚ä½ ä¸æƒ³åœ¨æ¯æ¬¡è¾“å…¥æ—¶éƒ½é‡è¿èŠå¤©æœåŠ¡å™¨
- æœ‰æ—¶å€™è¿™ç§è¡Œä¸ºæ˜¯é”™çš„ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä½ ä¸æƒ³åœ¨æ¯æ¬¡è¾“å…¥æ—¶éƒ½è§¦å‘ç»„ä»¶çš„æ·¡å…¥åŠ¨ç”»ï¼Œæ·¡å…¥åŠ¨ç”»åº”è¯¥åªåœ¨ç»„ä»¶ç¬¬ä¸€æ¬¡å‡ºç°æ—¶æ’­æ”¾ä¸€æ¬¡ã€‚

ä¸ºäº†æ¼”ç¤ºè¿™ä¸ªé—®é¢˜ï¼Œä¸‹é¢æ˜¯ä¸ªä¹‹å‰çš„ä¾‹å­ï¼Œ

```javascript
import { useState, useRef, useEffect } from 'react';

function VideoPlayer({ src, isPlaying }) {
  const ref = useRef(null);

  useEffect(() => {
    if (isPlaying) {
      console.log('calling video.play()')
      ref.current.play()
    } else {
      console.log('calling video.pause()')
      ref.current.pause()
    }
  })

  return <video ref={ref} src={src} loop playsInline />;
}

export default function App() {
  const [isPlaying, setIsPlaying] = useState(false);
  const [text, setText] = useState('');
  return (
    <>
      <input value={text} onChange={e => setText(e.target.value)} />
      <button onClick={() => setIsPlaying(!isPlaying)}>
        {isPlaying ? 'Pause' : 'Play'}
      </button>
      <VideoPlayer
        isPlaying={isPlaying}
        src="https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4"
      />
    </>
  );
}

```

ä½ å¯ä»¥é€šè¿‡ä¸º useEffect æŒ‡å®šä¸€ä¸ªä¾èµ–æ•°ç»„ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°æ¥å‘Šè¯‰ React è·³è¿‡ä¸å¿…è¦çš„ Effectã€‚å…ˆä» [] å¼€å§‹æ¥æ”¹é€ ä¸Šé¢çš„ä¾‹å­:

```javascript
useEffect(() => {
  // ...
}, [])
```

ä½ åº”è¯¥çœ‹åˆ°ä¸€ä¸ª error: React Hook useEffect has a missing dependency: 'isPlaying':

```javascript
import { useState, useRef, useEffect } from 'react';

function VideoPlayer({ src, isPlaying }) {
  const ref = useRef(null);

  useEffect(() => {
    if (isPlaying) {
      console.log('Calling video.play()');
      ref.current.play();
    } else {
      console.log('Calling video.pause()');
      ref.current.pause();
    }
  }, []); // This causes an error

  return <video ref={ref} src={src} loop playsInline />;
}

export default function App() {
  const [isPlaying, setIsPlaying] = useState(false);
  const [text, setText] = useState('');
  return (
    <>
      <input value={text} onChange={e => setText(e.target.value)} />
      <button onClick={() => setIsPlaying(!isPlaying)}>
        {isPlaying ? 'Pause' : 'Play'}
      </button>
      <VideoPlayer
        isPlaying={isPlaying}
        src="https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4"
      />
    </>
  );
}
```

é—®é¢˜åœ¨äºä½ çš„ Effect å†…éƒ¨çš„ä»£ç ä¾èµ–äº isPlaying å±æ€§æ¥å†³å®šåšä»€ä¹ˆï¼Œä½†æ˜¯è¿™ä¸ªä¾èµ–é¡¹å¹¶æ²¡æœ‰è¢«æ˜ç¡®çš„å£°æ˜ï¼›è¦ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼Œå°† isPlaying æ·»åŠ åˆ°ä¾èµ–æ•°ç»„ä¸­:

```javascript
useEffect(() => {
  if(isPlaying) { // è¿™é‡Œç”¨äº† isPlaying

  } else {

  }
}, [isPlaying]) // ä¾èµ–é¡¹å¿…é¡»è¢«æ·»åŠ åˆ°ä¾èµ–æ•°ç»„ä¸­
```

ç°åœ¨æ‰€æœ‰çš„ä¾èµ–é¡¹éƒ½è¢«å£°æ˜äº†ï¼Œæ‰€ä»¥æ²¡æœ‰ error äº†ã€‚ä¸ºç»„ä»¶æŒ‡å®š [isPlaying] ä½œä¸ºä¾èµ–æ•°ç»„ç­‰äºå‘Šè¯‰ React å¦‚æœä¸‹æ¬¡æ¸²æŸ“æ—¶ isPlaying å’Œä¸Šæ¬¡ä¿æŒä¸€æ ·é‚£å°±è·³è¿‡ Effect çš„è¿è¡Œã€‚é€šè¿‡è¿™ç‚¹ä¿®æ”¹ï¼Œåœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥å†…å®¹å¹¶ä¸ä¼šå¯¼è‡´ Effect å†æ¬¡è¿è¡Œï¼Œè€Œç‚¹å‡» press/pause ä¼šã€‚

```javascript
import { useState, useRef, useEffect } from 'react';

function VideoPlayer({ src, isPlaying }) {
  const ref = useRef(null);

  useEffect(() => {
    if (isPlaying) {
      console.log('Calling video.play()');
      ref.current.play();
    } else {
      console.log('Calling video.pause()');
      ref.current.pause();
    }
  }, [isPlaying]);

  return <video ref={ref} src={src} loop playsInline />;
}

export default function App() {
  const [isPlaying, setIsPlaying] = useState(false);
  const [text, setText] = useState('');
  return (
    <>
      <input value={text} onChange={e => setText(e.target.value)} />
      <button onClick={() => setIsPlaying(!isPlaying)}>
        {isPlaying ? 'Pause' : 'Play'}
      </button>
      <VideoPlayer
        isPlaying={isPlaying}
        src="https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4"
      />
    </>
  );
}

```

ä¾èµ–æ•°ç»„å¯ä»¥åŒ…å«å¤šä¸ªä¾èµ–é¡¹ï¼Œå¦‚æœä½ æŒ‡å®šçš„æ‰€æœ‰ä¾èµ–é¡¹éƒ½å’Œä¸Šæ¬¡æ¸²æŸ“ä¸€æ¨¡ä¸€æ ·æ—¶ React ä¼šè·³è¿‡ Effect çš„æ‰§è¡Œã€‚React å†…éƒ¨é€šè¿‡ Object.is æ¥åˆ¤æ–­ä¾èµ–é¡¹çš„å€¼ã€‚åœ¨ useEffect ç« èŠ‚ä¸­æŸ¥é˜…æ›´å¤šç»†èŠ‚ã€‚

æ³¨æ„ä½ ä¸èƒ½ â€œé€‰æ‹©â€ ä½ çš„ä¾èµ–ã€‚å¦‚æœä¾èµ–æ•°ç»„å’Œ React åŸºäº Effect å†…ä»£ç æ¨å¯¼å‡ºçš„ä¾èµ–ä¸ä¸€æ ·ï¼Œé‚£ä½ å°†å¾—åˆ°ä¸€ä¸ª errorã€‚è¿™æœ‰åŠ©äºæ•è·ä»£ç ä¸­çš„ bugã€‚å¦‚æœä½ ä¸æƒ³è®©æŸäº›ä»£ç å†æ¬¡è¿è¡Œï¼Œé‚£å°±ç¼–è¾‘ Effect çš„ä»£ç å¹¶ä»ä¸­ç§»é™¤é‚£ä¸ªä¾èµ–

> é™·é˜±
>
> æ²¡æœ‰ä¾èµ–é¡¹å’Œä¾èµ–é¡¹ä¸ºç©ºæ•°ç»„çš„è¡Œä¸ºæ˜¯ä¸ä¸€æ ·çš„:

```javascript
// æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½ä¼šæ‰§è¡Œ
useEffect(() => {

})
// åªæœ‰å½“ç»„ä»¶ mount æ—¶æ‰§è¡Œ
useEffect(() => {

}, [])
// mount æ—¶æ‰§è¡Œï¼Œa æˆ– b å˜æ›´åæ‰§è¡Œ
useEffect(() => {

}, [a, b])
```

> åœ¨ä¸‹ä¸€æ­¥ä¸­æˆ‘ä»¬å³å°†çœ‹çœ‹ "mount" åˆ°åº•æ˜¯ä»€ä¹ˆ

> æ·±åº¦é˜…è¯»
>
> ä¸ºä»€ä¹ˆä¾èµ–é¡¹ä¸­çš„ ref è¢«å¿½ç•¥äº†
>
> è¿™ä¸ª Effect ä¸­åŒæ—¶ç”¨äº† ref å’Œ isPlayingï¼Œä½†æ˜¯åªæœ‰ isPlaying è¢«å£°æ˜ä¸ºä¾èµ–é¡¹äº†

```javascript
function VideoPlayer({ src, isPlaying }) {
  const ref = useRef(null);
  useEffect(() => {
    if (isPlaying) {
      ref.current.playing();
    } else {
      ref.current.pause()
    }
  }, [isPlaying])
}
```

> è¿™æ˜¯å› ä¸º ref å¯¹è±¡å…·æœ‰ä¸€ä¸ªç¨³å®šçš„æ ‡è¯†ï¼šReact ä¿è¯æ¯æ¬¡æ¸²æŸ“æ—¶ä½ ä» useRef ä¸­å¾—åˆ°çš„å¯¹è±¡æ˜¯ä¸€æ ·çš„ï¼Œæ°¸è¿œä¸å˜ã€‚æ‰€ä»¥ ref æœ¬èº«æ°¸è¿œä¸ä¼šå¯¼è‡´ Effect çš„è¿è¡Œã€‚æ‰€ä»¥ï¼Œåœ¨ä¾èµ–é¡¹ä¸­æ˜¯å¦åŒ…å« ref æ²¡ä»€ä¹ˆå½±å“ï¼Œä½ å†™è¿›å»ä¹Ÿæ˜¯ ok çš„:

```javascript
function VideoPlayer({ src, isPlaying }) {
  const ref = useRef(null);
  useEffect(() => {
    if (isPlaying) {
      ref.current.play();
    } else {
      ref.current.pause();
    }
  }, [isPlaying, ref]);
```

> useState è¿”å›çš„ set å‡½æ•°åŒæ ·å…·æœ‰ç¨³å®šçš„æ ‡è¯†ï¼Œæ‰€ä»¥ä½ ä¼šç»å¸¸çœ‹åˆ°å®ƒä¹Ÿè¢«ä¾èµ–æ•°ç»„å¿½ç•¥ã€‚å¦‚æœ lint å·¥å…·å…è®¸ä½ å¿½ç•¥æŸä¸ªä¾èµ–ï¼Œé‚£è¿™ä¹ˆåšå°±æ˜¯å®‰å…¨çš„ã€‚
> å¿½ç•¥ç¨³å®šçš„ä¾èµ–é¡¹åªæœ‰åœ¨ linter èƒ½å‘ç°æŸä¸ªå¯¹è±¡æ˜¯ç¨³å®šçš„æ—¶å€™æ‰ä¼šç”Ÿæ•ˆã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœ ref æ˜¯ä»çˆ¶ç»„ä»¶ä¸­ä¼ é€’çš„ï¼Œä½ å¿…é¡»åœ¨ä¾èµ–æ•°ç»„ä¸­å£°æ˜å®ƒã€‚ç„¶è€Œï¼Œè¿™å…¶å®æ˜¯æ­£ç¡®çš„ï¼Œå› ä¸ºä½ æ— æ³•çŸ¥é“çˆ¶ç»„ä»¶æ€»æ˜¯ä¼ é€’ç›¸åŒçš„ ref è¿˜æ˜¯ä»ä¸€å † refs ä¸­æ¡ä»¶æ€§çš„ä¼ é€’ä¸€ä¸ªï¼Œæ‰€ä»¥ä½ çš„ Effect ä¾èµ–å…·ä½“çš„ ref

## æ­¥éª¤ä¸‰: æŒ‰éœ€æ·»åŠ æ¸…ç†å‡½æ•°

è€ƒè™‘ä¸€ä¸ªä¸ä¸€æ ·çš„ä¾‹å­ï¼Œä½ åœ¨å†™ä¸€ä¸ª ChatRoom ç»„ä»¶ï¼Œå®ƒå‡ºç°åœ¨å±å¹•ä¸Šæ—¶éœ€è¦é“¾æ¥åˆ°èŠå¤©æœåŠ¡å™¨ã€‚å½“ä¸‹æœ‰ä¸ª createConnection() çš„ APIï¼Œå…¶è¿”å›äº†ä¸€ä¸ªå…·æœ‰ connect() å’Œ disconnect() çš„å¯¹è±¡ã€‚å½“å®ƒå‡ºç°åœ¨å±å¹•ä¸Šæ—¶å¦‚ä½•ä¿æŒå…¶è¿æ¥çŠ¶æ€

é¦–å…ˆä» Effect é€»è¾‘å¼€å§‹:

```javascript
useEffect(() => {
  const connection = createConnection();
  connection.connect()
})
```

æ¯æ¬¡æ¸²æŸ“éƒ½è¿æ¥èŠå¤©æœåŠ¡å™¨ä¼šå¾ˆæ…¢ï¼Œæ‰€ä»¥ä½ æ·»åŠ äº†ä¾èµ–é¡¹æ•°ç»„:

```javascript
useEffect(() => {
  const connection = createConnection();
  connection.connect();
}, []);
```

è¿™ä¸ª Effect å†…éƒ¨å¹¶æ²¡æœ‰ä¾èµ–ä»»ä½• props æˆ– stateï¼Œæ‰€ä»¥ä½ çš„ä¾èµ–é¡¹æ•°ç»„æ˜¯ []ã€‚è¿™ç­‰åŒäºå‘Šè¯‰ React åªæœ‰å½“ç»„ä»¶ mount æ—¶æ‰è¿è¡Œè¿™æ®µä»£ç ï¼Œå³ç¬¬ä¸€æ¬¡å‡ºç°åœ¨å±å¹•ä¸Šã€‚

è¯•ç€è¿è¡Œè¿™æ®µä»£ç :

```javascript App.js
import { useEffect } from 'react';
import { createConnection } from './chat.js';

export default function ChatRoom() {
  useEffect(() => {
    const connection = createConnection();
    connection.connect();
  }, []);
  return <h1>Welcome to the chat!</h1>;
}
```

```javascript chat.js
export function createConnection() {
  // A real implementation would actually connect to the server
  return {
    connect() {
      console.log('âœ… Connecting...');
    },
    disconnect() {
      console.log('âŒ Disconnected.');
    }
  };
}
```

è¿™ä¸ª Effect åªæœ‰åœ¨ mount æ—¶è¿è¡Œï¼Œæ‰€ä»¥ä½ å¯èƒ½æœŸæœ›æ§åˆ¶å°æ‰“å°ä¸€æ¬¡ "âœ… Connecting..."ï¼Œç„¶è€Œå¦‚æœä½ çœ‹äº†æ§åˆ¶å°çš„è¯ä½ ä¼šå‘ç°å®ƒå‡ºç°äº†ä¸¤æ¬¡ï¼Œä¸ºä»€ä¹ˆä¼šå‘ç”Ÿè¿™ç§æƒ…å†µï¼Ÿ

æƒ³è±¡ä¸‹ ChatRoom ç»„ä»¶æ˜¯ä¸ªå¤§å‹ App çš„ä¸€éƒ¨åˆ†ï¼Œç”¨æˆ·ä» ChatRoom é¡µé¢å¼€å§‹è®¿é—®ï¼Œç»„ä»¶ mount åè°ƒç”¨ connection.connect()ï¼Œå‡è®¾ç”¨æˆ·éšåè·³è½¬åˆ°å…¶ä»–é¡µé¢äº† â€”â€” æ¯”å¦‚è®¾ç½®é¡µï¼ŒChatRoom ç»„ä»¶å¸è½½äº†ã€‚æœ€ç»ˆç”¨æˆ·ç‚¹å‡»äº†åé€€ï¼ŒChatRoom å†æ¬¡æŒ‚è½½äº†ã€‚è¿™ä¼šå¯¼è‡´å†æ¬¡å‘èµ·è¿æ¥ â€”â€” ä½†æ˜¯ç¬¬ä¸€æ¬¡çš„è¿æ¥å¹¶æ²¡æœ‰é”€æ¯ï¼å½“ç”¨æˆ·åœ¨ App ä¸­è·³è½¬æ—¶ï¼Œè¿æ¥æ•°é‡ä¼šè¿…é€Ÿå¢é•¿ã€‚

å¦‚æœä¸è¿›è¡Œå¤§é‡çš„æ‰‹åŠ¨æµ‹è¯•ï¼Œè¿™ç§ bug å¾ˆå®¹æ˜“è¢«é—æ¼ã€‚ä¸ºäº†å¸®åŠ©ä½ è¿…é€Ÿå‘ç°å®ƒä»¬ï¼Œåœ¨å¼€å‘é˜¶æ®µï¼ŒReact ä¼šåœ¨æ¯ä¸ªç»„ä»¶åˆæ¬¡æŒ‚è½½åå†æ¬¡æŒ‚è½½å®ƒ

çœ‹åˆ°ä¸¤æ¬¡ "âœ… Connecting..." æœ‰åŠ©äºä½ å‘ç°çœŸæ­£çš„é—®é¢˜ï¼šå½“ç»„ä»¶å¸è½½æ—¶ä½ æ²¡æœ‰å…³é—­è¿æ¥ã€‚

è¦ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼Œåœ¨ Effect ä¸­è¿”å›ä¸€ä¸ªæ¸…ç†å‡½æ•°:

```javascript
useEffect(() => {
  const connnection = createConnection();
  connection.connect();
  return () => {
    connecion.disconnect();
  }
})
```

React ä¼šåœ¨ Effect å†æ¬¡è¿è¡Œå‰è°ƒç”¨ä½ çš„æ¸…ç†å‡½æ•°ã€‚æœ€åä¸€æ¬¡ç»„ä»¶å¸è½½æ—¶ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æ‰§è¡Œæ¸…ç†å‡½æ•°ä¼šå‘ç”Ÿä»€ä¹ˆ:

```javascript
import { useState, useEffect } from 'react';
import { createConnection } from './chat.js';

export default function ChatRoom() {
  useEffect(() => {
    const connection = createConnection();
    connection.connect();
    return () => connection.disconnect();
  }, []);
  return <h1>Welcome to the chat!</h1>;
}

```

ç°åœ¨å¼€å‘æ¨¡å¼ä¸‹ä½ ä¼šçœ‹åˆ°ä¸‰æ¡æ—¥å¿—:

1. "âœ… Connecting..."
2. "âŒ Disconnected."
3. "âœ… Connecting..."

åœ¨å¼€å‘æ¨¡å¼ä¸‹è¿™ç§è¡¨ç°æ˜¯æ­£å¸¸çš„ï¼Œé€šè¿‡å†æ¬¡æŒ‚è½½ä½ çš„ç»„ä»¶ï¼ŒReact ç¡®è®¤äº†é¡µé¢è·³è½¬å¹¶ä¸ä¼šç ´åä½ çš„ä»£ç ã€‚æ–­å¼€è¿æ¥å¹¶å†æ¬¡è¿æ¥æ­£æ˜¯åº”è¯¥åšçš„äº‹ï¼å½“ä½ å¾ˆå¥½çš„å®ç°äº†æ¸…ç†å‡½æ•°æ—¶ï¼Œè¿è¡Œä¸€æ¬¡ Effect å’Œè¿è¡Œä¸€æ¬¡åæ‰§è¡Œæ¸…ç†å‡½æ•°å¹¶å†æ¬¡è¿è¡Œä¹‹é—´å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼è¿™é‡Œå¤šäº†ä¸€ç»„ connenct/disconnect çš„è°ƒç”¨æ˜¯ç”±äº React åœ¨å¼€å§‹æ¨¡å¼ä¸­æ¢æµ‹ä½ çš„ä»£ç æ˜¯å¦æœ‰ bug â€”â€” è¿™å¾ˆæ­£å¸¸ä¸è¦è¯•å›¾è®©å®ƒæ¶ˆå¤±ã€‚

åœ¨ç”Ÿäº§æ¨¡å¼ä¸‹ä½ åªä¼šçœ‹åˆ°ä¸€æ¬¡ "âœ… Connecting..."ï¼Œé‡è½½æŒ‚è½½ç»„ä»¶çš„è¡Œä¸ºåªä¼šå‘ç”Ÿåœ¨å¼€å‘æ¨¡å¼ä¸‹ï¼Œè¿™æœ‰åŠ©äºä½ å‘ç°éœ€è¦æ¸…ç†å‡½æ•°çš„ Effectsã€‚ä½ å¯ä»¥é€šè¿‡å…³é—­ä¸¥æ ¼æ¨¡å¼æ¥å…³é—­å¼€å‘æ¨¡å¼çš„è¡Œä¸ºï¼Œå½“æˆ‘ä»¬å»ºè®®ä¿æŒæ‰“å¼€çŠ¶æ€ï¼Œè¿™å¯ä»¥è®©ä½ å‘ç°å¾ˆå¤šåƒä¸Šé¢ä¸€æ ·çš„é”™è¯¯ã€‚

## å¦‚ä½•å¤„ç†å¼€å‘æ¨¡å¼ä¸‹ Effect è§¦å‘ä¸¤æ¬¡çš„é—®é¢˜

React åœ¨å¼€å‘æ¨¡å¼ä¸‹æœ‰æ„çš„å†æ¬¡æ¸²æŸ“äº†ç»„ä»¶ï¼Œè¿™æœ‰åŠ©äºå‘ç°ç±»ä¼¼ä¸Šé¢ä¾‹å­ä¸­çš„ bugã€‚æ­£ç¡®çš„æé—®ä¸æ˜¯ â€œå¦‚ä½•åªæ‰§è¡Œä¸€æ¬¡ Effectâ€ è€Œæ˜¯ â€œå¦‚ä½•ä¿®å¤ Effect æ‰èƒ½è®©å®ƒåœ¨äºŒæ¬¡æŒ‚è½½ä¸­æ­£å¸¸å·¥ä½œâ€ã€‚

é€šå¸¸æ¥è¯´è§£å†³æ–¹æ¡ˆæ˜¯å®ç°ä¸€ä¸ªæ¸…ç†å‡½æ•°ï¼Œæ¸…ç†å‡½æ•°åº”è¯¥åœæ­¢æˆ–æ’¤é”€ Effect åšçš„äº‹ã€‚ç»éªŒæ³•åˆ™æ˜¯ç”¨æˆ·åº”è¯¥æ— æ³•åˆ†è¾¨ Effect è¿è¡Œä¸€æ¬¡å’Œè¿è¡Œåæ¸…ç†å†è¿è¡Œçš„åŒºåˆ«ã€‚

ä½ å†™çš„å¤šæ•° Effects éƒ½åº”è¯¥ç¬¦åˆä¸‹é¢çš„å¸¸è§æ¨¡å¼ä¹‹ä¸€ã€‚

### æ§åˆ¶é react ç»„ä»¶

æœ‰æ—¶å€™ä½ éœ€è¦æ·»åŠ ä¸€äº›é React çš„ UI ç»„ä»¶ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ä½ æ­£åœ¨ä¸ºé¡µé¢æ·»åŠ ä¸€ä¸ªåœ°å›¾ç»„ä»¶ï¼Œå®ƒå…·æœ‰ä¸€ä¸ª setZoomLevel() æ–¹æ³•ï¼Œå¹¶ä¸”ä½ å¸Œæœ›å°†å…¶ä¸ä½ çš„ React ç»„ä»¶ state ä¸­çš„ zoomLevel å˜é‡ä¿æŒåŒæ­¥ï¼Œä½ çš„ Effect ä»£ç çœ‹èµ·æ¥åƒè¿™æ ·:

```javascript
useEffect(() => {
  const map = mapRef.current;
  map.SetZoomLevel(zoomLevel)
}, [zoomLevel])
```

æ³¨æ„è¿™ä¸ªæ¡ˆä¾‹ä¸­æ²¡å¿…è¦æ·»åŠ æ¸…ç†å‡½æ•°ï¼Œåœ¨å¼€å‘æ¨¡å¼ä¸‹ React ä¼šè°ƒç”¨ä¸¤æ¬¡ Effectï¼Œä½†æ˜¯è¿™é‡Œç”¨ç›¸åŒçš„å‚æ•°è°ƒç”¨ setZoomLevel ä¸¤æ¬¡å¹¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå¯èƒ½ä¼šç¨å¾®æ…¢ä¸€ç‚¹ï¼Œä½†è¿™ç‚¹æ— å…³ç´§è¦å› ä¸ºåœ¨ç”Ÿäº§æ¨¡å¼ä¸‹å¹¶ä¸ä¼šå†æ¬¡æŒ‚è½½ã€‚

æœ‰äº› API ä¸å…è®¸ä½ è¿ç»­è°ƒç”¨ä¸¤æ¬¡ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå†…ç½®çš„ <dialog> çš„ shouModal æ–¹æ³•å¦‚æœè¢«è¿ç»­è°ƒç”¨ä¸¤æ¬¡ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè¿™é‡Œå°±è¦å®ç°æ¸…ç†å‡½æ•°å¹¶å…³é—­å¼¹çª—äº†

```javascript
useEffect(() => {
  const dialog = dialogRef.current;
  dialog.showModal();
  return () => dialog.close()
})
```

åœ¨å¼€å‘æ¨¡å¼ä¸‹ï¼Œä½ çš„ Effect ä¼šè°ƒç”¨ showModal()ï¼Œç„¶åè¿…é€Ÿçš„ close()ï¼Œç„¶åå†æ¬¡è°ƒç”¨ showModal()ã€‚è¿™ä¸è°ƒç”¨ä¸€æ¬¡ showModal å…·æœ‰ç›¸åŒçš„ç”¨æˆ·å¯è§è¡Œä¸ºï¼Œæ­£å¦‚ä½ åœ¨ç”Ÿäº§æ¨¡å¼ä¸‹çœ‹åˆ°çš„é‚£æ ·ã€‚

### è®¢é˜…äº‹ä»¶

å¦‚æœä½ çš„ Effect è®¢é˜…äº†æŸäº›ä¸œè¥¿ï¼Œæ¸…ç†å‡½æ•°ä¸­åº”è¯¥å–æ¶ˆè®¢é˜…:

```javascript
useEffect(() => {
  function handleScroll(e) {
    console.log(window.scrollX, window.scrollY);
  }
  window.addEventListener('scroll', handleScroll);
  return () => window.removeEventListener('scroll', handleScroll);
})
```

åœ¨å¼€å‘æ¨¡å¼ä¸‹ï¼Œä½ çš„ Effect ä¼šè°ƒç”¨ addEventListener()ï¼Œç„¶åé©¬ä¸Š removeEventListener()ï¼Œç„¶åå†æ¬¡ addEventListener()ã€‚æ‰€ä»¥è¿™é‡Œåªä¼šæœ‰ä¸€æ¬¡æ¿€æ´»çš„è®¢é˜…ï¼Œè¿™ä¸è°ƒç”¨ä¸€æ¬¡ addEventListenerï¼ˆï¼‰çš„ç”¨æˆ·å¯è§è¡Œä¸ºæ˜¯ä¸€è‡´çš„ï¼Œæ­£å¦‚æ­£å¸¸æ¨¡å¼ä¸‹ä¸€æ ·ã€‚

### è§¦å‘åŠ¨ç”»

å¦‚æœä½ çš„ Effect æœ‰åŠ¨ç”»ï¼Œæ¸…ç†å‡½æ•°åº”è¯¥å°†åŠ¨ç”»é‡ç½®ä¸ºé»˜è®¤å€¼:

```javascript
useEffect(() => {
  const node = ref.current;
  node.style.opacity = 1; // è§¦å‘åŠ¨ç”»
  return () => {
    node.style.opacity = 0; // æ¢å¤é»˜è®¤å€¼
  }
})
```

å¼€å‘æ¨¡å¼ä¸‹ï¼Œopacity ä¼šè¢«è®¾ä¸º 1ï¼Œç„¶åè®¾ä¸º 0ï¼Œç„¶åå†æ¬¡è®¾ä¸º 1ã€‚è¿™å’Œç›´æ¥è®¾ä¸º 1 çš„ç”¨æˆ·å¯è§è¡Œä¸ºæ˜¯ä¸€æ ·çš„ï¼Œç”Ÿäº§æ¨¡å¼ä¸‹å°±æ˜¯è¿™æ ·ã€‚å¦‚æœä½ ä½¿ç”¨æ”¯æŒè¡¥é—´çš„ç¬¬ä¸‰æ–¹åŠ¨ç”»åº“ï¼Œä½ çš„æ¸…ç†å‡½æ•°åº”è¯¥å°†æ—¶é—´è½´é‡ç½®ä¸ºå…¶åˆå§‹çŠ¶æ€ã€‚

### æ‹‰å–æ•°æ®

å¦‚æœ Effect ä¸­æ‹‰å–äº†ä¸€äº›æ•°æ®ï¼Œæ¸…ç†å‡½æ•°åº”è¯¥ç»ˆæ­¢è¯·æ±‚æˆ–å¿½ç•¥å…¶ç»“æœã€‚

```javascript
useEffect(() => {
  let ignore = false;
  async function startFetching() {
    const json = await fetchTodos(userId)ï¼›
    if (!ignore) {
      setTodos(json)
    }
  }
  startFetching();
  return () => {
    ignore = true;
  }
}, [userId])
```

æ˜¾ç„¶ä½ æ— æ³•æ’¤é”€ä¸€ä¸ªå·²ç»å‘ç”Ÿçš„ç½‘ç»œè¯·æ±‚ï¼Œä½†æ˜¯ä½ çš„æ¸…ç†å‡½æ•°åº”è¯¥ä¿è¯è¿™ä¸ªè¯·æ±‚å·²ç»æ— å…³ç´§è¦äº†ï¼Œå¹¶ä¸”ä¸ä¼šç»§ç»­å½±å“åˆ°ä½ çš„åº”ç”¨ã€‚å¦‚æœ userId ä» Alice å˜æˆäº† Bobï¼Œæ¸…ç†å‡½æ•°ç¡®ä¿ Alice çš„å“åº”å³ä½¿æ™šäº Bob å…¶ç»“æœåº”è¯¥ä¹Ÿè¦è¢«å¿½ç•¥ã€‚

åœ¨å¼€å‘æ¨¡å¼ä¸‹ï¼Œä½ åœ¨ç½‘ç»œè¯·æ±‚é¢æ¿ä¸­ä¼šçœ‹åˆ°ä¸¤æ¬¡è¯·æ±‚ï¼Œè¿™ä¸æ˜¯é”™è¯¯ã€‚ä½¿ç”¨ä¸Šè¿°çš„æ–¹æ³•ï¼Œé¦–ä¸ª Effect ä¼šé©¬ä¸Šå¼€å§‹æ¸…ç†å‡½æ•°ï¼Œignore å˜é‡è¢«è®¾ä¸º trueã€‚æ‰€ä»¥å³ä½¿æœ‰é¢å¤–çš„è¯·æ±‚ç»“æœï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»æœ‰äº† !ignore çš„åˆ¤æ–­ï¼Œå®ƒä¹Ÿä¸ä¼šå½±å“åˆ° state

åœ¨ç”Ÿäº§æ¨¡å¼ä¸‹ï¼Œè¿™é‡Œåªä¼šæœ‰ä¸€ä¸ªè¯·æ±‚ã€‚å¦‚æœå¼€å‘æ¨¡å¼ä¸‹çš„ç¬¬äºŒä¸ªè¯·æ±‚å¹²æ‰°åˆ°ä½ äº†ï¼Œæœ€ä½³æ–¹æ¡ˆæ˜¯ä½¿ç”¨é‚£äº›åœ¨ç»„ä»¶ä¹‹é—´å‡å°‘é‡å¤è¯·æ±‚å¹¶ç¼“å­˜å“åº”çš„æ–¹æ¡ˆã€‚

```javascript
function TodoList() {
  const todos = useSomeDataLibrary(`/api/user/${userId}/todos`);
}
```

è¿™ä¸ä»…èƒ½æå‡å¼€å‘ä½“éªŒï¼Œè¿˜èƒ½è®©ä½ çš„åº”ç”¨æ„Ÿè§‰æ›´å¿«ã€‚æ¯”å¦‚ç”¨æˆ·ç‚¹å‡»åé€€æŒ‰é’®æ—¶ä¸ç”¨ç­‰å¾…æ•°æ®å†æ¬¡åŠ è½½å› ä¸ºå®ƒå·²ç»è¢«ç¼“å­˜äº†ã€‚ä½ å¯ä»¥è‡ªå·±æ„å»ºè¿™æ ·çš„ç¼“å­˜ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¼—å¤šæ›¿ä»£æ–¹æ³•ä¹‹ä¸€æ¥åœ¨ Effects ä¸­æ‰‹åŠ¨è·å–ã€‚

> æ·±åº¦é˜…è¯»
>
> åœ¨ Effect ä¸­è·å–æ•°æ®çš„å¥½çš„æ›¿ä»£æ–¹æ¡ˆæ˜¯ä»€ä¹ˆ
>
> åœ¨ Effect ä¸­è°ƒç”¨ fetch æ˜¯ä¸€ç§æµè¡Œçš„è·å–æ•°æ®çš„æ–¹å¼ï¼Œå°¤å…¶æ˜¯åœ¨å®¢æˆ·ç«¯ app ä¸­ã€‚ç„¶è€Œï¼Œè¿™ç§å®Œå…¨ä¾èµ–æ‰‹åŠ¨çš„æ–¹æ³•å…·æœ‰ä¸€äº›ç¼ºç‚¹:
> 
> - Effects ä¸åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œè¿™æ„å‘³ç€æœåŠ¡å™¨åˆå§‹æ¸²æŸ“çš„ HTML ä»…åŒ…å«äº†åŠ è½½çŠ¶æ€è€Œæ²¡æœ‰æ•°æ®ã€‚å®¢æˆ·ç«¯å—è„‘å¿…é¡»åŠ è½½å®Œæ‰€æœ‰çš„ js æ–‡ä»¶å¹¶æ¸²æŸ“åº”ç”¨æ—¶æ‰å‘ç°å®ƒéœ€è¦åŠ è½½æ•°ç»„ã€‚è¿™ç§æ–¹å¼æ•ˆç‡æ¯”è¾ƒä½
> - åœ¨ Effects ä¸­ç›´æ¥è·å–æ•°æ®å¾ˆå®¹æ˜“åˆ›é€ ä¸€ä¸ª â€œç½‘ç»œç€‘å¸ƒæµâ€ã€‚æ¸²æŸ“çˆ¶ç»„ä»¶æ—¶ï¼Œå®ƒæ‹‰å–ä¸€äº›æ•°æ®åå†æ¸²æŸ“å­ç»„ä»¶ï¼Œç„¶åé‡å¤è¿™ä¸ªè¿‡ç¨‹ã€‚å¦‚æœç½‘ç»œæ¯”è¾ƒå·®ï¼Œè¿™æ¯”å¹¶è¡Œè·å–æ‰€æœ‰æ•°æ®è¦æ…¢å¾—å¤š
> - ä¸ç¬¦åˆäººç±»ç›´è§‰ã€‚å½“ä»¥ä¸€ç§ä¸ä¼šå‡ºç°ç«æ€ç­‰é”™è¯¯çš„æ–¹å¼ç¼–å†™ç½‘ç»œè¯·æ±‚è°ƒç”¨æ˜¯ï¼Œä¼šæ¶‰åŠç›¸å½“å¤šçš„æ ·æ¿ä»£ç ã€‚
>
> è¿™ä¸ªç¼ºç‚¹åˆ—è¡¨å¹¶ä¸æ˜¯ React ç‰¹æœ‰çš„ï¼Œå®ƒé€‚ç”¨äºä»»ä½•åœ¨ mount æ—¶è·å–æ•°æ®çš„ä»»ä½•åº“ã€‚å’Œè·¯ç”±ä¸€æ ·ï¼Œæƒ³åšå¥½æ•°æ®è·å–å¹¶éæ˜“äº‹ï¼Œå› ä¸ºæˆ‘ä»¬æ¨èå¦‚ä¸‹æ–¹æ³•:
>
> - å¦‚æœä½ ä½¿ç”¨æ¡†æ¶ï¼Œè¯·ä½¿ç”¨å…¶å†…ç½®çš„æ•°æ®è·å–æœºåˆ¶ã€‚ç°ä»£çš„ React æ¡†æ¶ç»§æ‰¿äº†é«˜æ•ˆçš„æ•°æ®è·å–æœºåˆ¶ï¼Œå¹¶ä¸”ä¸ä¼šå‡ºç°ä¸Šè¿°é—®é¢˜
> - å¦åˆ™ï¼Œè¯·è€ƒè™‘ä½¿ç”¨æˆ–æ„å»ºå®¢æˆ·ç«¯ç¼“å­˜ã€‚æµè¡Œçš„å¼€æºè§£å†³æ–¹æ¡ˆåŒ…æ‹¬ React Queryã€useSWRå’Œ React Router6.4+ã€‚ä½ ä¹Ÿå¯ä»¥æ„å»ºè‡ªå·±çš„è§£å†³æ–¹æ¡ˆï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥åœ¨èƒŒåä½¿ç”¨ Effectsï¼Œä½†éœ€è¦æ‰‹åŠ¨æ·»åŠ ç”¨äºå¤„ç†é‡å¤è¯·æ±‚ã€ç¼“å­˜å“åº”å’Œé¿å…å‡ºç°ç½‘ç»œç€‘å¸ƒçš„é€»è¾‘(é€šè¿‡é¢„åŠ è½½æ•°æ®æˆ–å°†æ•°æ®éœ€æ±‚æå‡åˆ°è·¯ç”±)ã€‚
>
> å¦‚æœè¿™äº›æ–¹æ³•éƒ½ä¸é€‚åˆä½ ï¼Œä½ å¯ä»¥ç»§ç»­åœ¨ Effects ä¸­ç›´æ¥è·å–æ•°æ®

### å‘é€ç»Ÿè®¡

è€ƒè™‘è¿™æ®µåœ¨é¡µé¢è®¿é—®æ—¶å‘é€ç»Ÿè®¡çš„ä»£ç :

```javascript
useEffect(() => {
  logVisit(url);
}, [url])
```

åœ¨å¼€å‘æ¨¡å¼ä¸‹,æ¯ä¸ª URL éƒ½ä¼šè¢« logVisit è°ƒç”¨ä¸¤æ¬¡ï¼Œæ‰€ä»¥ä½ å¯èƒ½æƒ³ä¿®å¤å®ƒã€‚æˆ‘ä»¬å»ºè®®ä¿æŒä»£ç ä¸å˜ï¼Œå’Œä¹‹å‰çš„ä¾‹å­ä¸€æ ·ï¼Œè¿è¡Œä¸€æ¬¡å’Œä¸¤æ¬¡å¹¶æ²¡æœ‰ç”¨æˆ·å¯è§çš„å·®å¼‚ï¼Œä»å®é™…çš„è§’åº¦æ¥çœ‹ï¼ŒlogVisit åœ¨å¼€å‘æ¨¡å¼ä¸‹ä¸åº”è¯¥åšä»»ä½•äº‹ï¼Œå› ä¸ºä½ å¹¶ä¸å¸Œæœ›å¼€å‘ç¯å¢ƒæœºå™¨çš„æ—¥å¿—æ‰°ä¹±äº†ç”Ÿäº§ç¯å¢ƒçš„æŒ‡æ ‡ã€‚å½“ä½ æ”¹åŠ¨ä»£ç æ–‡ä»¶æ—¶ï¼Œä½ çš„ç»„ä»¶æ€»æ˜¯ä¼šå†æ¬¡æŒ‚è½½ï¼Œæ‰€ä»¥æ— è®ºå¦‚ä½•å¼€å‘ç¯å¢ƒä¸‹éƒ½å­˜åœ¨å¤šä½™çš„æ—¥å¿—ã€‚

åœ¨ç”Ÿäº§æ¨¡å¼ä¸‹ï¼Œä¸ä¼šæœ‰é‡å¤çš„è®¿é—®æ‰“å°ã€‚

è¦è°ƒè¯•ä½ å‘é€çš„ç»Ÿè®¡çš„é—®é¢˜ï¼Œä½ å¯ä»¥å°†åº”ç”¨éƒ¨ç½²åˆ°æš‚å­˜ç¯å¢ƒä¸­ï¼ˆä»¥ç”Ÿäº§æ¨¡å¼è¿è¡Œï¼‰ï¼Œæˆ–è€…æš‚æ—¶é€€å‡ºä¸¥æ ¼æ¨¡å¼ä»¥å…³é—­äºŒæ¬¡æŒ‚è½½çš„æ£€æŸ¥ã€‚ä½ è¿˜å¯ä»¥åœ¨è·¯ç”±å˜åŒ–æ˜¯å‘é€ç»Ÿè®¡ä¿¡æ¯è€Œä¸æ˜¯åœ¨ Effect ä¸­ã€‚ ä¸ºäº†è¿›è¡Œæ›´ç²¾ç¡®çš„åˆ†æï¼Œintersection observers å¯ä»¥å¸®åŠ©ä½ è¿½è¸ªå“ªäº›ç»„ä»¶åœ¨è§†å£ä¸­ä»¥åŠå®ƒä»¬ä¿æŒå¯è§çš„æ—¶é—´ã€‚

### é Effect: åˆå§‹åŒ– app

æœ‰äº›é€»è¾‘åº”è¯¥åœ¨ app å¯åŠ¨æ—¶ä»…æ‰§è¡Œä¸€æ¬¡ï¼Œä½ å¯ä»¥å°†å…¶æ”¾åœ¨ç»„ä»¶ä¹‹å¤–:

```javascript
if (typeof window !== undefined) {
  checkAuthToken();
  loadDataFromLocalStorage();
}
function App() {

}
```

è¿™ç§æ–¹å¼ä¿è¯äº†ç±»ä¼¼çš„é€»åªæœ‰åœ¨æµè§ˆå™¨åŠ è½½é¡µé¢æ—¶æ‰§è¡Œä¸€æ¬¡.

### é Effect: è´­ä¹°äº§å“

æœ‰æ—¶å€™å³ä½¿ä½ å†™äº†ä¸€ä¸ªæ¸…ç†å‡½æ•°ï¼Œè¿˜æ˜¯æ²¡åŠæ³•é˜»æ­¢ä¸¤æ¬¡è¿è¡Œ Effect å¸¦æ¥çš„ç”¨æˆ·å¯è§æ€§çš„å˜åŒ–ã€‚æ¯”å¦‚ï¼Œå¯èƒ½ä½ çš„ Effect å‘é€äº†ä¸€ä¸ª POST è¯·æ±‚ï¼Œå…¶å†…å®¹å¯èƒ½æ˜¯è´­ä¹°ä¸€ä¸ªäº§å“

```javascript
useEffect(() => {
  fetch('/api/buy', {
    method: 'POST'
  })
})
```

ä½ è‚¯å®šä¸æƒ³ä¹°ä¸¤æ¬¡äº§å“ï¼Œç„¶è€Œï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä½ ä¸åº”è¯¥å°†è¿™ä¸ªé€»è¾‘æ”¾åœ¨ Effect çš„åŸå› ã€‚å¦‚æœç”¨æˆ·å»äº†å…¶ä»–é¡µé¢ç„¶åè¿”å›å‘¢ï¼Ÿä½ çš„ Effect ä¼šå†æ¬¡è¿è¡Œï¼Œä½ å¹¶ä¸å¸Œæœ›ç”¨æˆ·æµè§ˆé¡µé¢æ—¶è´­ä¹°æŸä¸ªäº§å“ï¼Œè€Œæ˜¯åœ¨ç”¨æˆ·è´­ä¹°æŒ‰é’®æ—¶æ‰ä¹°ã€‚

è´­ä¹°è¡Œä¸ºä¸åº”è¯¥ç”±æ¸²æŸ“é¡µé¢å¯¼è‡´ï¼Œè€Œæ˜¯å‡ºè‡ªæŸç§äº¤äº’è¡Œä¸ºã€‚åªæœ‰å½“ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æ—¶å®ƒæ‰åº”è¯¥è¿è¡Œï¼Œåˆ é™¤ Effect å¹¶å°†ä½ çš„ API è¯·æ±‚ç§»åŠ¨åˆ°è´­ä¹°æŒ‰é’®çš„äº‹ä»¶å¤„ç†ç¨‹åºä¸­:

```javascript
function handleClick() {
  fetch('/api/buy', {
    method: 'POST'
  })
}
```

è¿™è¯´æ˜å¦‚æœé‡æ–°æŒ‚è½½ç ´åäº†åº”ç”¨ç¨‹åºçš„é€»è¾‘ï¼Œè¿™é€šå¸¸ä¼šå‘ç°å·²çŸ¥ bugã€‚ä»ç”¨æˆ·çš„è§’åº¦æ¥çœ‹ï¼Œè®¿é—®ä¸€ä¸ªé¡µé¢åº”è¯¥å’Œè®¿é—®ã€è·³è½¬é“¾æ¥ç„¶åè¿”å›æ²¡æœ‰ä»€ä¹ˆä¸åŒï¼ŒReact é€šè¿‡åœ¨å¼€å‘ç¯å¢ƒä¸­å†æ¬¡æŒ‚è½½ç»„ä»¶æ¥éªŒè¯å®ƒä»¬æ˜¯å¦éµå¾ªè¿™ä¸ªåŸåˆ™ã€‚

### æŠŠä¸Šé¢åŸåˆ™æ”¾ä¸€èµ·

è¿™ä¸ª Playground å¯ä»¥å¸®åŠ©ä½ æ„Ÿå—åˆ°å®è·µä¸­ Effects æ˜¯æ€ä¹ˆå·¥ä½œçš„

```javascript
import { useState, useEffect } from 'react';

function Playground() {
  const [text, setText] = useState('a');

  useEffect(() => {
    function onTimout() {
      console.log('â° ' + text);
    }
    console.log('ğŸ”µ Schedule "' + text + '" log');

    const timeoutId = setTimeout(onTimout, 3000);
    return () => {
      console.log('ğŸŸ¡ Cancel "' + text + '" log');
      clearTimeout(timeoutId)
    }
  }, [text])

  return (
    <>
      <label>what to logï¼š</label>
      <input value={text} onChange={e => {
        setText(e.target.value)
      }}></input>
      <h1>{text}</h1>
    </>
  )
}

export default function App() {
  const [show, setShow] = useState(false);
  return (
    <>
      <button onClick={() => setShow(!show)}>{show ? 'Unmount' : 'Mount'} the component</button>
      {show && <hr />}
      {show && <Playground />}
    </>
  )
}
```

ä¸€å¼€å§‹ä½ å°†çœ‹åˆ°ä¸‰æ¡æ—¥å¿—: `Schedule "a" log`, `Cancel "a" log`, åŠ `Schedule "a" log`ã€‚ä¸‰ç§’åè¿˜æœ‰ä¸€ä¸ªæ—¥å¿—æ‰“å° `a`ã€‚å’Œä½ ä¹‹å‰å­¦åˆ°çš„ä¸€æ ·ï¼Œé¢å¤–çš„ schedule/cancel æ˜¯å› ä¸ºå¼€å‘æ¨¡å¼ä¸‹ React ä¼šå†æ¬¡æŒ‚è½½ç»„ä»¶ä»¥ç¡®è®¤ä½ æ˜¯å¦æ­£ç¡®çš„å®ç°äº†æ¸…ç†å‡½æ•°

ç°åœ¨ç¼–è¾‘è¾“å…¥æ¡†ä¸º `abc`ï¼Œå¦‚æœä½ åšçš„è¶³å¤Ÿå¿«ï¼Œä½ å°†é©¬ä¸Šçœ‹åˆ° `Schedule "ab" log` å’Œç´§éšå…¶åçš„ `Cancel "ab" log` åŠ `Schedule "abc" log`ã€‚React æ€»æ˜¯åœ¨ä¸‹æ¬¡æ¸²æŸ“ Effect ä¹‹å‰æ¸…ç†æ‰ä¸Šä¸ªæ¸²æŸ“ Effectï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå³ä½¿ä½ å¿«é€Ÿè¾“å…¥ï¼Œä¸€æ¬¡ä¹Ÿæœ€å¤šåªæœ‰ä¸€ä¸ªå®šæ—¶å™¨ã€‚å¤šç¼–è¾‘è¾“å…¥æ¡†å‡ æ¬¡å¹¶è§‚å¯Ÿæ§åˆ¶å°ä»¥äº†è§£ Effects æ˜¯å¦‚ä½•è¢«æ¸…ç†çš„ã€‚

å°è¯•ç¼–è¾‘è¾“å…¥æ¡†ç„¶åè¿…é€Ÿç‚¹å‡» â€œUnmount the componentâ€ï¼Œæ³¨æ„åˆ°å¸è½½æ—¶æ˜¯å¦‚ä½•æ¸…ç†ä¸Šæ¬¡æ¸²æŸ“çš„ effect çš„ã€‚è¿™ä¸ªä¾‹å­ä¸­å®ƒæ¸…ç†äº†ä¸Šæ¬¡æ¸²æŸ“çš„å®šæ—¶å™¨ ID

æœ€åï¼Œç¼–è¾‘ä¸Šé¢çš„ç»„ä»¶å¹¶æ³¨é‡Šæ‰æ¸…ç†å‡½æ•°ï¼Œè¿™æ ·å®šæ—¶å™¨å°±ä¸ä¼šè¢«å–æ¶ˆã€‚å°è¯•å¿«é€Ÿè¾“å…¥abcdeï¼Œä½ æœŸæœ›å‘ç”Ÿä»€ä¹ˆï¼Ÿä¼šæ‰“å°ä¸Šä¸€æ¬¡çš„ text è¿˜æ˜¯æ‰“å°äº”ä¸ª abcdeï¼Ÿ

ä½ åº”è¯¥çœ‹åˆ°çš„æ˜¯ä¸€ä¸²æ—¥å¿—: `a`,`ab`,`abc`,`abcd`,`abcde`ï¼Œè€Œä¸æ˜¯äº”ä¸ª `abcde`ã€‚æ¯ä¸ª Effect éƒ½ä¼šæ•è·å¯¹åº”æ¸²æŸ“ä¸­çš„ text çš„å€¼ã€‚text çš„å€¼å‘ç”Ÿå˜åŒ–æ²¡ä»€ä¹ˆå½±å“ï¼Œä¸€æ¬¡æ¸²æŸ“ä¸­ `text = 'ab'`ï¼Œå…¶ä¸­çš„ Effect å°†å§‹ç»ˆçœ‹åˆ°çš„éƒ½æ˜¯ `ab`ã€‚æ¢å¥è¯è¯´ï¼Œæ¯æ¬¡æ¸²æŸ“ä¸­çš„ Effects éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚å¦‚æœä½ å¯¹æ­¤æ„Ÿå…´è¶£ï¼Œå¯ä»¥é˜…è¯»å…³äºé—­åŒ…çš„å†…å®¹ã€‚

> æ·±åº¦é˜…è¯»
>
> æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰è‡ªå·±çš„ Effects
>
> ä½ å¯ä»¥è®¤ä¸º useEffect æ¸²æŸ“ç»“æœçš„é™„åŠ éƒ¨åˆ†ã€‚è€ƒè™‘ä¸‹é¢çš„ Effect:

```javascript
export default function ChatRoom({ roomId }) {
  useEffect(() => {
    const connection = createConnection(roomId);
    connection.connect();
    return () => connection.disconnect();
  }, [roomId])
  return <h1>Welcome to {roomId}</h1>
}
```

> è®©æˆ‘ä»¬çœ‹çœ‹ç”¨æˆ·è®¿é—®åº”ç”¨æ—¶å‘ç”Ÿäº†ä»€ä¹ˆ
>
> ### åˆæ¬¡æ¸²æŸ“
>
> ç”¨æˆ·è®¿é—® `<ChatRoom roomId="general">`ï¼Œè®©æˆ‘ä»¬åœ¨è„‘æµ·ä¸­ç”¨ general æ›¿æ¢ roomId: 
> ```javascript
> return <h1>Welcome to general!</h1>;
> ```
> Effect åŒæ ·æ˜¯æ¸²æŸ“ç»“æ„çš„ä¸€éƒ¨åˆ†ï¼Œé¦–æ¬¡æ¸²æŸ“å˜æˆå¦‚ä¸‹:
> ```javascript
> () => {
>   const connection = createConnection('general');
>   connection.connect();
>   return () => connection.disconnect();
> },
> ['general'] // ä¾èµ–é¡¹
> ```
> React è¿è¡Œè¿™ä¸ª Effectï¼Œè¿æ¥åˆ° general çš„èŠå¤©å®¤
>
> ### ç”¨ç›¸åŒçš„ä¾èµ–é¡¹å†æ¬¡æ¸²æŸ“
>
> å½“ `<ChatRoom roomId="general">` å†æ¬¡æ¸²æŸ“æ—¶ï¼ŒJSX çš„è¾“å‡ºæ˜¯ç›¸åŒçš„:
> ```javascript
> return <h1>Welcome to general!</h1>;
> ```
> React çœ‹åˆ°æ¸²æŸ“ç»“æ„æ²¡å˜ï¼Œæ‰€ä»¥å®ƒæ²¡æœ‰æ›´æ–° DOM
> ç¬¬äºŒæ¬¡æ¸²æŸ“çš„ Effect çœ‹èµ·æ¥åƒè¿™æ ·:
> ```javascript
> () => {
>   const connection = createConnection('general');
>   connection.connect();
>   return () => connection.disconnect();
> }ï¼Œ
> ['general'] // ä¾èµ–é¡¹
> ```
> React å¯¹æ¯”äº†ç¬¬äºŒæ¬¡æ¸²æŸ“å’Œç¬¬ä¸€æ¬¡æ¸²æŸ“çš„ `['general']`ï¼Œç”±äºæ‰€æœ‰çš„ä¾èµ–é¡¹éƒ½æ˜¯ç›¸åŒçš„ï¼ŒReactä¼šå¿½ç•¥ç¬¬äºŒæ¬¡æ¸²æŸ“ä¸­çš„ Effectsã€‚æ‰€ä»¥å®ƒæ°¸è¿œéƒ½ä¸ä¼šè°ƒç”¨ã€‚
>
> ### ä½¿ç”¨ä¸åŒçš„ä¾èµ–é¡¹æ¸²æŸ“
>
> ç„¶åç”¨æˆ·è®¿é—®äº† `<ChatRoom roomId="travel" />`ï¼Œè¿™ä¸€æ¬¡ç»„ä»¶è¿”å›äº†ä¸åŒçš„ JSX
> ```javascript
> return <h1>Welcome to travel!</h1>;
> ```
> React æ›´æ–°äº† DOMï¼Œå°† `Welcome to general` ä¿®æ”¹ä¸º `Welcome to travel`
> ç¬¬ä¸‰æ¬¡æ¸²æŸ“ä¸­çš„ Effect çœ‹èµ·æ¥åƒè¿™æ ·:
> ```javascript
> () => {
>   const connection = createConnection('general');
>   connection.connect();
>   return () => connection.disconnect();
> }ï¼Œ
> ['travel'] // ä¾èµ–é¡¹
> ```
> React å¯¹æ¯”äº†ç¬¬ä¸‰æ¬¡æ¸²æŸ“ä¸­çš„ `['travel']` å’Œç¬¬äºŒæ¬¡æ¸²æŸ“ä¸­çš„ `['general']`ï¼Œä¸€ä¸ªä¾èµ–å˜äº†ï¼š`Object.is('travel', 'general')` ä¸º `false`ï¼ŒEffect ä¸èƒ½è¢«è·³è¿‡
> ç¬¬ä¸‰æ¬¡æ¸²æŸ“ä¸­åº”ç”¨ Effect ä¹‹å‰ï¼Œå®ƒéœ€è¦é¦–å…ˆæ¸…ç†ä¸Šæ¬¡è¿è¡Œçš„ Effectã€‚ç¬¬äºŒæ¬¡æ¸²æŸ“çš„ Effect è¢«è·³è¿‡äº†ï¼Œæ‰€ä»¥ React éœ€è¦æ¸…ç†ç¬¬ä¸€ä¸ªæ¸²æŸ“çš„ Effectã€‚å¦‚æœä½ ç¿»çœ‹ä¸Šé¢çš„é¦–æ¬¡æ¸²æŸ“ï¼Œä½ ä¼šçœ‹åˆ°å®ƒçš„æ¸…ç†å‡½æ•°è°ƒç”¨äº† `disconnect()` æ–¹æ³•ï¼Œè¿™ä¸ªè¿æ¥æ˜¯ç”¨ `createConnection('general')` åˆ›å»ºçš„ï¼Œæ‰€ä»¥æ–­å¼€äº†ä¸ `general` çš„è¿æ¥ã€‚
> åœ¨è¿™ä¹‹åï¼ŒReact è¿è¡Œäº†ç¬¬ä¸‰æ¬¡æ¸²æŸ“çš„ Effectï¼Œå®ƒè¿æ¥åˆ°äº† `travel` èŠå¤©å®¤
>
> ### å¸è½½
> æœ€ç»ˆï¼Œç”¨æˆ·ç¦»å¼€äº†åº”ç”¨ï¼Œ`ChatRoom` ç»„ä»¶å¸è½½äº†ã€‚React è¿è¡Œäº†ä¸Šä¸€ä¸ª Effect çš„æ¸…ç†å‡½æ•°ï¼Œä¸Šä¸€ä¸ª Effect æ˜¯æ¥è‡ªç¬¬ä¸‰æ¬¡æ¸²æŸ“çš„ï¼Œç¬¬ä¸‰æ¬¡æ¸²æŸ“çš„æ¸…ç†å‡½æ•°é”€æ¯äº† `createConnection('travel')` çš„è¿æ¥ï¼Œæ‰€ä»¥åº”ç”¨å’Œ travel èŠå¤©å®¤æ–­å¼€äº†è¿æ¥
>
> ### å¼€å‘æ¨¡å¼è¡Œä¸º
>
> å½“å¼€å¯ä¸¥æ ¼æ¨¡å¼æ—¶ï¼ŒReact åœ¨ç»„ä»¶æŒ‚è½½åä¼šå†æ¬¡æŒ‚è½½ï¼Œè¿™æœ‰åŠ©äºä½ å‘ç°éœ€è¦æ¸…ç†å‡½æ•°çš„ Effectï¼Œå¹¶æš´éœ²ç±»ä¼¼ä¹‹å‰çš„ç«æ€æ¡ä»¶çš„ bugã€‚å¹¶ä¸”å¼€å‘æ¨¡å¼ä¸‹ React è¿˜åœ¨ä½ ä¿å­˜æ–‡ä»¶æ—¶å†æ¬¡æŒ‚è½½ã€‚æ‰€æœ‰çš„è¿™äº›è¡Œä¸ºéƒ½æ˜¯ä»…é™å¼€å‘æ¨¡å¼çš„ã€‚

## å›é¡¾

- å’Œäº‹ä»¶ä¸åŒï¼ŒEffect æ˜¯ç”±æ¸²æŸ“è¡Œä¸ºæœ¬èº«äº§ç”Ÿçš„è€Œä¸æ˜¯æŸä¸ªå…·ä½“çš„äº¤äº’
- Effects å…è®¸ä¸€ä¸ªç»„ä»¶å’Œå¤–éƒ¨ç³»ç»ŸåŒæ­¥
- é»˜è®¤æƒ…å†µä¸‹ï¼ŒEffects åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½ä¼šè¿è¡Œ
- å¦‚æœ Effect çš„æ‰€æœ‰ä¾èµ–é¡¹éƒ½å’Œä¸Šæ¬¡æ¸²æŸ“æ—¶ä¸€è‡´ï¼ŒReact ä¼šè·³è¿‡ Effect çš„æ‰§è¡Œ
- ä½ æ— æ³•é€‰æ‹©ä½ çš„ä¾èµ–é¡¹ï¼Œå®ƒä»¬æ˜¯ç”± Effect å†…éƒ¨çš„ä»£ç å†³å®šçš„
- ä¸€ä¸ªç©ºçš„ä¾èµ–é¡¹æ•°ç»„å¯¹åº”ç»„ä»¶çš„æŒ‚è½½é˜¶æ®µï¼Œå³è¢«æ·»åŠ åˆ°å±å¹•ä¸Šæ—¶
- åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼ŒReact æŒ‚è½½ç»„ä»¶ä¸¤æ¬¡(ä»…é™å¼€å‘æ¨¡å¼)ï¼Œä»¥æµ‹è¯•ä½ çš„ Effects
- å¦‚æœä½ çš„ Effect ç”±äºå†æ¬¡æŒ‚è½½å‡ºé—®é¢˜äº†ï¼Œä½ éœ€è¦å®ç°ä¸€ä¸ªæ¸…ç†å‡½æ•°
- React ä¼šåœ¨ä¸‹æ¬¡ Effect è¿è¡Œä¹‹å‰è°ƒç”¨æ¸…ç†å‡½æ•°ï¼Œåœ¨å¸è½½æ—¶ä¹Ÿä¼šè°ƒç”¨ã€‚
